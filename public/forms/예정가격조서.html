<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì˜ˆì •ê°€ê²© ì¡°ì„œ</title>
  <style>
    @page { size: A4; margin: 20mm; }
    * { box-sizing: border-box; }
    body { font-family: 'ë§‘ì€ ê³ ë”•', 'Malgun Gothic', sans-serif; font-size: 12pt; line-height: 1.6; margin: 0; padding: 0; background: #f5f5f5; }
    .toolbar { background: #d97706; color: white; padding: 15px 20px; position: sticky; top: 0; z-index: 100; display: flex; justify-content: space-between; align-items: center; }
    .toolbar-left { display: flex; align-items: center; gap: 20px; }
    .toolbar h2 { margin: 0; font-size: 16pt; }
    .toolbar-nav { display: flex; gap: 5px; }
    .toolbar-nav a { color: rgba(255,255,255,0.8); text-decoration: none; padding: 6px 12px; border-radius: 6px; font-size: 10pt; transition: all 0.2s; display: flex; align-items: center; gap: 6px; }
    .toolbar-nav a:hover { background: rgba(255,255,255,0.2); color: white; }
    .toolbar-nav a svg { width: 16px; height: 16px; }
    .toolbar-divider { width: 1px; height: 24px; background: rgba(255,255,255,0.3); }
    .toolbar-buttons { display: flex; gap: 10px; }
    .toolbar button { padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; font-size: 11pt; font-weight: 500; }
    .btn-save { background: #10b981; color: white; }
    .btn-load { background: #6366f1; color: white; }
    .btn-print { background: #f59e0b; color: white; }
    .btn-clear { background: #ef4444; color: white; }
    .btn-download { background: #8b5cf6; color: white; }
    .container { max-width: 800px; margin: 20px auto; padding: 40px; background: white; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    h1 { text-align: center; font-size: 20pt; margin-bottom: 30px; border-bottom: 2px solid #000; padding-bottom: 10px; }
    h3 { margin-top: 25px; margin-bottom: 10px; color: #92400e; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 15px; }
    th, td { border: 1px solid #000; padding: 10px; }
    th { background-color: #fef3c7; text-align: center; width: 130px; }
    input[type="text"], input[type="number"], input[type="date"], textarea { width: 100%; border: none; background: #fffef0; padding: 5px; font-size: 12pt; font-family: inherit; }
    input:focus, textarea:focus { outline: 2px solid #d97706; background: #fff; }
    textarea { min-height: 60px; resize: vertical; }
    .checkbox-group label { display: block; margin: 8px 0; cursor: pointer; }
    .checkbox-group input[type="checkbox"] { margin-right: 10px; transform: scale(1.2); }
    .right { text-align: right; }
    .center { text-align: center; }
    .signature-table { width: 50%; margin-left: auto; margin-top: 30px; }
    .signature-table th, .signature-table td { height: 50px; text-align: center; }
    .total-price { font-size: 14pt; font-weight: bold; background: #fef3c7; }
    .date-area { text-align: center; margin: 25px 0; }
    .toast { position: fixed; bottom: 20px; right: 20px; padding: 15px 25px; border-radius: 8px; color: white; font-weight: 500; opacity: 0; transition: opacity 0.3s; z-index: 1000; }
    .toast.show { opacity: 1; }
    .toast.success { background: #d97706; }
    .help { background-color: #fff7ed; padding: 12px; margin-top: 20px; font-size: 10pt; border: 1px solid #fed7aa; border-radius: 6px; }
    @media print {
      .toolbar, .help { display: none !important; }
      body { background: white; }
      .container { box-shadow: none; margin: 0; padding: 20px; }
      input, textarea { background: transparent !important; }
    }
  </style>
</head>
<body>
  <div class="toolbar">
    <div class="toolbar-left">
      <nav class="toolbar-nav">
        <a href="/">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>
          í™ˆ
        </a>
        <a href="/topics/private-contract">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
          ìˆ˜ì˜ê³„ì•½ ê°€ì´ë“œ
        </a>
      </nav>
      <div class="toolbar-divider"></div>
      <h2>ì˜ˆì •ê°€ê²© ì¡°ì„œ</h2>
    </div>
    <div class="toolbar-buttons">
      <button class="btn-save" onclick="saveForm()">ğŸ’¾ ì €ì¥</button>
      <button class="btn-load" onclick="loadForm()">ğŸ“‚ ë¶ˆëŸ¬ì˜¤ê¸°</button>
      <button class="btn-download" onclick="downloadAsDocx()">â¬‡ï¸ Wordì €ì¥ (í•œê¸€ í˜¸í™˜)</button>
      <button class="btn-print" onclick="window.print()">ğŸ–¨ï¸ ì¸ì‡„/PDF</button>
      <button class="btn-clear" onclick="clearForm()">ğŸ—‘ï¸ ì´ˆê¸°í™”</button>
    </div>
  </div>

  <div class="container">
    <h1>ì˜ˆì •ê°€ê²© ì¡°ì„œ</h1>

    <table>
      <tr>
        <th>ê³„ì•½ê±´ëª…</th>
        <td colspan="3"><input type="text" id="contract_name" placeholder="ì˜ˆ: 2026ë…„ë„ ì‚¬ë¬´ìš©í’ˆ êµ¬ë§¤"></td>
      </tr>
      <tr>
        <th>ê³„ì•½êµ¬ë¶„</th>
        <td>
          <label><input type="checkbox" id="type_goods"> ë¬¼í’ˆêµ¬ë§¤</label>&nbsp;&nbsp;
          <label><input type="checkbox" id="type_service"> ìš©ì—­</label>&nbsp;&nbsp;
          <label><input type="checkbox" id="type_construction"> ê³µì‚¬</label>
        </td>
        <th>ê³„ì•½ë°©ë²•</th>
        <td>
          <label><input type="checkbox" id="method_private"> ìˆ˜ì˜ê³„ì•½</label>&nbsp;&nbsp;
          <label><input type="checkbox" id="method_bid"> ê²½ìŸì…ì°°</label>
        </td>
      </tr>
    </table>

    <h3>1. ì˜ˆì •ê°€ê²© ì‘ì„±ë°©ë²•</h3>
    <table>
      <tr>
        <td class="checkbox-group">
          <label><input type="checkbox" id="price_method_1"> <strong>ê±°ë˜ì‹¤ë¡€ê°€ê²©</strong> - ì¡°ë‹¬ì²­ ë‚˜ë¼ì¥í„°, ì‹œì¤‘ ê±°ë˜ê°€ê²© ì¡°ì‚¬</label>
          <label><input type="checkbox" id="price_method_2"> <strong>ì›ê°€ê³„ì‚°</strong> - ì¬ë£Œë¹„, ë…¸ë¬´ë¹„, ê²½ë¹„ ë“± ì‚°ì¶œ</label>
          <label><input type="checkbox" id="price_method_3"> <strong>ê°ì •ê°€ê²©</strong> - ê°ì •ê¸°ê´€ì˜ ê°ì •ê°€ê²©</label>
          <label><input type="checkbox" id="price_method_4"> <strong>ìœ ì‚¬ê±°ë˜ì‹¤ë¡€ê°€ê²©</strong> - ìœ ì‚¬ ë¬¼í’ˆ/ìš©ì—­ ê±°ë˜ê°€ê²©</label>
          <label><input type="checkbox" id="price_method_5"> <strong>ê²¬ì ê°€ê²©</strong> - 2ì¸ ì´ìƒ ê²¬ì  í‰ê· ê°€ê²©</label>
        </td>
      </tr>
    </table>

    <h3>2. ê°€ê²©ì¡°ì‚¬ ë‚´ì—­</h3>
    <table>
      <thead>
        <tr>
          <th style="width: 40px;">ë²ˆí˜¸</th>
          <th>ì¡°ì‚¬ì²˜/ì¶œì²˜</th>
          <th style="width: 120px;">ì¡°ì‚¬ê°€ê²©</th>
          <th style="width: 100px;">ì¡°ì‚¬ì¼ì</th>
          <th>ë¹„ê³ </th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td class="center">1</td>
          <td><input type="text" id="survey_1_source" placeholder="ë‚˜ë¼ì¥í„° ì‡¼í•‘ëª°"></td>
          <td><input type="number" id="survey_1_price" placeholder="10000000"></td>
          <td><input type="date" id="survey_1_date"></td>
          <td><input type="text" id="survey_1_note"></td>
        </tr>
        <tr>
          <td class="center">2</td>
          <td><input type="text" id="survey_2_source" placeholder="(ì£¼)OOìƒì‚¬ ê²¬ì "></td>
          <td><input type="number" id="survey_2_price"></td>
          <td><input type="date" id="survey_2_date"></td>
          <td><input type="text" id="survey_2_note"></td>
        </tr>
        <tr>
          <td class="center">3</td>
          <td><input type="text" id="survey_3_source"></td>
          <td><input type="number" id="survey_3_price"></td>
          <td><input type="date" id="survey_3_date"></td>
          <td><input type="text" id="survey_3_note"></td>
        </tr>
      </tbody>
    </table>

    <h3>3. ì˜ˆì •ê°€ê²© ì‚°ì¶œ</h3>
    <table>
      <tr>
        <th>ì‚°ì¶œê·¼ê±°</th>
        <td>
          <textarea id="calculation_basis" placeholder="ì˜ˆ: ë‚˜ë¼ì¥í„° ì‡¼í•‘ëª° ì¡°íšŒ ê²°ê³¼ ë° 2ê°œ ì—…ì²´ ê²¬ì ê°€ê²©ì„ ë¹„êµí•˜ì—¬ í‰ê· ê°€ê²©ìœ¼ë¡œ ì˜ˆì •ê°€ê²©ì„ ì‚°ì¶œí•˜ì˜€ìŒ."></textarea>
        </td>
      </tr>
    </table>

    <table>
      <tr>
        <th>ê³µê¸‰ê°€ì•¡</th>
        <td class="right"><input type="number" id="supply_price" placeholder="10000000" onchange="calcTotal()"> ì›</td>
        <th>ë¶€ê°€ê°€ì¹˜ì„¸</th>
        <td class="right"><input type="number" id="vat_price" placeholder="1000000" onchange="calcTotal()"> ì›</td>
      </tr>
      <tr>
        <th>ì˜ˆì •ê°€ê²©</th>
        <td colspan="3" class="total-price right">
          ì¼ê¸ˆ <input type="text" id="total_korean" style="width: 200px; text-align: center;" placeholder="ì¼ì²œì¼ë°±ë§Œ">ì›ì •
          (â‚©<input type="text" id="total_price" style="width: 120px; text-align: right;" placeholder="11,000,000">)
        </td>
      </tr>
    </table>

    <div class="date-area">
      <p>ìœ„ì™€ ê°™ì´ ì˜ˆì •ê°€ê²©ì„ ì‘ì„±í•©ë‹ˆë‹¤.</p>
      <p style="margin-top: 15px;">
        <input type="text" id="year" style="width: 60px; text-align: center;" placeholder="2026">ë…„
        <input type="text" id="month" style="width: 40px; text-align: center;" placeholder="2">ì›”
        <input type="text" id="day" style="width: 40px; text-align: center;" placeholder="2">ì¼
      </p>
    </div>

    <table class="signature-table">
      <tr>
        <th><input type="text" id="title_1" style="text-align: center; width: 100%; border: none; background: transparent; font-weight: bold;" value="ì‘ì„±"></th>
        <th><input type="text" id="title_2" style="text-align: center; width: 100%; border: none; background: transparent; font-weight: bold;" value="ê²€í† "></th>
        <th><input type="text" id="title_3" style="text-align: center; width: 100%; border: none; background: transparent; font-weight: bold;" value="ê²°ì¬"></th>
      </tr>
      <tr>
        <td><input type="text" id="sign_1" style="text-align: center;" placeholder="(ì¸)"></td>
        <td><input type="text" id="sign_2" style="text-align: center;" placeholder="(ì¸)"></td>
        <td><input type="text" id="sign_3" style="text-align: center;" placeholder="(ì¸)"></td>
      </tr>
    </table>

    <div class="help">
      <strong>ğŸ’¡ ì˜ˆì •ê°€ê²© ì‘ì„± ìœ ì˜ì‚¬í•­</strong>
      <ul style="margin: 8px 0; padding-left: 20px;">
        <li>ì˜ˆì •ê°€ê²©ì€ ê°ê´€ì  ìë£Œì— ê·¼ê±°í•˜ì—¬ ì ì •í•˜ê²Œ ì‘ì„±</li>
        <li>ê±°ë˜ì‹¤ë¡€ê°€ê²© ì¡°ì‚¬ ì‹œ 2ê°œì†Œ ì´ìƒ ì¡°ì‚¬ ê¶Œì¥</li>
        <li>ë²•ì ê·¼ê±°: ì§€ë°©ê³„ì•½ë²• ì‹œí–‰ë ¹ ì œ7ì¡° (ì˜ˆì •ê°€ê²©ì˜ ê²°ì •ê¸°ì¤€)</li>
        <li><strong>Wordì €ì¥</strong>: .docx íŒŒì¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤ (í•œê¸€ HWPì—ì„œ ì—´ê¸° ê°€ëŠ¥)</li>
      </ul>
    </div>
  </div>

  <div id="toast" class="toast"></div>

  <script src="https://unpkg.com/docx@8.5.0/build/index.umd.js"></script>
  <script>
    function formatNumber(num) {
      return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    function calcTotal() {
      const supply = parseInt(document.getElementById('supply_price').value) || 0;
      const vat = parseInt(document.getElementById('vat_price').value) || 0;
      const total = supply + vat;
      document.getElementById('total_price').value = formatNumber(total);
    }

    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = 'toast success show';
      setTimeout(() => toast.classList.remove('show'), 2000);
    }

    function getFormData() {
      const data = {};
      document.querySelectorAll('input, textarea').forEach(el => {
        if (el.id) {
          data[el.id] = el.type === 'checkbox' ? el.checked : el.value;
        }
      });
      return data;
    }

    function setFormData(data) {
      document.querySelectorAll('input, textarea').forEach(el => {
        if (el.id && data[el.id] !== undefined) {
          if (el.type === 'checkbox') el.checked = data[el.id];
          else el.value = data[el.id];
        }
      });
    }

    function saveForm() {
      localStorage.setItem('ì˜ˆì •ê°€ê²©ì¡°ì„œ', JSON.stringify(getFormData()));
      showToast('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
    }

    function loadForm() {
      const saved = localStorage.getItem('ì˜ˆì •ê°€ê²©ì¡°ì„œ');
      if (saved) {
        setFormData(JSON.parse(saved));
        showToast('ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!');
      } else {
        showToast('ì €ì¥ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
      }
    }

    function clearForm() {
      if (confirm('ëª¨ë“  ë‚´ìš©ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        const defaults = { title_1: 'ì‘ì„±', title_2: 'ê²€í† ', title_3: 'ê²°ì¬' };
        document.querySelectorAll('input, textarea').forEach(el => {
          if (el.type === 'checkbox') el.checked = false;
          else if (defaults[el.id]) el.value = defaults[el.id];
          else el.value = '';
        });
        showToast('ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
      }
    }

    async function downloadAsDocx() {
      const data = getFormData();
      const { Document, Packer, Paragraph, TextRun, AlignmentType } = docx;

      // ê³„ì•½êµ¬ë¶„ í…ìŠ¤íŠ¸
      let contractType = [];
      if (data.type_goods) contractType.push('ë¬¼í’ˆêµ¬ë§¤');
      if (data.type_service) contractType.push('ìš©ì—­');
      if (data.type_construction) contractType.push('ê³µì‚¬');

      // ê°€ê²©ì¡°ì‚¬ ë°©ë²•
      let priceMethods = [];
      if (data.price_method_1) priceMethods.push('ê±°ë˜ì‹¤ë¡€ê°€ê²©');
      if (data.price_method_2) priceMethods.push('ì›ê°€ê³„ì‚°');
      if (data.price_method_3) priceMethods.push('ê°ì •ê°€ê²©');
      if (data.price_method_4) priceMethods.push('ìœ ì‚¬ê±°ë˜ì‹¤ë¡€ê°€ê²©');
      if (data.price_method_5) priceMethods.push('ê²¬ì ê°€ê²©');

      // ê°€ê²©ì¡°ì‚¬ ë‚´ì—­
      const surveys = [];
      for (let i = 1; i <= 3; i++) {
        if (data[`survey_${i}_source`]) {
          surveys.push(new Paragraph({
            children: [new TextRun({
              text: `${i}. ${data[`survey_${i}_source`]} - ${formatNumber(data[`survey_${i}_price`] || 0)}ì› (${data[`survey_${i}_date`] || ''})`,
              size: 22
            })],
            spacing: { after: 100 }
          }));
        }
      }

      const doc = new Document({
        sections: [{
          properties: {},
          children: [
            new Paragraph({
              children: [new TextRun({ text: 'ì˜ˆì •ê°€ê²© ì¡°ì„œ', bold: true, size: 40 })],
              alignment: AlignmentType.CENTER,
              spacing: { after: 400 }
            }),
            new Paragraph({
              children: [new TextRun({ text: `ê³„ì•½ê±´ëª…: ${data.contract_name || ''}`, size: 24 })],
              spacing: { after: 200 }
            }),
            new Paragraph({
              children: [new TextRun({ text: `ê³„ì•½êµ¬ë¶„: ${contractType.join(', ') || '-'}`, size: 22 })],
              spacing: { after: 300 }
            }),
            new Paragraph({
              children: [new TextRun({ text: '1. ì˜ˆì •ê°€ê²© ì‘ì„±ë°©ë²•', bold: true, size: 24 })],
              spacing: { after: 200 }
            }),
            new Paragraph({
              children: [new TextRun({ text: priceMethods.join(', ') || '-', size: 22 })],
              spacing: { after: 300 }
            }),
            new Paragraph({
              children: [new TextRun({ text: '2. ê°€ê²©ì¡°ì‚¬ ë‚´ì—­', bold: true, size: 24 })],
              spacing: { after: 200 }
            }),
            ...surveys,
            new Paragraph({
              children: [new TextRun({ text: '', size: 22 })],
              spacing: { after: 200 }
            }),
            new Paragraph({
              children: [new TextRun({ text: '3. ì‚°ì¶œê·¼ê±°', bold: true, size: 24 })],
              spacing: { after: 200 }
            }),
            new Paragraph({
              children: [new TextRun({ text: data.calculation_basis || '', size: 22 })],
              spacing: { after: 300 }
            }),
            new Paragraph({
              children: [new TextRun({ text: '4. ì˜ˆì •ê°€ê²©', bold: true, size: 24 })],
              spacing: { after: 200 }
            }),
            new Paragraph({
              children: [new TextRun({ text: `ê³µê¸‰ê°€ì•¡: ${formatNumber(data.supply_price || 0)}ì›`, size: 22 })],
              spacing: { after: 100 }
            }),
            new Paragraph({
              children: [new TextRun({ text: `ë¶€ê°€ê°€ì¹˜ì„¸: ${formatNumber(data.vat_price || 0)}ì›`, size: 22 })],
              spacing: { after: 100 }
            }),
            new Paragraph({
              children: [new TextRun({ text: `ì˜ˆì •ê°€ê²©: ì¼ê¸ˆ ${data.total_korean || ''}ì›ì • (â‚©${data.total_price || '0'})`, bold: true, size: 26 })],
              spacing: { after: 400 }
            }),
            new Paragraph({
              children: [new TextRun({ text: 'ìœ„ì™€ ê°™ì´ ì˜ˆì •ê°€ê²©ì„ ì‘ì„±í•©ë‹ˆë‹¤.', size: 22 })],
              alignment: AlignmentType.CENTER,
              spacing: { after: 200 }
            }),
            new Paragraph({
              children: [new TextRun({ text: `${data.year || ''}ë…„ ${data.month || ''}ì›” ${data.day || ''}ì¼`, size: 22 })],
              alignment: AlignmentType.CENTER,
              spacing: { after: 400 }
            }),
            new Paragraph({
              children: [
                new TextRun({ text: `${data.title_1 || 'ì‘ì„±'}: ${data.sign_1 || '(ì¸)'}    `, size: 22 }),
                new TextRun({ text: `${data.title_2 || 'ê²€í† '}: ${data.sign_2 || '(ì¸)'}    `, size: 22 }),
                new TextRun({ text: `${data.title_3 || 'ê²°ì¬'}: ${data.sign_3 || '(ì¸)'}`, size: 22 })
              ],
              alignment: AlignmentType.RIGHT
            })
          ]
        }]
      });

      const blob = await Packer.toBlob(doc);
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `ì˜ˆì •ê°€ê²©ì¡°ì„œ_${data.contract_name || 'ì‘ì„±ì¤‘'}.docx`;
      a.click();
      URL.revokeObjectURL(url);
      showToast('Word íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!');
    }
  </script>
</body>
</html>
