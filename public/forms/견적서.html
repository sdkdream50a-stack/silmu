<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ê²¬ì ì„œ</title>
  <style>
    @page { size: A4; margin: 15mm; }
    * { box-sizing: border-box; }
    body { font-family: 'ë§‘ì€ ê³ ë”•', 'Malgun Gothic', sans-serif; font-size: 11pt; line-height: 1.5; margin: 0; padding: 0; background: #f5f5f5; }
    .toolbar { background: #059669; color: white; padding: 15px 20px; position: sticky; top: 0; z-index: 100; display: flex; justify-content: space-between; align-items: center; }
    .toolbar h2 { margin: 0; font-size: 16pt; }
    .toolbar-buttons { display: flex; gap: 10px; }
    .toolbar button { padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; font-size: 11pt; font-weight: 500; }
    .btn-save { background: #10b981; color: white; }
    .btn-load { background: #6366f1; color: white; }
    .btn-print { background: #f59e0b; color: white; }
    .btn-clear { background: #ef4444; color: white; }
    .btn-download { background: #8b5cf6; color: white; }
    .btn-calc { background: #3b82f6; color: white; }
    .container { max-width: 800px; margin: 20px auto; padding: 30px; background: white; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    h1 { text-align: center; font-size: 24pt; margin-bottom: 20px; letter-spacing: 15px; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 15px; }
    th, td { border: 1px solid #000; padding: 8px; }
    th { background-color: #f5f5f5; text-align: center; }
    input[type="text"], input[type="number"], input[type="date"] { width: 100%; border: none; background: #fffef0; padding: 4px; font-size: 11pt; font-family: inherit; }
    input:focus { outline: 2px solid #10b981; background: #fff; }
    .right { text-align: right; }
    .center { text-align: center; }
    .total-row { background-color: #ecfdf5; font-weight: bold; }
    .stamp-area { width: 70px; height: 70px; border: 1px dashed #999; text-align: center; line-height: 70px; color: #999; font-size: 9pt; margin: 0 auto; }
    .amount-display { font-size: 14pt; font-weight: bold; text-align: center; padding: 10px; background: #f0fdf4; }
    .toast { position: fixed; bottom: 20px; right: 20px; padding: 15px 25px; border-radius: 8px; color: white; font-weight: 500; opacity: 0; transition: opacity 0.3s; z-index: 1000; }
    .toast.show { opacity: 1; }
    .toast.success { background: #10b981; }
    .help { background-color: #f0f9ff; padding: 10px; margin-top: 15px; font-size: 9pt; border: 1px solid #bae6fd; border-radius: 6px; }
    @media print {
      .toolbar, .help { display: none !important; }
      body { background: white; }
      .container { box-shadow: none; margin: 0; padding: 15px; }
      input { background: transparent !important; }
    }
  </style>
</head>
<body>
  <div class="toolbar">
    <h2>ê²¬ì ì„œ</h2>
    <div class="toolbar-buttons">
      <button class="btn-calc" onclick="calculateTotal()">ğŸ§® ìë™ê³„ì‚°</button>
      <button class="btn-save" onclick="saveForm()">ğŸ’¾ ì €ì¥</button>
      <button class="btn-load" onclick="loadForm()">ğŸ“‚ ë¶ˆëŸ¬ì˜¤ê¸°</button>
      <button class="btn-download" onclick="downloadAsDocx()">â¬‡ï¸ Wordì €ì¥ (í•œê¸€ í˜¸í™˜)</button>
      <button class="btn-print" onclick="window.print()">ğŸ–¨ï¸ ì¸ì‡„/PDF</button>
      <button class="btn-clear" onclick="clearForm()">ğŸ—‘ï¸ ì´ˆê¸°í™”</button>
    </div>
  </div>

  <div class="container">
    <h1>ê²¬ ì  ì„œ</h1>

    <div style="text-align: right; margin-bottom: 15px;">
      ê²¬ì ì¼ì: <input type="date" id="quote_date" style="width: 150px;">
    </div>

    <table>
      <tr>
        <th rowspan="4" style="width: 50px;">ê³µ<br>ê¸‰<br>ì</th>
        <th style="width: 100px;">ìƒí˜¸</th>
        <td><input type="text" id="company_name" placeholder="(ì£¼)OOìƒì‚¬"></td>
        <th style="width: 70px;">ëŒ€í‘œì</th>
        <td style="width: 120px;"><input type="text" id="ceo_name" placeholder="í™ê¸¸ë™"></td>
        <td rowspan="4" style="width: 80px; vertical-align: middle;">
          <div class="stamp-area">(ì¸)</div>
        </td>
      </tr>
      <tr>
        <th>ì‚¬ì—…ìë²ˆí˜¸</th>
        <td><input type="text" id="biz_number" placeholder="123-45-67890"></td>
        <th>ì—°ë½ì²˜</th>
        <td><input type="text" id="phone" placeholder="02-1234-5678"></td>
      </tr>
      <tr>
        <th>ì£¼ì†Œ</th>
        <td colspan="3"><input type="text" id="address" placeholder="ì„œìš¸ì‹œ OOêµ¬ OOë¡œ 123"></td>
      </tr>
      <tr>
        <th>ì—…íƒœ/ì¢…ëª©</th>
        <td><input type="text" id="business_type" placeholder="ë„ì†Œë§¤/ì‚¬ë¬´ìš©í’ˆ"></td>
        <th>ì´ë©”ì¼</th>
        <td><input type="text" id="email" placeholder="email@company.com"></td>
      </tr>
    </table>

    <table>
      <tr>
        <th style="width: 80px;">ìˆ˜ì‹ </th>
        <td><input type="text" id="recipient" placeholder="OOì‹œì²­ ì´ë¬´ê³¼"></td>
      </tr>
      <tr>
        <th>ê±´ëª…</th>
        <td><input type="text" id="project_name" placeholder="2026ë…„ë„ ì‚¬ë¬´ìš©í’ˆ êµ¬ë§¤"></td>
      </tr>
    </table>

    <p style="text-align: center; font-size: 12pt; margin: 15px 0;">ì•„ë˜ì™€ ê°™ì´ ê²¬ì í•©ë‹ˆë‹¤.</p>

    <table>
      <tr>
        <th style="width: 100px;">ê²¬ì ê¸ˆì•¡</th>
        <td class="amount-display" id="total_display">ì¼ê¸ˆ                    ì›ì • (â‚©0)</td>
      </tr>
      <tr>
        <th>ë‚©í’ˆê¸°í•œ</th>
        <td>ê³„ì•½ ì²´ê²°ì¼ë¡œë¶€í„° <input type="text" id="delivery_days" style="width: 50px; text-align: center;" placeholder="7">ì¼ ì´ë‚´</td>
      </tr>
      <tr>
        <th>ê²¬ì ìœ íš¨ê¸°ê°„</th>
        <td>ê²¬ì ì¼ë¡œë¶€í„° <input type="text" id="valid_days" style="width: 50px; text-align: center;" placeholder="30">ì¼ê°„</td>
      </tr>
      <tr>
        <th>ê²°ì œì¡°ê±´</th>
        <td>
          <label><input type="checkbox" id="payment_1"> ë‚©í’ˆ í›„ í˜„ê¸ˆ</label>&nbsp;&nbsp;
          <label><input type="checkbox" id="payment_2"> ì„ ê¸ˆ+ì”ê¸ˆ</label>&nbsp;&nbsp;
          <label><input type="checkbox" id="payment_etc"> ê¸°íƒ€: <input type="text" id="payment_etc_text" style="width: 150px;"></label>
        </td>
      </tr>
    </table>

    <table id="item-table">
      <thead>
        <tr>
          <th style="width: 35px;">No</th>
          <th>í’ˆëª… ë° ê·œê²©</th>
          <th style="width: 50px;">ë‹¨ìœ„</th>
          <th style="width: 50px;">ìˆ˜ëŸ‰</th>
          <th style="width: 90px;">ë‹¨ê°€</th>
          <th style="width: 100px;">ê¸ˆì•¡</th>
          <th style="width: 70px;">ë¹„ê³ </th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td class="center">1</td>
          <td><input type="text" id="item_1_name"></td>
          <td><input type="text" id="item_1_unit" class="center" placeholder="EA"></td>
          <td><input type="number" id="item_1_qty" class="center" onchange="calculateRow(1)"></td>
          <td><input type="number" id="item_1_price" class="right" onchange="calculateRow(1)"></td>
          <td class="right" id="item_1_amount">0</td>
          <td><input type="text" id="item_1_note"></td>
        </tr>
        <tr>
          <td class="center">2</td>
          <td><input type="text" id="item_2_name"></td>
          <td><input type="text" id="item_2_unit" class="center"></td>
          <td><input type="number" id="item_2_qty" class="center" onchange="calculateRow(2)"></td>
          <td><input type="number" id="item_2_price" class="right" onchange="calculateRow(2)"></td>
          <td class="right" id="item_2_amount">0</td>
          <td><input type="text" id="item_2_note"></td>
        </tr>
        <tr>
          <td class="center">3</td>
          <td><input type="text" id="item_3_name"></td>
          <td><input type="text" id="item_3_unit" class="center"></td>
          <td><input type="number" id="item_3_qty" class="center" onchange="calculateRow(3)"></td>
          <td><input type="number" id="item_3_price" class="right" onchange="calculateRow(3)"></td>
          <td class="right" id="item_3_amount">0</td>
          <td><input type="text" id="item_3_note"></td>
        </tr>
        <tr>
          <td class="center">4</td>
          <td><input type="text" id="item_4_name"></td>
          <td><input type="text" id="item_4_unit" class="center"></td>
          <td><input type="number" id="item_4_qty" class="center" onchange="calculateRow(4)"></td>
          <td><input type="number" id="item_4_price" class="right" onchange="calculateRow(4)"></td>
          <td class="right" id="item_4_amount">0</td>
          <td><input type="text" id="item_4_note"></td>
        </tr>
        <tr>
          <td class="center">5</td>
          <td><input type="text" id="item_5_name"></td>
          <td><input type="text" id="item_5_unit" class="center"></td>
          <td><input type="number" id="item_5_qty" class="center" onchange="calculateRow(5)"></td>
          <td><input type="number" id="item_5_price" class="right" onchange="calculateRow(5)"></td>
          <td class="right" id="item_5_amount">0</td>
          <td><input type="text" id="item_5_note"></td>
        </tr>
      </tbody>
      <tfoot>
        <tr class="total-row">
          <td colspan="5" class="right">ê³µê¸‰ê°€ì•¡</td>
          <td class="right" id="subtotal">0</td>
          <td></td>
        </tr>
        <tr class="total-row">
          <td colspan="5" class="right">ë¶€ê°€ê°€ì¹˜ì„¸ (10%)</td>
          <td class="right" id="vat">0</td>
          <td></td>
        </tr>
        <tr class="total-row">
          <td colspan="5" class="right" style="font-size: 12pt;">ì´ ê²¬ì ê¸ˆì•¡</td>
          <td class="right" style="font-size: 12pt;" id="grand_total">0</td>
          <td></td>
        </tr>
      </tfoot>
    </table>

    <div class="help">
      <strong>ğŸ’¡ ì‚¬ìš© ë°©ë²•</strong>
      <ul style="margin: 5px 0; padding-left: 20px;">
        <li>í’ˆëª©ë³„ ìˆ˜ëŸ‰ê³¼ ë‹¨ê°€ë¥¼ ì…ë ¥í•˜ë©´ ìë™ìœ¼ë¡œ ê¸ˆì•¡ì´ ê³„ì‚°ë©ë‹ˆë‹¤.</li>
        <li><strong>ìë™ê³„ì‚°</strong> ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ í•©ê³„ê°€ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.</li>
        <li><strong>ì¸ì‡„/PDF</strong>ë¡œ ê¹”ë”í•˜ê²Œ ì¶œë ¥í•˜ê±°ë‚˜ PDF ì €ì¥ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</li>
        <li><strong>Wordì €ì¥</strong>ìœ¼ë¡œ .docx íŒŒì¼ ë‹¤ìš´ë¡œë“œ (í•œê¸€ì—ì„œë„ ì—´ê¸° ê°€ëŠ¥)</li>
      </ul>
    </div>
  </div>

  <div id="toast" class="toast"></div>

  <script src="https://unpkg.com/docx@8.5.0/build/index.umd.js"></script>
  <script>
    function formatNumber(num) {
      return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    function numberToKorean(num) {
      const units = ['', 'ë§Œ', 'ì–µ', 'ì¡°'];
      const smallUnits = ['', 'ì‹­', 'ë°±', 'ì²œ'];
      const nums = ['', 'ì¼', 'ì´', 'ì‚¼', 'ì‚¬', 'ì˜¤', 'ìœ¡', 'ì¹ ', 'íŒ”', 'êµ¬'];

      if (num === 0) return 'ì˜';

      let result = '';
      let unitIndex = 0;

      while (num > 0) {
        let part = num % 10000;
        if (part > 0) {
          let partStr = '';
          let smallIndex = 0;
          while (part > 0) {
            let digit = part % 10;
            if (digit > 0) {
              partStr = nums[digit] + smallUnits[smallIndex] + partStr;
            }
            part = Math.floor(part / 10);
            smallIndex++;
          }
          result = partStr + units[unitIndex] + result;
        }
        num = Math.floor(num / 10000);
        unitIndex++;
      }

      return result;
    }

    function calculateRow(row) {
      const qty = parseInt(document.getElementById(`item_${row}_qty`).value) || 0;
      const price = parseInt(document.getElementById(`item_${row}_price`).value) || 0;
      const amount = qty * price;
      document.getElementById(`item_${row}_amount`).textContent = formatNumber(amount);
      calculateTotal();
    }

    function calculateTotal() {
      let subtotal = 0;
      for (let i = 1; i <= 5; i++) {
        const qty = parseInt(document.getElementById(`item_${i}_qty`).value) || 0;
        const price = parseInt(document.getElementById(`item_${i}_price`).value) || 0;
        subtotal += qty * price;
      }

      const vat = Math.round(subtotal * 0.1);
      const total = subtotal + vat;

      document.getElementById('subtotal').textContent = formatNumber(subtotal);
      document.getElementById('vat').textContent = formatNumber(vat);
      document.getElementById('grand_total').textContent = formatNumber(total);
      document.getElementById('total_display').textContent =
        `ì¼ê¸ˆ ${numberToKorean(total)}ì›ì • (â‚©${formatNumber(total)})`;

      showToast('ê³„ì‚° ì™„ë£Œ!', 'success');
    }

    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = `toast ${type} show`;
      setTimeout(() => toast.classList.remove('show'), 2000);
    }

    function getFormData() {
      const data = {};
      document.querySelectorAll('input').forEach(el => {
        if (el.id) {
          data[el.id] = el.type === 'checkbox' ? el.checked : el.value;
        }
      });
      // ê³„ì‚°ëœ ê°’ë„ ì €ì¥
      data.subtotal = document.getElementById('subtotal').textContent;
      data.vat = document.getElementById('vat').textContent;
      data.grand_total = document.getElementById('grand_total').textContent;
      return data;
    }

    function setFormData(data) {
      document.querySelectorAll('input').forEach(el => {
        if (el.id && data[el.id] !== undefined) {
          if (el.type === 'checkbox') el.checked = data[el.id];
          else el.value = data[el.id];
        }
      });
      if (data.subtotal) document.getElementById('subtotal').textContent = data.subtotal;
      if (data.vat) document.getElementById('vat').textContent = data.vat;
      if (data.grand_total) document.getElementById('grand_total').textContent = data.grand_total;
      calculateTotal();
    }

    function saveForm() {
      localStorage.setItem('ê²¬ì ì„œ', JSON.stringify(getFormData()));
      showToast('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
    }

    function loadForm() {
      const saved = localStorage.getItem('ê²¬ì ì„œ');
      if (saved) {
        setFormData(JSON.parse(saved));
        showToast('ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!');
      } else {
        showToast('ì €ì¥ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
      }
    }

    function clearForm() {
      if (confirm('ëª¨ë“  ë‚´ìš©ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        document.querySelectorAll('input').forEach(el => {
          if (el.type === 'checkbox') el.checked = false;
          else el.value = '';
        });
        for (let i = 1; i <= 5; i++) {
          document.getElementById(`item_${i}_amount`).textContent = '0';
        }
        document.getElementById('subtotal').textContent = '0';
        document.getElementById('vat').textContent = '0';
        document.getElementById('grand_total').textContent = '0';
        document.getElementById('total_display').textContent = 'ì¼ê¸ˆ                    ì›ì • (â‚©0)';
        showToast('ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
      }
    }

    async function downloadAsDocx() {
      const data = getFormData();
      const { Document, Packer, Paragraph, TextRun, Table, TableRow, TableCell, WidthType, AlignmentType } = docx;

      // í’ˆëª© ë‚´ì—­ ìƒì„±
      const items = [];
      for (let i = 1; i <= 5; i++) {
        const name = data[`item_${i}_name`];
        if (name) {
          const qty = data[`item_${i}_qty`] || 0;
          const unit = data[`item_${i}_unit`] || 'EA';
          const price = data[`item_${i}_price`] || 0;
          const amount = parseInt(qty) * parseInt(price);
          items.push(new Paragraph({
            children: [new TextRun({ text: `${i}. ${name} - ${qty}${unit} Ã— ${formatNumber(price)}ì› = ${formatNumber(amount)}ì›`, size: 22 })],
            spacing: { after: 100 }
          }));
        }
      }

      const doc = new Document({
        sections: [{
          properties: {},
          children: [
            new Paragraph({
              children: [new TextRun({ text: 'ê²¬ ì  ì„œ', bold: true, size: 48 })],
              alignment: AlignmentType.CENTER,
              spacing: { after: 400 }
            }),
            new Paragraph({
              children: [new TextRun({ text: `ê²¬ì ì¼ì: ${data.quote_date || ''}`, size: 22 })],
              alignment: AlignmentType.RIGHT,
              spacing: { after: 300 }
            }),
            new Paragraph({
              children: [new TextRun({ text: '[ê³µê¸‰ì ì •ë³´]', bold: true, size: 24 })],
              spacing: { after: 200 }
            }),
            new Paragraph({
              children: [new TextRun({ text: `ìƒí˜¸: ${data.company_name || ''}  ëŒ€í‘œì: ${data.ceo_name || ''}`, size: 22 })],
              spacing: { after: 100 }
            }),
            new Paragraph({
              children: [new TextRun({ text: `ì‚¬ì—…ìë²ˆí˜¸: ${data.biz_number || ''}  ì—°ë½ì²˜: ${data.phone || ''}`, size: 22 })],
              spacing: { after: 100 }
            }),
            new Paragraph({
              children: [new TextRun({ text: `ì£¼ì†Œ: ${data.address || ''}`, size: 22 })],
              spacing: { after: 300 }
            }),
            new Paragraph({
              children: [new TextRun({ text: `ìˆ˜ì‹ : ${data.recipient || ''}`, size: 22 })],
              spacing: { after: 100 }
            }),
            new Paragraph({
              children: [new TextRun({ text: `ê±´ëª…: ${data.project_name || ''}`, size: 22 })],
              spacing: { after: 300 }
            }),
            new Paragraph({
              children: [new TextRun({ text: 'ì•„ë˜ì™€ ê°™ì´ ê²¬ì í•©ë‹ˆë‹¤.', size: 22 })],
              alignment: AlignmentType.CENTER,
              spacing: { after: 300 }
            }),
            new Paragraph({
              children: [new TextRun({ text: '[í’ˆëª© ë‚´ì—­]', bold: true, size: 24 })],
              spacing: { after: 200 }
            }),
            ...items,
            new Paragraph({
              children: [new TextRun({ text: '', size: 22 })],
              spacing: { after: 200 }
            }),
            new Paragraph({
              children: [new TextRun({ text: `ê³µê¸‰ê°€ì•¡: ${data.subtotal || '0'}ì›`, size: 22 })],
              spacing: { after: 100 }
            }),
            new Paragraph({
              children: [new TextRun({ text: `ë¶€ê°€ê°€ì¹˜ì„¸(10%): ${data.vat || '0'}ì›`, size: 22 })],
              spacing: { after: 100 }
            }),
            new Paragraph({
              children: [new TextRun({ text: `ì´ ê²¬ì ê¸ˆì•¡: ${data.grand_total || '0'}ì›`, bold: true, size: 26 })],
              spacing: { after: 300 }
            }),
            new Paragraph({
              children: [new TextRun({ text: `ë‚©í’ˆê¸°í•œ: ê³„ì•½ ì²´ê²°ì¼ë¡œë¶€í„° ${data.delivery_days || '7'}ì¼ ì´ë‚´`, size: 22 })],
              spacing: { after: 100 }
            }),
            new Paragraph({
              children: [new TextRun({ text: `ê²¬ì ìœ íš¨ê¸°ê°„: ê²¬ì ì¼ë¡œë¶€í„° ${data.valid_days || '30'}ì¼ê°„`, size: 22 })]
            })
          ]
        }]
      });

      const blob = await Packer.toBlob(doc);
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `ê²¬ì ì„œ_${data.project_name || 'ì‘ì„±ì¤‘'}.docx`;
      a.click();
      URL.revokeObjectURL(url);
      showToast('Word íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!');
    }
  </script>
</body>
</html>
