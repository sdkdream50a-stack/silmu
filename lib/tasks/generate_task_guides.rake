namespace :task_guides do
  desc "ê¸°ë³¸ ì—…ë¬´ 80ì—¬ê°œì˜ AI í”„ë¡œì„¸ìŠ¤ ê°€ì´ë“œ ì¼ê´„ ìƒì„±"
  task generate_all: :environment do
    unless ENV["ANTHROPIC_API_KEY"].present?
      puts "âŒ ANTHROPIC_API_KEY í™˜ê²½ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."
      exit 1
    end

    # ì—…ë¬´ë‹¬ë ¥ ê¸°ë³¸ ì—…ë¬´ ëª©ë¡
    tasks = [
      { title: "ì›ì²œì„¸ ì‹ ê³ Â·ë‚©ë¶€", cat: "ì„¸ë¬´" },
      { title: "4ëŒ€ë³´í—˜ë£Œ ë‚©ë¶€", cat: "ë³´í—˜" },
      { title: "ê¸‰ì—¬ ì§€ê¸‰ ì¤€ë¹„ (ê³µì œë‚´ì—­ í™•ì¸)", cat: "ê¸‰ì—¬" },
      { title: "ê¸‰ì—¬ ì§€ê¸‰ ì¤€ë¹„", cat: "ê¸‰ì—¬" },
      { title: "ê¸‰ì—¬ ì§€ê¸‰", cat: "ê¸‰ì—¬" },
      { title: "ì¼ìš©ê·¼ë¡œì†Œë“ ì§€ê¸‰ëª…ì„¸ì„œ ì œì¶œ", cat: "ë³´ê³ " },
      { title: "ì—°ë§ì •ì‚° ê°„ì†Œí™” ìë£Œ í™•ì¸Â·ì œì¶œ", cat: "ì„¸ë¬´" },
      { title: "ì „ë…„ë„ ì„¸ì…Â·ì„¸ì¶œ ê²°ì‚° ë§ˆê°", cat: "íšŒê³„" },
      { title: "ê±´ê°•ë³´í—˜ ì •ì‚°(ë³´ìˆ˜ì´ì•¡ ì‹ ê³ )", cat: "ë³´í—˜" },
      { title: "ì—°ë§ì •ì‚° í™˜ê¸‰Â·ì¶”ì§• ì²˜ë¦¬", cat: "ì„¸ë¬´" },
      { title: "4ëŒ€ë³´í—˜ ì‚¬ì—…ì¥í˜„í™© ì‹ ê³ ", cat: "ë³´ê³ " },
      { title: "ì„¸ì… ì„¸ì¶œ ì˜ˆì‚° ê´€ë ¨", cat: "ì„œë¬´" },
      { title: "ê·¼ë¡œì†Œë“ ì§€ê¸‰ëª…ì„¸ì„œ ì œì¶œ", cat: "ë³´ê³ " },
      { title: "ê³ ìš©Â·ì‚°ì¬ë³´í—˜ ë³´ìˆ˜ì´ì•¡ ì‹ ê³ ", cat: "ë³´í—˜" },
      { title: "1ë¶„ê¸° ê²°ì‚° ì¤€ë¹„", cat: "íšŒê³„" },
      { title: "ê±´ê°•ë³´í—˜ ì—°ë§ì •ì‚° ë³´í—˜ë£Œ ë°˜ì˜", cat: "ë³´í—˜" },
      { title: "ìƒë°˜ê¸° ë¬¼í’ˆêµ¬ë§¤ê³„íš ì ê²€", cat: "ì„œë¬´" },
      { title: "ì§€ë°©ì„¸ ë‚©ë¶€(ë©´í—ˆì„¸ ë“±)", cat: "ì„¸ë¬´" },
      { title: "1ë¶„ê¸° ì—…ë¬´ ì‹¤ì  ë³´ê³ ", cat: "ë³´ê³ " },
      { title: "ë§ì¶¤í˜•ë³µì§€ ìƒë°˜ê¸° ì‚¬ìš© ì ê²€", cat: "ë³µì§€" },
      { title: "ì¢…í•©ì†Œë“ì„¸ ì‹ ê³ (í•´ë‹¹ ì‹œ)", cat: "ì„¸ë¬´" },
      { title: "ìƒë°˜ê¸° ê³„ì•½ ì§‘í–‰ í˜„í™© ë³´ê³ ", cat: "ë³´ê³ " },
      { title: "ìƒë°˜ê¸°(2ë¶„ê¸°) ê²°ì‚°", cat: "íšŒê³„" },
      { title: "í•˜ë°˜ê¸° ì—…ë¬´ê³„íš ìˆ˜ë¦½", cat: "ì„œë¬´" },
      { title: "ì¬ì‚°ì„¸ ë‚©ë¶€(ê±´ì¶•ë¬¼)", cat: "ì„¸ë¬´" },
      { title: "ê±´ê°•ë³´í—˜ ë³´ìˆ˜ì›”ì•¡ ë³€ê²½ì‹ ê³ ", cat: "ë³´í—˜" },
      { title: "ìƒë°˜ê¸° ì—…ë¬´ ì‹¤ì  ë³´ê³ ", cat: "ë³´ê³ " },
      { title: "ì£¼ë¯¼ì„¸(ì‚¬ì—…ì†Œë¶„) ì‹ ê³ Â·ë‚©ë¶€", cat: "ì„¸ë¬´" },
      { title: "í•˜ë°˜ê¸° ë¬¼í’ˆêµ¬ë§¤ê³„íš ì ê²€", cat: "ì„œë¬´" },
      { title: "ì¬ì‚°ì„¸ ë‚©ë¶€(í† ì§€)", cat: "ì„¸ë¬´" },
      { title: "2ë¶„ê¸° ì—…ë¬´ ì‹¤ì  ë³´ê³ ", cat: "ë³´ê³ " },
      { title: "ë§ì¶¤í˜•ë³µì§€ í•˜ë°˜ê¸° ì‚¬ìš© ì ê²€", cat: "ë³µì§€" },
      { title: "í•˜ë°˜ê¸° ë³´í—˜ë£Œ ì •ì‚° ì¤€ë¹„", cat: "ë³´í—˜" },
      { title: "3ë¶„ê¸° ì—…ë¬´ ì‹¤ì  ë³´ê³ ", cat: "ë³´ê³ " },
      { title: "3ë¶„ê¸° ê²°ì‚° ì¤€ë¹„", cat: "íšŒê³„" },
      { title: "ì—°ë§ì •ì‚° ì‚¬ì „ ì•ˆë‚´", cat: "ì„¸ë¬´" },
      { title: "4ëŒ€ë³´í—˜ ì—°ë§ ì •ì‚° ì¤€ë¹„", cat: "ë³´í—˜" },
      { title: "ë§ì¶¤í˜•ë³µì§€ ì”ì—¬í¬ì¸íŠ¸ ì†Œì§„ ì•ˆë‚´", cat: "ë³µì§€" },
      { title: "í•˜ë°˜ê¸° ì—…ë¬´ ì‹¤ì  ë³´ê³ ", cat: "ë³´ê³ " },
      { title: "ì—°ê°„ ê²°ì‚°Â·ë§ˆê° ì¤€ë¹„", cat: "íšŒê³„" },
      { title: "ë‹¤ìŒì—°ë„ ì˜ˆì‚° ìš”êµ¬ì„œ ì‘ì„±", cat: "íšŒê³„" },
    ].uniq { |t| t[:title] }

    service = TaskGuideService.new
    total = tasks.size
    skipped = 0
    generated = 0
    failed = 0

    tasks.each_with_index do |task, idx|
      existing = TaskGuide.find_by(task_title: task[:title])
      if existing&.completed?
        skipped += 1
        puts "â­ï¸  [#{idx + 1}/#{total}] #{task[:title]} â€” ì´ë¯¸ ìƒì„±ë¨"
        next
      end

      print "ğŸ”„ [#{idx + 1}/#{total}] #{task[:title]}..."
      guide = service.generate(task[:title], task[:cat])

      if guide&.completed?
        generated += 1
        puts " âœ… ì™„ë£Œ"
      else
        failed += 1
        puts " âŒ ì‹¤íŒ¨"
      end

      sleep 0.5  # Rate limit ë°©ì§€
    end

    puts "\nğŸ“Š ê²°ê³¼: ì´ #{total}ê±´ ì¤‘ ìƒì„± #{generated}ê±´, ê±´ë„ˆëœ€ #{skipped}ê±´, ì‹¤íŒ¨ #{failed}ê±´"
  end
end
