<%# 업무 가이드 목록 페이지 - 프리미엄 디자인 시스템 %>

<!-- 페이지 헤더 -->
<section class="gradient-forest text-white py-12 lg:py-16">
  <div class="container-wide">
    <div class="flex items-start gap-5">
      <div class="w-16 h-16 bg-white/10 backdrop-blur-md rounded-2xl flex items-center justify-center border border-white/20 shadow-lg">
        <span class="material-symbols-outlined text-4xl text-white">menu_book</span>
      </div>
      <div>
        <h1 class="text-3xl lg:text-4xl font-bold tracking-tight mb-2">업무 가이드</h1>
        <p class="text-forest-100 text-lg">공무원 업무 처리에 필요한 단계별 가이드</p>
      </div>
    </div>
  </div>
</section>

<!-- 검색 및 필터 -->
<section class="bg-white/80 backdrop-blur-xl border-b border-gray-100 sticky top-16 z-40 shadow-soft">
  <div class="container-wide py-4">
    <!-- 검색바 -->
    <div class="flex items-center bg-surface-100 rounded-xl overflow-hidden mb-4">
      <div class="flex items-center justify-center pl-4 text-navy-400">
        <span class="material-symbols-outlined">search</span>
      </div>
      <input type="text" id="search-input" placeholder="가이드 검색" class="w-full border-none focus:ring-0 bg-transparent py-3 px-3 text-navy-800 placeholder:text-navy-400">
    </div>

    <!-- 카테고리 필터 -->
    <div class="flex flex-wrap gap-2" id="category-tabs">
      <button data-category="전체" class="tab-btn active px-5 py-2.5 bg-forest-600 text-white rounded-xl text-sm font-semibold shadow-md transition-all">전체</button>
      <button data-category="계약" class="tab-btn px-5 py-2.5 bg-surface-100 text-navy-600 hover:bg-surface-200 rounded-xl text-sm font-medium transition-all">계약</button>
      <button data-category="예산" class="tab-btn px-5 py-2.5 bg-surface-100 text-navy-600 hover:bg-surface-200 rounded-xl text-sm font-medium transition-all">예산</button>
      <button data-category="인사" class="tab-btn px-5 py-2.5 bg-surface-100 text-navy-600 hover:bg-surface-200 rounded-xl text-sm font-medium transition-all">인사</button>
      <button data-category="복무" class="tab-btn px-5 py-2.5 bg-surface-100 text-navy-600 hover:bg-surface-200 rounded-xl text-sm font-medium transition-all">복무</button>
      <button data-category="민원" class="tab-btn px-5 py-2.5 bg-surface-100 text-navy-600 hover:bg-surface-200 rounded-xl text-sm font-medium transition-all">민원</button>
    </div>
  </div>
</section>

<section class="section py-10">
  <div class="container-wide">
    <div class="lg:flex lg:gap-10">
      <!-- 메인 콘텐츠 -->
      <div class="lg:w-[70%]">
        <div class="flex items-center justify-between mb-6">
          <p class="text-navy-600">총 <span class="font-bold text-navy-900" id="item-count">6</span>개의 가이드</p>
          <select class="border-gray-200 rounded-xl text-sm focus:ring-forest-500 focus:border-forest-500 px-4 py-2">
            <option>최신순</option>
            <option>인기순</option>
          </select>
        </div>

        <div class="space-y-4" id="items-list">
          <% [
            { id: 1, title: "물품 구매 및 검수 절차 가이드", summary: "물품 구매부터 검수, 대금 지급까지 전체 절차를 단계별로 설명합니다.", category: "계약", date: "2026.02.01", views: 42, tag: "신규" },
            { id: 4, title: "수의계약 체결 실무 가이드", summary: "수의계약의 요건, 절차, 주의사항을 상세히 안내합니다.", category: "계약", date: "2026.01.28", views: 38, tag: "신규" },
            { id: 5, title: "출장 여비 청구 가이드", summary: "국내/국외 출장 시 여비 청구 방법과 증빙 서류 안내", category: "예산", date: "2026.01.25", views: 27, tag: nil },
            { id: 6, title: "연가 사용 및 관리 가이드", summary: "연가일수 계산, 사용 절차, 미사용 연가 처리 방법", category: "복무", date: "2026.01.22", views: 19, tag: nil },
            { id: 7, title: "민원 응대 매뉴얼", summary: "민원인 응대 시 주의사항 및 처리 절차 안내", category: "민원", date: "2026.01.20", views: 15, tag: nil },
            { id: 8, title: "예산 이월 실무 가이드", summary: "명시이월, 사고이월, 계속비이월의 요건과 절차", category: "예산", date: "2026.01.18", views: 12, tag: nil },
          ].each do |guide| %>
            <%= link_to guide_path(guide[:id]), class: "block card card-hover p-6 group item-card", data: { category: guide[:category], title: guide[:title] } do %>
              <div class="flex items-start justify-between mb-3">
                <span class="badge badge-forest"><%= guide[:category] %></span>
                <% if guide[:tag] %>
                  <span class="badge <%= guide[:tag] == '인기' ? 'badge-warm' : guide[:tag] == '업데이트' ? 'badge-point' : 'badge-navy' %>"><%= guide[:tag] %></span>
                <% end %>
              </div>
              <h3 class="text-lg font-bold text-navy-900 mb-2 group-hover:text-forest-600 transition-colors"><%= guide[:title] %></h3>
              <p class="text-navy-600 text-sm mb-4 leading-relaxed"><%= guide[:summary] %></p>
              <div class="flex items-center gap-4 text-xs text-navy-400">
                <span class="flex items-center gap-1">
                  <span class="material-symbols-outlined text-sm">calendar_today</span>
                  <%= guide[:date] %>
                </span>
                <span class="flex items-center gap-1">
                  <span class="material-symbols-outlined text-sm">visibility</span>
                  <%= number_with_delimiter(guide[:views]) %>
                </span>
              </div>
            <% end %>
          <% end %>
        </div>

        <!-- 페이지네이션 -->
        <div class="flex justify-center mt-12">
          <nav class="flex items-center gap-2">
            <button onclick="alert('이전 페이지가 없습니다.')" class="w-10 h-10 flex items-center justify-center rounded-xl text-navy-400 hover:bg-surface-100 transition-colors">
              <span class="material-symbols-outlined">chevron_left</span>
            </button>
            <button class="w-10 h-10 flex items-center justify-center rounded-xl bg-forest-600 text-white font-semibold shadow-md cursor-default">1</button>
            <button onclick="alert('페이지네이션 기능은 준비 중입니다.')" class="w-10 h-10 flex items-center justify-center rounded-xl text-navy-600 hover:bg-surface-100 font-medium transition-colors">2</button>
            <button onclick="alert('페이지네이션 기능은 준비 중입니다.')" class="w-10 h-10 flex items-center justify-center rounded-xl text-navy-600 hover:bg-surface-100 font-medium transition-colors">3</button>
            <button onclick="alert('페이지네이션 기능은 준비 중입니다.')" class="w-10 h-10 flex items-center justify-center rounded-xl text-navy-400 hover:bg-surface-100 transition-colors">
              <span class="material-symbols-outlined">chevron_right</span>
            </button>
          </nav>
        </div>
      </div>

      <!-- 사이드바 -->
      <div class="lg:w-[30%] mt-10 lg:mt-0">
        <div class="sticky top-36 space-y-6">
          <!-- 사전 체크리스트 배너 -->
          <%= link_to pre_contract_checklist_path, class: "block card card-interactive overflow-hidden group" do %>
            <div class="gradient-forest p-5 text-white">
              <div class="flex items-center gap-3 mb-2">
                <span class="material-symbols-outlined text-2xl">checklist_rtl</span>
                <span class="font-bold">사전 체크리스트</span>
              </div>
              <p class="text-white/80 text-sm">계약 전 필수 확인사항을 단계별로 점검</p>
              <div class="mt-3 text-xs text-white/60 flex items-center gap-1 group-hover:text-white transition-colors">
                바로가기
                <span class="material-symbols-outlined text-sm group-hover:translate-x-1 transition-transform">arrow_forward</span>
              </div>
            </div>
          <% end %>

          <!-- 계약 흐름도 배너 -->
          <%= link_to contract_flow_path, class: "block card card-interactive overflow-hidden group" do %>
            <div class="gradient-navy p-5 text-white">
              <div class="flex items-center gap-3 mb-2">
                <span class="material-symbols-outlined text-2xl">account_tree</span>
                <span class="font-bold">계약 흐름도</span>
              </div>
              <p class="text-white/80 text-sm">물품/용역/공사 계약 전체 프로세스를 한눈에</p>
              <div class="mt-3 text-xs text-white/60 flex items-center gap-1 group-hover:text-white transition-colors">
                자세히 보기
                <span class="material-symbols-outlined text-sm group-hover:translate-x-1 transition-transform">arrow_forward</span>
              </div>
            </div>
          <% end %>

          <!-- 자료실 배너 -->
          <%= link_to guide_resources_path, class: "block card card-interactive overflow-hidden group" do %>
            <div class="gradient-point p-5 text-white">
              <div class="flex items-center gap-3 mb-2">
                <span class="material-symbols-outlined text-2xl">library_books</span>
                <span class="font-bold">자료실 / FAQ</span>
              </div>
              <p class="text-white/80 text-sm">판례해설, 유권해석, 자주 묻는 질문</p>
              <div class="mt-3 text-xs text-white/60 flex items-center gap-1 group-hover:text-white transition-colors">
                자세히 보기
                <span class="material-symbols-outlined text-sm group-hover:translate-x-1 transition-transform">arrow_forward</span>
              </div>
            </div>
          <% end %>

          <!-- 인기 가이드 -->
          <div class="card p-6">
            <h3 class="font-bold text-navy-900 mb-4 flex items-center gap-2">
              <span class="material-symbols-outlined text-warm-500">local_fire_department</span>
              인기 가이드 TOP 5
            </h3>
            <ol class="space-y-3">
              <% [
                { id: 1, title: "물품 구매 및 검수 절차" },
                { id: 4, title: "수의계약 체결 실무" },
                { id: 5, title: "출장 여비 청구" },
                { id: 6, title: "연가 사용 및 관리" },
                { id: 7, title: "민원 응대 매뉴얼" }
              ].each_with_index do |guide, i| %>
                <li class="flex items-center gap-3 group">
                  <span class="w-7 h-7 flex items-center justify-center bg-<%= i < 3 ? 'forest' : 'surface' %>-100 rounded-full text-xs font-bold text-<%= i < 3 ? 'forest-600' : 'navy-500' %>"><%= i + 1 %></span>
                  <%= link_to guide[:title], guide_path(guide[:id]), class: "text-sm text-navy-700 group-hover:text-forest-600 transition-colors truncate" %>
                </li>
              <% end %>
            </ol>
          </div>

          <!-- 최근 본 가이드 -->
          <div class="card p-6">
            <h3 class="font-bold text-navy-900 mb-4 flex items-center gap-2">
              <span class="material-symbols-outlined text-navy-400">history</span>
              최근 본 가이드
            </h3>
            <ul class="space-y-3">
              <% [{ id: 4, title: "수의계약 체결 실무" }, { id: 5, title: "출장 여비 청구" }].each do |guide| %>
                <li>
                  <%= link_to guide[:title], guide_path(guide[:id]), class: "text-sm text-navy-700 hover:text-forest-600 transition-colors" %>
                </li>
              <% end %>
            </ul>
          </div>

          <!-- AI 상담 CTA -->
          <div class="gradient-forest rounded-2xl p-6 text-white shadow-strong">
            <div class="flex items-center gap-4 mb-4">
              <div class="w-12 h-12 bg-white/10 backdrop-blur rounded-xl flex items-center justify-center">
                <span class="material-symbols-outlined text-2xl">support_agent</span>
              </div>
              <div>
                <h3 class="font-bold text-lg">가이드가 어려우신가요?</h3>
                <p class="text-forest-100 text-sm">AI에게 물어보세요</p>
              </div>
            </div>
            <%= link_to chatbot_path, class: "block w-full py-3 bg-white text-forest-700 rounded-xl font-semibold text-center hover:bg-forest-50 transition-colors shadow-soft" do %>
              AI 상담 시작하기
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const tabs = document.querySelectorAll('#category-tabs .tab-btn');
  const items = document.querySelectorAll('.item-card');
  const itemCount = document.getElementById('item-count');
  const searchInput = document.getElementById('search-input');

  function filterItems() {
    const activeTab = document.querySelector('#category-tabs .tab-btn.active');
    const category = activeTab ? activeTab.dataset.category : '전체';
    const searchTerm = searchInput.value.toLowerCase();
    let visibleCount = 0;

    items.forEach(item => {
      const itemCategory = item.dataset.category;
      const itemTitle = item.dataset.title.toLowerCase();
      const matchesCategory = category === '전체' || itemCategory === category;
      const matchesSearch = itemTitle.includes(searchTerm);

      if (matchesCategory && matchesSearch) {
        item.style.display = '';
        visibleCount++;
      } else {
        item.style.display = 'none';
      }
    });

    itemCount.textContent = visibleCount;
  }

  tabs.forEach(tab => {
    tab.addEventListener('click', function() {
      // 모든 탭 비활성화
      tabs.forEach(t => {
        t.classList.remove('active', 'bg-forest-600', 'text-white', 'shadow-md');
        t.classList.add('bg-surface-100', 'text-navy-600');
      });

      // 클릭된 탭 활성화
      this.classList.add('active', 'bg-forest-600', 'text-white', 'shadow-md');
      this.classList.remove('bg-surface-100', 'text-navy-600');

      filterItems();
    });
  });

  searchInput.addEventListener('input', filterItems);
});
</script>
