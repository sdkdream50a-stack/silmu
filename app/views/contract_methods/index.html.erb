<%# ê³„ì•½ë°©ì‹ ê²°ì • ë„êµ¬ - ê¸ˆì•¡/ìœ í˜•ë³„ ì ì • ê³„ì•½ë°©ì‹ ì•ˆë‚´ %>

<style>
  .method-tool {
    max-width: 900px;
    margin: 0 auto;
  }

  /* ì…ë ¥ ì¹´ë“œ */
  .input-card {
    background: white;
    border-radius: 20px;
    padding: 32px;
    box-shadow: 0 4px 24px rgba(0,0,0,0.06);
    border: 1px solid #e2e8f0;
    margin-bottom: 24px;
  }
  .input-card h2 {
    font-size: 20px;
    font-weight: 700;
    color: var(--color-slate-900);
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .input-card .subtitle {
    color: #64748b;
    font-size: 14px;
    margin-bottom: 28px;
  }

  /* ê³„ì•½ ìœ í˜• ì„ íƒ */
  .type-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    margin-bottom: 28px;
  }
  .type-option {
    padding: 16px 14px;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    cursor: pointer;
    text-align: center;
    transition: all 0.2s ease;
    background: white;
  }
  .type-option:hover {
    border-color: #4ade80;
    background: #f0fdf4;
  }
  .type-option.selected {
    border-color: #16a34a;
    background: #f0fdf4;
    box-shadow: 0 0 0 3px rgba(47, 129, 50, 0.15);
  }
  .type-option .material-symbols-outlined {
    font-size: 24px;
    color: #64748b;
    margin-bottom: 4px;
    display: block;
  }
  .type-option.selected .material-symbols-outlined {
    color: #16a34a;
  }
  .type-option .name {
    font-weight: 600;
    color: #1e293b;
    font-size: 13px;
  }

  /* ê¸ˆì•¡ ì…ë ¥ */
  .amount-section {
    margin-bottom: 24px;
  }
  .amount-section label {
    display: block;
    font-weight: 600;
    color: var(--color-slate-800);
    margin-bottom: 10px;
    font-size: 15px;
  }
  .amount-input-wrap {
    position: relative;
  }
  .amount-input-wrap input {
    width: 100%;
    padding: 18px 80px 18px 24px;
    border: 2px solid #e2e8f0;
    border-radius: 14px;
    font-size: 24px;
    font-weight: 700;
    color: #1e293b;
    background: #fff;
    transition: all 0.2s;
    text-align: right;
  }
  .amount-input-wrap input::placeholder {
    color: #94a3b8;
  }
  .amount-input-wrap input:focus {
    outline: none;
    border-color: var(--color-emerald-500);
    box-shadow: 0 0 0 3px rgba(47, 129, 50, 0.15);
  }
  .amount-input-wrap .unit {
    position: absolute;
    right: 24px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 18px;
    color: #64748b;
    font-weight: 500;
  }
  .amount-hint {
    margin-top: 10px;
    font-size: 13px;
    color: #64748b;
  }
  .quick-amounts {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 12px;
    align-items: center;
  }
  .quick-amount {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 8px 14px;
    background: #f8fafc;
    border: 1px solid #e2e8f0;
    border-radius: 20px;
    font-size: 13px;
    color: #334155;
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
  }
  .quick-amount:hover {
    background: var(--color-emerald-50);
    border-color: var(--color-emerald-300);
    color: var(--color-emerald-700);
  }
  .quick-amount.amount-reset {
    background: #fef3c7;
    border-color: #fcd34d;
    color: #b45309;
    margin-left: auto;
  }
  .quick-amount.amount-reset:hover {
    background: #fde68a;
    border-color: #f59e0b;
    color: #92400e;
  }

  /* íŠ¹ë¡€ê¸°ì—… ì„ íƒ */
  .special-section {
    padding: 20px;
    background: var(--color-surface-50);
    border-radius: 14px;
    border: 1px solid #e2e8f0;
    margin-bottom: 24px;
  }
  .special-section summary {
    cursor: pointer;
    font-weight: 600;
    color: var(--color-slate-800);
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .special-section summary .material-symbols-outlined {
    font-size: 20px;
    color: var(--color-amber-600);
  }
  .special-options {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 16px;
  }
  .special-option {
    padding: 10px 16px;
    border: 2px solid #e2e8f0;
    border-radius: 10px;
    font-size: 13px;
    cursor: pointer;
    transition: all 0.2s;
    background: white;
  }
  .special-option:hover {
    border-color: var(--color-amber-400);
  }
  .special-option.selected {
    border-color: var(--color-amber-500);
    background: var(--color-amber-50);
    color: var(--color-amber-700);
    font-weight: 600;
  }

  /* ê²°ì • ë²„íŠ¼ */
  .determine-btn {
    width: 100%;
    padding: 18px;
    background: linear-gradient(135deg, #16a34a, #22c55e);
    color: #ffffff !important;
    border: none;
    border-radius: 14px;
    font-size: 17px;
    font-weight: 700;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    transition: all 0.2s;
  }
  .determine-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(47, 129, 50, 0.3);
  }
  .determine-btn:disabled {
    background: #cbd5e1;
    color: #64748b !important;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
  }

  /* ê²°ê³¼ ì¹´ë“œ */
  .result-card {
    background: white;
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 8px 32px rgba(0,0,0,0.08);
    border: 1px solid #e2e8f0;
    display: none;
  }
  .result-card.show {
    display: block;
    animation: slideUp 0.4s ease;
  }
  @keyframes slideUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .result-header {
    padding: 32px;
    text-align: center;
  }
  .result-header.ì…ì°° {
    background: linear-gradient(135deg, var(--color-indigo-600), var(--color-indigo-500));
    color: white;
  }
  .result-header.ìˆ˜ì˜ê³„ì•½ {
    background: linear-gradient(135deg, var(--color-emerald-600), var(--color-emerald-500));
    color: white;
  }
  .result-header.ì†Œì•¡ìˆ˜ì˜ê³„ì•½ {
    background: linear-gradient(135deg, var(--color-slate-700), var(--color-slate-600));
    color: white;
  }
  .result-method {
    font-size: 14px;
    opacity: 0.9;
    margin-bottom: 8px;
  }
  .result-method-main {
    font-size: 32px;
    font-weight: 800;
    margin-bottom: 4px;
  }
  .result-method-detail {
    font-size: 16px;
    opacity: 0.9;
  }

  /* ê²°ë¡  ìš”ì•½ ë°•ìŠ¤ */
  .result-summary {
    padding: 24px;
    margin: -1px 0 0 0;
    background: #f0fdf4;
    border-bottom: 1px solid #e2e8f0;
  }
  .result-header.ì…ì°° + .result-summary {
    background: #eff6ff;
  }
  .result-summary-text {
    font-size: 16px;
    font-weight: 600;
    color: var(--color-slate-900);
    line-height: 1.6;
    text-align: center;
  }
  .result-summary-note {
    font-size: 14px;
    color: var(--color-slate-600);
    text-align: center;
    margin-top: 8px;
  }

  .result-body {
    padding: 28px;
  }

  /* ì •ë³´ ë°•ìŠ¤ */
  .info-box {
    padding: 20px;
    background: var(--color-surface-50);
    border-radius: 14px;
    margin-bottom: 20px;
  }
  .info-box h4 {
    font-size: 14px;
    font-weight: 600;
    color: var(--color-slate-800);
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .info-box h4 .material-symbols-outlined {
    font-size: 20px;
    color: var(--color-slate-500);
  }
  .info-row {
    display: flex;
    justify-content: space-between;
    padding: 10px 0;
    border-bottom: 1px solid #e2e8f0;
    font-size: 14px;
  }
  .info-row:last-child {
    border-bottom: none;
  }
  .info-row .label {
    color: #64748b;
  }
  .info-row .value {
    font-weight: 600;
    color: var(--color-slate-900);
  }

  /* ë²•ë ¹ ê·¼ê±° */
  .basis-box {
    padding: 16px 20px;
    background: var(--color-indigo-50);
    border-left: 4px solid var(--color-indigo-500);
    border-radius: 0 12px 12px 0;
    margin-bottom: 20px;
  }
  .basis-box .title {
    font-size: 12px;
    color: var(--color-indigo-700);
    font-weight: 600;
    margin-bottom: 6px;
  }
  .basis-box .content {
    font-size: 14px;
    color: var(--color-slate-800);
  }

  /* ê²½ê³ /ì•ˆë‚´ ë°•ìŠ¤ */
  .alert-box {
    padding: 16px 20px;
    border-radius: 12px;
    margin-bottom: 12px;
    display: flex;
    align-items: flex-start;
    gap: 12px;
  }
  .alert-box.warning {
    background: var(--color-amber-50);
    border: 1px solid var(--color-amber-200);
  }
  .alert-box.warning .material-symbols-outlined {
    color: var(--color-amber-600);
  }
  .alert-box.info {
    background: var(--color-indigo-50);
    border: 1px solid var(--color-indigo-200);
  }
  .alert-box.info .material-symbols-outlined {
    color: var(--color-indigo-600);
  }
  .alert-box .content h5 {
    font-size: 14px;
    font-weight: 600;
    color: var(--color-slate-900);
    margin-bottom: 4px;
  }
  .alert-box .content p {
    font-size: 13px;
    color: var(--color-slate-700);
    margin: 0;
  }
  .alert-box .content a {
    color: var(--color-indigo-600);
    text-decoration: underline;
    font-size: 12px;
  }

  /* í•„ìš” ì„œë¥˜ */
  .documents-section {
    margin-top: 24px;
  }
  .documents-section h4 {
    font-size: 15px;
    font-weight: 600;
    color: var(--color-slate-800);
    margin-bottom: 16px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .doc-list {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 10px;
  }
  .doc-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 14px 16px;
    background: white;
    border: 1px solid #e2e8f0;
    border-radius: 10px;
    font-size: 14px;
    color: var(--color-slate-800);
  }
  .doc-item .material-symbols-outlined {
    font-size: 20px;
    color: var(--color-emerald-500);
  }

  /* íŒ ì„¹ì…˜ */
  .tips-section {
    margin-top: 24px;
    padding: 20px;
    background: linear-gradient(135deg, var(--color-slate-50), white);
    border-radius: 14px;
    border: 1px solid var(--color-slate-100);
  }
  .tips-section h4 {
    font-size: 14px;
    font-weight: 600;
    color: var(--color-slate-800);
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .tips-section h4 .material-symbols-outlined {
    color: var(--color-amber-500);
  }
  .tip-item {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    padding: 8px 0;
    font-size: 13px;
    color: var(--color-slate-700);
    line-height: 1.5;
  }
  .tip-item::before {
    content: "ğŸ’¡";
    font-size: 14px;
    flex-shrink: 0;
  }

  /* ê´€ë ¨ ë§í¬ */
  .links-section {
    margin-top: 24px;
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
  }
  .link-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 12px 20px;
    background: white;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    color: var(--color-slate-700);
    text-decoration: none;
    font-size: 14px;
    font-weight: 500;
    transition: all 0.2s;
  }
  .link-btn:hover {
    border-color: var(--color-slate-400);
    background: var(--color-surface-50);
  }
  .link-btn .material-symbols-outlined {
    font-size: 20px;
  }

  /* ë‹¤ì‹œí•˜ê¸° ë²„íŠ¼ */
  .reset-btn {
    width: 100%;
    margin-top: 20px;
    padding: 16px;
    background: var(--color-surface-100);
    color: var(--color-slate-700);
    border: none;
    border-radius: 12px;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    transition: all 0.2s;
  }
  .reset-btn:hover {
    background: var(--color-surface-200);
  }

  /* ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ */
  .animate-spin {
    animation: spin 1s linear infinite;
  }
  @keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
  }

  /* ê³µì‚¬ í•˜ìœ„ ì„ íƒ ê·¸ë¦¬ë“œ */
  .type-sub-grid {
    display: none;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    margin-top: -16px;
    margin-bottom: 28px;
    padding: 16px;
    background: var(--color-surface-50);
    border-radius: 14px;
    border: 1px solid #e2e8f0;
  }
  .type-sub-grid.show {
    display: grid;
    animation: slideDown 0.25s ease;
  }
  @keyframes slideDown {
    from { opacity: 0; transform: translateY(-8px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .type-sub-option {
    padding: 14px 12px;
    border: 2px solid #e2e8f0;
    border-radius: 10px;
    cursor: pointer;
    background: white;
    transition: all 0.2s;
    text-align: center;
  }
  .type-sub-option:hover {
    border-color: #4ade80;
    background: #f0fdf4;
  }
  .type-sub-option.selected {
    border-color: #16a34a;
    background: #f0fdf4;
    box-shadow: 0 0 0 3px rgba(47, 129, 50, 0.15);
  }
  .type-sub-option .material-symbols-outlined {
    font-size: 22px;
    color: #64748b;
    display: block;
    margin-bottom: 4px;
  }
  .type-sub-option.selected .material-symbols-outlined {
    color: #16a34a;
  }
  .type-sub-option .name {
    font-weight: 600;
    color: #1e293b;
    font-size: 13px;
    display: block;
  }
  .type-sub-option .desc {
    font-size: 11px;
    color: #94a3b8;
    display: block;
    margin-top: 4px;
    line-height: 1.4;
  }
  .type-sub-hint {
    grid-column: 1 / -1;
    font-size: 12px;
    color: #64748b;
    text-align: center;
    padding: 4px 0 0;
    margin: 0;
  }

  /* ë°˜ì‘í˜• */
  @media (max-width: 768px) {
    .type-grid {
      grid-template-columns: repeat(3, 1fr);
    }
    .type-sub-grid {
      grid-template-columns: 1fr;
    }
    .doc-list {
      grid-template-columns: 1fr;
    }
    .links-section {
      flex-direction: column;
    }
    .link-btn {
      justify-content: center;
    }
  }

  /* ì¸ì‡„ */
  @media print {
    .input-card, .reset-btn {
      display: none !important;
    }
    .result-card {
      box-shadow: none;
      border: 1px solid #333;
    }
  }
</style>

<!-- í˜ì´ì§€ í—¤ë” -->
<section class="gradient-emerald text-white py-12 lg:py-16">
  <div class="container-wide">
    <div class="flex items-start gap-5">
      <div class="w-16 h-16 bg-white/10 backdrop-blur-md rounded-2xl flex items-center justify-center border border-white/20 shadow-lg">
        <span class="material-symbols-outlined text-4xl text-white">gavel</span>
      </div>
      <div>
        <h1 class="text-3xl lg:text-4xl font-bold tracking-tight mb-2">ê³„ì•½ë°©ì‹ ê²°ì • ë„ìš°ë¯¸</h1>
        <p class="text-emerald-100 text-lg">ì¶”ì •ê°€ê²©ê³¼ ê³„ì•½ìœ í˜•ìœ¼ë¡œ ì ì • ê³„ì•½ë°©ì‹ì„ í™•ì¸í•˜ì„¸ìš”</p>
      </div>
    </div>
  </div>
</section>

<section class="section py-10">
  <div class="container-wide method-tool">
    <!-- ì…ë ¥ í¼ -->
    <div class="input-card" id="input-section">
      <h2>
        <span class="material-symbols-outlined">edit_note</span>
        ê³„ì•½ ì •ë³´ ì…ë ¥
      </h2>
      <p class="subtitle">ê³„ì•½ ìœ í˜•ê³¼ ì¶”ì •ê°€ê²©ì„ ì…ë ¥í•˜ë©´ ì ì • ê³„ì•½ë°©ì‹ê³¼ í•„ìš” ì„œë¥˜ë¥¼ ì•ˆë‚´í•´ë“œë¦½ë‹ˆë‹¤</p>

      <!-- ê³„ì•½ ìœ í˜• ì„ íƒ (1ë‹¨ê³„) -->
      <div class="type-grid" id="type-grid-main">
        <div class="type-option" data-type="goods" onclick="selectMainType('goods')">
          <span class="material-symbols-outlined">inventory_2</span>
          <span class="name">ë¬¼í’ˆ</span>
        </div>
        <div class="type-option" data-type="service" onclick="selectMainType('service')">
          <span class="material-symbols-outlined">support_agent</span>
          <span class="name">ìš©ì—­</span>
        </div>
        <div class="type-option" data-type="construction" onclick="selectMainType('construction')">
          <span class="material-symbols-outlined">construction</span>
          <span class="name">ê³µì‚¬</span>
        </div>
      </div>

      <!-- ê³µì‚¬ ì„¸ë¶€ ìœ í˜• ì„ íƒ (2ë‹¨ê³„) -->
      <div class="type-sub-grid" id="construction-sub">
        <div class="type-sub-option" data-type="construction_general" onclick="selectConstructionType('construction_general')">
          <span class="material-symbols-outlined">domain</span>
          <span class="name">ì¢…í•©ê³µì‚¬</span>
          <span class="desc">ê±´ì¶•Â·í† ëª©Â·ì¡°ê²½ ë“± ì¢…í•© ì‹œê³µ<br>5ì²œë§Œì› ë¯¸ë§Œ ë©´í—ˆ ë¶ˆí•„ìš” Â· ìˆ˜ì˜ 4ì–µ ì´í•˜</span>
        </div>
        <div class="type-sub-option" data-type="construction_special" onclick="selectConstructionType('construction_special')">
          <span class="material-symbols-outlined">engineering</span>
          <span class="name">ì „ë¬¸ê³µì‚¬</span>
          <span class="desc">ì‹¤ë‚´ê±´ì¶•Â·í† ê³µÂ·ë¯¸ì¥Â·ë°©ìˆ˜Â·ë„ì¥Â·ë¹„ê³„í•´ì²´Â·ì² ê·¼ì½˜í¬ë¦¬íŠ¸Â·ê¸°ê³„ì„¤ë¹„Â·ìƒí•˜ìˆ˜ë„Â·í¬ì¥Â·ì¡°ê²½ ë“±<br>1,500ë§Œì› ì´ìƒ ì „ë¬¸ë©´í—ˆ í•„ìš” Â· ìˆ˜ì˜ 2ì–µ ì´í•˜</span>
        </div>
        <div class="type-sub-option" data-type="construction_etc" onclick="selectConstructionType('construction_etc')">
          <span class="material-symbols-outlined">electrical_services</span>
          <span class="name">ì „ê¸°/ì†Œë°©/ì •ë³´í†µì‹ </span>
          <span class="desc">ì „ê¸°Â·ì†Œë°©Â·í†µì‹ ì„¤ë¹„ ê³µì‚¬<br>ê° ê°œë³„ë²• ë©´í—ˆ í•„ìš” Â· ìˆ˜ì˜ 1.6ì–µ ì´í•˜</span>
        </div>
        <p class="type-sub-hint">â€» ì†Œê·œëª¨ ì‹œì„¤ë¬¼ ìˆ˜ì„ Â·ë³´ìˆ˜ëŠ” <strong>ì¢…í•©ê³µì‚¬</strong> ì„ íƒ (ê³µì‚¬ì˜ˆì •ê¸ˆì•¡ 5ì²œë§Œì› ë¯¸ë§Œ ì‹œ ê±´ì„¤ì—… ë“±ë¡ ë¶ˆí•„ìš”)<br>â€» ì „ë¬¸ê³µì‚¬ëŠ” ê³µì‚¬ì˜ˆì •ê¸ˆì•¡ 1,500ë§Œì› ì´ìƒ ì‹œ í•´ë‹¹ ì „ë¬¸ë©´í—ˆ í•„ìš”</p>
      </div>

      <!-- ì¶”ì •ê°€ê²© ì…ë ¥ -->
      <div class="amount-section">
        <label>ì¶”ì •ê°€ê²© (ë¶€ê°€ì„¸ ì œì™¸)</label>
        <div class="amount-input-wrap">
          <input type="text" id="estimated-price" placeholder="0" inputmode="numeric" oninput="formatPrice(this)" onkeydown="if(event.key==='Enter'){event.preventDefault();determineMethod();}">
          <span class="unit">ì›</span>
        </div>
        <p class="amount-hint" id="amount-hint">ì¶”ì •ê°€ê²© ì‚°ì •ì„ ìœ„í•œ ëŒ€ëµì ì¸ ì˜ˆìƒ ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”</p>
        <div class="quick-amounts">
          <span class="quick-amount" onclick="addAmount(100000)">+10ë§Œ</span>
          <span class="quick-amount" onclick="addAmount(1000000)">+100ë§Œ</span>
          <span class="quick-amount" onclick="addAmount(10000000)">+1ì²œë§Œ</span>
          <span class="quick-amount" onclick="addAmount(50000000)">+5ì²œë§Œ</span>
          <span class="quick-amount" onclick="addAmount(100000000)">+1ì–µ</span>
          <span class="quick-amount amount-reset" onclick="resetAmount()">ì´ˆê¸°í™”</span>
        </div>
      </div>

      <!-- íŠ¹ë¡€ê¸°ì—… ì„ íƒ -->
      <details class="special-section" open>
        <summary>
          <span class="material-symbols-outlined">star</span>
          íŠ¹ë¡€ê¸°ì—… ì—¬ë¶€ (ì—¬ì„±ê¸°ì—…, ì‚¬íšŒì ê¸°ì—… ë“±)
        </summary>
        <div class="special-options">
          <span class="special-option" data-special="none" onclick="selectSpecial('none')">í•´ë‹¹ì—†ìŒ</span>
          <span class="special-option" data-special="women" onclick="selectSpecial('women')">ì—¬ì„±ê¸°ì—…</span>
          <span class="special-option" data-special="disabled" onclick="selectSpecial('disabled')">ì¥ì• ì¸ê¸°ì—…</span>
          <span class="special-option" data-special="social" onclick="selectSpecial('social')">ì‚¬íšŒì ê¸°ì—…</span>
          <span class="special-option" data-special="cooperative" onclick="selectSpecial('cooperative')">í˜‘ë™ì¡°í•©</span>
          <span class="special-option" data-special="social_cooperative" onclick="selectSpecial('social_cooperative')">ì‚¬íšŒì í˜‘ë™ì¡°í•©</span>
          <span class="special-option" data-special="village" onclick="selectSpecial('village')">ë§ˆì„ê¸°ì—…</span>
          <span class="special-option" data-special="self_support" onclick="selectSpecial('self_support')">ìí™œê¸°ì—…</span>
        </div>
      </details>

      <div id="error-message" style="display:none; padding:14px 20px; background:#fef2f2; border:1px solid #fecaca; border-radius:12px; color:#dc2626; font-size:14px; margin-bottom:16px;">
      </div>

      <button class="determine-btn" onclick="determineMethod()" id="determine-btn" disabled>
        <span class="material-symbols-outlined" id="btn-icon">search</span>
        <span id="btn-text">ê³„ì•½ë°©ì‹ í™•ì¸í•˜ê¸°</span>
      </button>
    </div>

    <!-- ê²°ê³¼ ì¹´ë“œ -->
    <div class="result-card" id="result-section">
      <div class="result-header" id="result-header">
        <div class="result-method">ê³„ì•½ë°©ì‹ ê²°ì • ê²°ê³¼</div>
        <div class="result-method-main" id="result-method"></div>
        <div class="result-method-detail" id="result-detail"></div>
      </div>

      <!-- ê²°ë¡  ìš”ì•½ -->
      <div class="result-summary" id="result-summary">
        <div class="result-summary-text" id="result-summary-text"></div>
        <div class="result-summary-note" id="result-summary-note"></div>
      </div>

      <div class="result-body">
        <!-- ê¸°ë³¸ ì •ë³´ -->
        <div class="info-box">
          <h4>
            <span class="material-symbols-outlined">info</span>
            ì…ë ¥ ì •ë³´
          </h4>
          <div class="info-row">
            <span class="label">ê³„ì•½ ìœ í˜•</span>
            <span class="value" id="info-type"></span>
          </div>
          <div class="info-row">
            <span class="label">ì¶”ì •ê°€ê²©</span>
            <span class="value" id="info-price"></span>
          </div>
          <div class="info-row" id="info-special-row" style="display: none;">
            <span class="label">íŠ¹ë¡€ ì ìš©</span>
            <span class="value" id="info-special"></span>
          </div>
        </div>

        <!-- ë²•ë ¹ ê·¼ê±° -->
        <div class="basis-box">
          <div class="title">ë²•ë ¹ ê·¼ê±°</div>
          <div class="content" id="basis-content"></div>
        </div>

        <!-- ë‚™ì°°í•˜í•œìœ¨ (ì…ì°°ì¸ ê²½ìš°ì—ë§Œ í‘œì‹œ) -->
        <div id="lowest-bid-rate-box" style="display: none; padding: 20px; background: linear-gradient(135deg, #fef3c7, #fde68a); border-left: 4px solid #f59e0b; border-radius: 0 14px 14px 0; margin-bottom: 20px;">
          <div style="font-size: 12px; color: #92400e; font-weight: 600; margin-bottom: 8px; display: flex; align-items: center; gap: 6px;">
            <span class="material-symbols-outlined" style="font-size: 18px;">percent</span>
            ë‚™ì°°í•˜í•œìœ¨
          </div>
          <div style="font-size: 20px; font-weight: 700; color: #78350f; margin-bottom: 8px;" id="lowest-bid-rate-value"></div>
          <div style="font-size: 13px; color: #92400e;" id="lowest-bid-rate-note"></div>
        </div>

        <!-- ê²½ê³ /ì•ˆë‚´ -->
        <div id="warnings-container"></div>

        <!-- í•„ìš” ì„œë¥˜ -->
        <div class="documents-section">
          <h4>
            <span class="material-symbols-outlined">description</span>
            í•„ìš” ì„œë¥˜
          </h4>
          <div class="doc-list" id="doc-list"></div>
        </div>

        <!-- íŒ -->
        <div class="tips-section">
          <h4>
            <span class="material-symbols-outlined">tips_and_updates</span>
            ì‹¤ë¬´ íŒ
          </h4>
          <div id="tips-container"></div>
        </div>

        <!-- ê´€ë ¨ ë§í¬ -->
        <div class="links-section">
          <a href="https://www.g2b.go.kr" target="_blank" class="link-btn">
            <span class="material-symbols-outlined">open_in_new</span>
            ë‚˜ë¼ì¥í„°
          </a>
          <a href="https://www.s2b.kr" target="_blank" class="link-btn">
            <span class="material-symbols-outlined">open_in_new</span>
            í•™êµì¥í„°
          </a>
          <a href="https://www.smpp.go.kr" target="_blank" class="link-btn">
            <span class="material-symbols-outlined">open_in_new</span>
            ì¤‘ì†Œê¸°ì—…ì œí’ˆ ê³µê³µêµ¬ë§¤
          </a>
          <%= link_to contract_documents_path, class: "link-btn" do %>
            <span class="material-symbols-outlined">checklist</span>
            ì„œë¥˜ ì²´í¬ë¦¬ìŠ¤íŠ¸
          <% end %>
        </div>

        <button class="reset-btn" onclick="resetForm()">
          <span class="material-symbols-outlined">arrow_upward</span>
          ì¡°ê±´ ë³€ê²½í•˜ì—¬ ë‹¤ì‹œ í™•ì¸
        </button>
      </div>
    </div>
  </div>
</section>

<script>
  var selectedType = null;
  var selectedSpecial = null;
  var estimatedPrice = 0;

  function selectMainType(type) {
    const subGrid = document.getElementById('construction-sub');
    const specialSection = document.querySelector('.special-section');

    if (type === 'construction') {
      // ê³µì‚¬ ì„ íƒ â†’ í•˜ìœ„ ì˜µì…˜ í¼ì¹˜ê¸°, íŠ¹ë¡€ê¸°ì—… ìˆ¨ê¸°ê¸° (ë¬¼í’ˆ/ìš©ì—­ë§Œ í•´ë‹¹)
      document.querySelectorAll('.type-option').forEach(el => {
        el.classList.toggle('selected', el.dataset.type === 'construction');
      });
      subGrid.classList.add('show');
      specialSection.style.display = 'none';
      selectedSpecial = null;
      // ì´ì „ í•˜ìœ„ ì„ íƒ ì´ˆê¸°í™”
      document.querySelectorAll('.type-sub-option').forEach(el => el.classList.remove('selected'));
      selectedType = null;
      checkFormValid();
    } else {
      // ë¬¼í’ˆ/ìš©ì—­ ì„ íƒ â†’ í•˜ìœ„ ì˜µì…˜ ë‹«ê¸°, íŠ¹ë¡€ê¸°ì—… ë³´ì´ê¸°
      subGrid.classList.remove('show');
      specialSection.style.display = '';
      document.querySelectorAll('.type-option').forEach(el => {
        el.classList.toggle('selected', el.dataset.type === type);
      });
      document.querySelectorAll('.type-sub-option').forEach(el => el.classList.remove('selected'));
      selectedType = type;
      checkFormValid();
    }
  }

  function selectConstructionType(type) {
    selectedType = type;
    // í•˜ìœ„ ì˜µì…˜ í•˜ì´ë¼ì´íŠ¸
    document.querySelectorAll('.type-sub-option').forEach(el => {
      el.classList.toggle('selected', el.dataset.type === type);
    });
    // ë©”ì¸ 'ê³µì‚¬' ê³„ì† í•˜ì´ë¼ì´íŠ¸
    document.querySelectorAll('.type-option').forEach(el => {
      el.classList.toggle('selected', el.dataset.type === 'construction');
    });
    checkFormValid();
  }

  function selectSpecial(special) {
    selectedSpecial = special === 'none' ? null : special;
    document.querySelectorAll('.special-option').forEach(el => {
      el.classList.toggle('selected', el.dataset.special === special);
    });
  }

  function formatPrice(input) {
    let value = input.value.replace(/[^0-9]/g, '');
    if (value) {
      estimatedPrice = parseInt(value);
      input.value = estimatedPrice.toLocaleString('ko-KR');
    } else {
      estimatedPrice = 0;
    }
    updateAmountHint();
    checkFormValid();
  }

  function addAmount(amount) {
    estimatedPrice += amount;
    document.getElementById('estimated-price').value = estimatedPrice.toLocaleString('ko-KR');
    updateAmountHint();
    checkFormValid();
  }

  function resetAmount() {
    estimatedPrice = 0;
    document.getElementById('estimated-price').value = '';
    updateAmountHint();
    checkFormValid();
  }

  function updateAmountHint() {
    const hint = document.getElementById('amount-hint');
    if (estimatedPrice > 0) {
      hint.textContent = toKoreanUnit(estimatedPrice);
      hint.style.color = 'var(--color-emerald-600)';
      hint.style.fontWeight = '600';
    } else {
      hint.textContent = 'ì¶”ì •ê°€ê²© ì‚°ì •ì„ ìœ„í•œ ëŒ€ëµì ì¸ ì˜ˆìƒ ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”';
      hint.style.color = '#64748b';
      hint.style.fontWeight = '400';
    }
  }

  function toKoreanUnit(num) {
    if (num === 0) return '0ì›';
    const units = [
      { value: 100000000, label: 'ì–µ' },
      { value: 10000, label: 'ë§Œ' }
    ];
    let result = '';
    let remaining = num;
    for (const unit of units) {
      if (remaining >= unit.value) {
        const count = Math.floor(remaining / unit.value);
        result += count.toLocaleString('ko-KR') + unit.label + ' ';
        remaining %= unit.value;
      }
    }
    if (remaining > 0) {
      result += remaining.toLocaleString('ko-KR');
    }
    return result.trim() + 'ì›';
  }

  function checkFormValid() {
    const btn = document.getElementById('determine-btn');
    btn.disabled = !(selectedType && estimatedPrice > 0);
  }

  function showError(message) {
    const el = document.getElementById('error-message');
    el.textContent = message;
    el.style.display = 'block';
    el.scrollIntoView({ behavior: 'smooth', block: 'center' });
  }

  function hideError() {
    document.getElementById('error-message').style.display = 'none';
  }

  function setLoading(loading) {
    const btn = document.getElementById('determine-btn');
    const icon = document.getElementById('btn-icon');
    const text = document.getElementById('btn-text');
    if (loading) {
      btn.disabled = true;
      icon.textContent = 'hourglass_empty';
      icon.classList.add('animate-spin');
      text.textContent = 'í™•ì¸ ì¤‘...';
    } else {
      btn.disabled = !(selectedType && estimatedPrice > 0);
      icon.textContent = 'search';
      icon.classList.remove('animate-spin');
      text.textContent = 'ê³„ì•½ë°©ì‹ í™•ì¸í•˜ê¸°';
    }
  }

  async function determineMethod() {
    if (!selectedType || estimatedPrice <= 0) return;

    hideError();
    setLoading(true);

    try {
      const response = await fetch('/contract-methods/determine', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRF-Token': document.querySelector('[name="csrf-token"]')?.content || ''
        },
        body: JSON.stringify({
          contract_type: selectedType,
          estimated_price: estimatedPrice,
          special_enterprise: selectedSpecial
        })
      });

      const result = await response.json();

      if (result.success) {
        renderResult(result);
      } else {
        showError(result.error || 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    } catch (error) {
      console.error('Error:', error);
      showError('ì„œë²„ì™€ í†µì‹ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
    } finally {
      setLoading(false);
    }
  }

  function renderResult(result) {
    // í—¤ë” ìƒ‰ìƒ ì„¤ì •
    const header = document.getElementById('result-header');
    header.className = 'result-header ' + result.result.method;

    // ê³„ì•½ë°©ì‹ í‘œì‹œ
    document.getElementById('result-method').textContent = result.result.method;
    document.getElementById('result-detail').textContent = result.result.method_detail;

    // ê²°ë¡  ìš”ì•½ ìƒì„±
    const typeName = result.contract_type.name;
    const price = result.formatted_price;
    const method = result.result.method;
    const detail = result.result.method_detail;
    let summaryText = '';

    if (method === 'ì…ì°°') {
      summaryText = `${typeName} ${price}ì›ì€ ê²½ìŸì…ì°°ë¡œ ì§„í–‰í•´ì•¼ í•©ë‹ˆë‹¤.`;
    } else {
      summaryText = `${typeName} ${price}ì›ì€ "${detail}"ë¡œ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`;
    }

    document.getElementById('result-summary-text').textContent = summaryText;

    // note í‘œì‹œ (í•µì‹¬ ì‹¤ë¬´ ì •ë³´)
    const noteEl = document.getElementById('result-summary-note');
    if (result.result.note) {
      noteEl.textContent = result.result.note;
      noteEl.style.display = 'block';
    } else {
      noteEl.style.display = 'none';
    }

    // ê¸°ë³¸ ì •ë³´
    document.getElementById('info-type').textContent = result.contract_type.name;
    document.getElementById('info-price').textContent = result.formatted_price + 'ì›';

    // íŠ¹ë¡€ ì ìš©
    const specialRow = document.getElementById('info-special-row');
    if (result.result.special_applied && result.special_enterprise) {
      specialRow.style.display = 'flex';
      document.getElementById('info-special').textContent = result.special_enterprise.name + ' íŠ¹ë¡€';
    } else {
      specialRow.style.display = 'none';
    }

    // ë²•ë ¹ ê·¼ê±°
    document.getElementById('basis-content').textContent = result.result.basis;

    // ë‚™ì°°í•˜í•œìœ¨ í‘œì‹œ (ì…ì°°ì¸ ê²½ìš°)
    const lowestBidRateBox = document.getElementById('lowest-bid-rate-box');
    if (result.lowest_bid_rate) {
      lowestBidRateBox.style.display = 'block';
      document.getElementById('lowest-bid-rate-value').textContent = result.lowest_bid_rate.rate;
      document.getElementById('lowest-bid-rate-note').textContent = result.lowest_bid_rate.note + ' (' + result.lowest_bid_rate.detail + ')';
    } else {
      lowestBidRateBox.style.display = 'none';
    }

    // ê²½ê³ /ì•ˆë‚´ (ì•ˆì „í•œ DOM ì¡°ì‘)
    const warningsContainer = document.getElementById('warnings-container');
    warningsContainer.innerHTML = '';

    function createAlertBox(level, iconName, title, message, link) {
      const box = document.createElement('div');
      box.className = 'alert-box ' + level;
      const icon = document.createElement('span');
      icon.className = 'material-symbols-outlined';
      icon.textContent = iconName;
      const content = document.createElement('div');
      content.className = 'content';
      const h5 = document.createElement('h5');
      h5.textContent = title;
      const p = document.createElement('p');
      p.textContent = message;
      content.appendChild(h5);
      content.appendChild(p);
      if (link) {
        const a = document.createElement('a');
        a.href = link;
        a.target = '_blank';
        a.rel = 'noopener noreferrer';
        a.textContent = 'ìì„¸íˆ ë³´ê¸° â†’';
        content.appendChild(a);
      }
      box.appendChild(icon);
      box.appendChild(content);
      return box;
    }

    if (result.result.special_condition) {
      warningsContainer.appendChild(
        createAlertBox('info', 'lightbulb', 'ì°¸ê³ ì‚¬í•­', result.result.special_condition)
      );
    }
    result.warnings.forEach(w => {
      warningsContainer.appendChild(
        createAlertBox(w.level, w.level === 'warning' ? 'warning' : 'info', w.title, w.message, w.link)
      );
    });

    // í•„ìš” ì„œë¥˜ (ì•ˆì „í•œ DOM ì¡°ì‘)
    const docList = document.getElementById('doc-list');
    docList.innerHTML = '';
    result.result.documents.forEach(doc => {
      const item = document.createElement('div');
      item.className = 'doc-item';
      const icon = document.createElement('span');
      icon.className = 'material-symbols-outlined';
      icon.textContent = 'description';
      item.appendChild(icon);
      item.appendChild(document.createTextNode(doc));
      docList.appendChild(item);
    });

    // íŒ (ì•ˆì „í•œ DOM ì¡°ì‘)
    const tipsContainer = document.getElementById('tips-container');
    tipsContainer.innerHTML = '';
    result.tips.forEach(tip => {
      const item = document.createElement('div');
      item.className = 'tip-item';
      item.textContent = tip;
      tipsContainer.appendChild(item);
    });

    // ê²°ê³¼ í‘œì‹œ
    document.getElementById('result-section').classList.add('show');
    document.getElementById('result-section').scrollIntoView({ behavior: 'smooth', block: 'start' });
  }

  function resetForm() {
    // ê²°ê³¼ë§Œ ë‹«ê³  ì…ë ¥ê°’ì€ ìœ ì§€ â†’ ì¡°ê±´ ë°”ê¿” ì¬ì¡°íšŒ ê°€ëŠ¥
    document.getElementById('result-section').classList.remove('show');
    document.getElementById('input-section').scrollIntoView({ behavior: 'smooth', block: 'start' });
  }

  // ì´ˆê¸°í™”
  selectSpecial('none');
</script>
