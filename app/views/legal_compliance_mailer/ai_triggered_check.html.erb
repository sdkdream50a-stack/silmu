<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      line-height: 1.6;
      color: #333;
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
    }
    .header {
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      color: white;
      padding: 30px 20px;
      border-radius: 8px 8px 0 0;
      text-align: center;
    }
    .header h1 {
      margin: 0;
      font-size: 24px;
    }
    .header p {
      margin: 10px 0 0 0;
      opacity: 0.9;
      font-size: 14px;
    }
    .content {
      background: white;
      padding: 30px;
      border: 1px solid #e0e0e0;
      border-top: none;
    }
    .alert-badge {
      display: inline-block;
      padding: 8px 16px;
      border-radius: 20px;
      font-weight: bold;
      margin: 10px 0;
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: white;
    }
    .stats {
      background: #fef3c7;
      padding: 20px;
      border-radius: 8px;
      margin: 20px 0;
      border-left: 4px solid #f59e0b;
    }
    .stat-row {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid #fde68a;
    }
    .stat-row:last-child {
      border-bottom: none;
    }
    .stat-label {
      font-weight: 600;
      color: #78350f;
    }
    .stat-value {
      color: #92400e;
      font-weight: bold;
    }
    .trigger-item {
      background: #fee2e2;
      border-left: 4px solid #dc2626;
      padding: 15px;
      margin: 10px 0;
      border-radius: 4px;
    }
    .trigger-header {
      font-weight: bold;
      color: #991b1b;
      margin-bottom: 8px;
    }
    .change-item {
      background: #e7f3ff;
      border-left: 4px solid #007bff;
      padding: 15px;
      margin: 10px 0;
      border-radius: 4px;
    }
    .change-header {
      font-weight: bold;
      color: #004085;
      margin-bottom: 8px;
    }
    .correction {
      background: #fff3cd;
      padding: 10px;
      border-radius: 4px;
      margin: 8px 0;
    }
    .footer {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 0 0 8px 8px;
      text-align: center;
      font-size: 12px;
      color: #6c757d;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>âš ï¸ AI ë²•ë ¹ ê²€ì¦ íŠ¸ë¦¬ê±°ë¨</h1>
    <p><%= @timestamp.strftime('%Yë…„ %mì›” %dì¼ %H:%M') %></p>
  </div>

  <div class="content">
    <div class="alert-badge">
      ğŸš¨ ì¤‘ëŒ€ ì˜¤ë¥˜ ë°œê²¬ â†’ AI ê²€ì¦ ì‹¤í–‰
    </div>

    <p>
      ê·œì¹™ ê¸°ë°˜ ê²€ì¦ì—ì„œ <strong><%= @triggering_errors.count %>ê±´ì˜ ì¤‘ëŒ€ ì˜¤ë¥˜</strong>ë¥¼ ë°œê²¬í•˜ì—¬ AI ì‹¬ì¸µ ê²€ì¦ì„ ì‹¤í–‰í–ˆìŠµë‹ˆë‹¤.
    </p>

    <% topic_changes = @changes.select { |c| c[:topic] } %>
    <% tool_errors = @errors.select { |e| e[:tool] } %>
    <% other_errors = @errors.reject { |e| e[:tool] } %>

    <div class="stats">
      <h3 style="margin-top: 0; color: #92400e;">ğŸ“Š AI ê²€ì¦ ê²°ê³¼</h3>
      <div class="stat-row">
        <span class="stat-label">íŠ¸ë¦¬ê±°ëœ ì˜¤ë¥˜</span>
        <span class="stat-value"><%= @triggering_errors.count %>ê±´</span>
      </div>
      <div class="stat-row">
        <span class="stat-label">í† í”½ ìë™ ìˆ˜ì •</span>
        <span class="stat-value" style="color: <%= topic_changes.any? ? '#007bff' : '#28a745' %>">
          <%= topic_changes.count %>ê±´
        </span>
      </div>
      <div class="stat-row">
        <span class="stat-label">ë„êµ¬ ì˜¤ë¥˜</span>
        <span class="stat-value" style="color: <%= tool_errors.any? ? '#dc3545' : '#28a745' %>">
          <%= tool_errors.count %>ê±´
        </span>
      </div>
    </div>

    <h3>ğŸš¨ íŠ¸ë¦¬ê±°ëœ ì¤‘ëŒ€ ì˜¤ë¥˜</h3>
    <% @triggering_errors.first(5).each do |error| %>
      <div class="trigger-item">
        <div class="trigger-header">
          <%= error[:file] || "ì•Œ ìˆ˜ ì—†ìŒ" %>
        </div>
        <div style="font-size: 14px; color: #555;">
          <%= error[:message] || error[:description] || "ì˜¤ë¥˜ ë‚´ìš© ì—†ìŒ" %>
        </div>
      </div>
    <% end %>
    <% if @triggering_errors.count > 5 %>
      <p style="margin-top: 10px; color: #991b1b;">ì™¸ <%= @triggering_errors.count - 5 %>ê±´</p>
    <% end %>

    <% if topic_changes.any? %>
      <h3 style="margin-top: 30px;">ğŸ”§ AI ìë™ ìˆ˜ì •</h3>
      <% topic_changes.first(3).each do |change| %>
        <div class="change-item">
          <div class="change-header">
            [<%= change[:topic] %>] <%= change[:field] %>
          </div>
          <div class="correction">
            <strong>ìˆ˜ì • ì „:</strong> <%= change[:wrong_value] %><br>
            <strong>ìˆ˜ì • í›„:</strong> <%= change[:correct_value] %>
          </div>
          <div style="font-size: 14px; color: #555; margin-top: 8px;">
            <strong>ê·¼ê±°:</strong> <%= change[:source] %>
          </div>
        </div>
      <% end %>
      <% if topic_changes.count > 3 %>
        <p style="margin-top: 10px; color: #004085;">ì™¸ <%= topic_changes.count - 3 %>ê±´ ì¶”ê°€ ìˆ˜ì •</p>
      <% end %>

      <p style="margin-top: 20px; padding: 15px; background: #d4edda; border-radius: 4px; color: #155724;">
        <strong>âœ… ìë™ ìˆ˜ì • ì™„ë£Œ</strong><br>
        ëª¨ë“  ìˆ˜ì • ì‚¬í•­ì´ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.
      </p>
    <% else %>
      <p style="margin-top: 20px; padding: 15px; background: #d4edda; border-radius: 4px; color: #155724;">
        <strong>âœ… AI ê²€ì¦ ê²°ê³¼: ìˆ˜ì • í•„ìš” ì—†ìŒ</strong><br>
        ì¤‘ëŒ€ ì˜¤ë¥˜ë¡œ íŒë‹¨ë˜ì—ˆìœ¼ë‚˜ AI ê²€ì¦ ê²°ê³¼ ìˆ˜ì •ì´ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
      </p>
    <% end %>

    <h3 style="margin-top: 30px;">ğŸ’° ë¹„ìš© ì ˆê° íš¨ê³¼</h3>
    <p style="background: #e0f2fe; padding: 15px; border-radius: 4px; border-left: 4px solid #0284c7;">
      <strong>í•˜ì´ë¸Œë¦¬ë“œ ê²€ì¦ ì‹œìŠ¤í…œ</strong><br>
      â€¢ ê·œì¹™ ê¸°ë°˜ ê²€ì¦: ë¬´ë£Œ (í•­ìƒ ì‹¤í–‰)<br>
      â€¢ AI ê²€ì¦: ì¤‘ëŒ€ ì˜¤ë¥˜ ë°œê²¬ ì‹œì—ë§Œ ì‹¤í–‰ (ë¹„ìš© ë°œìƒ)<br>
      â€¢ ì˜ˆìƒ ì ˆê°ìœ¨: <strong>ì•½ 70%</strong> (ì›” $9 â†’ $2-3)
    </p>

    <div style="text-align: center; margin-top: 30px;">
      <a href="https://silmu.kr/topics" style="display: inline-block; padding: 12px 24px; background: #f59e0b; color: white; text-decoration: none; border-radius: 6px; font-weight: bold;">í† í”½ ë°”ë¡œê°€ê¸°</a>
    </div>
  </div>

  <div class="footer">
    <p>
      ì´ ì´ë©”ì¼ì€ ì¤‘ëŒ€ ì˜¤ë¥˜ ë°œê²¬ ì‹œ ìë™ ë°œì†¡ë©ë‹ˆë‹¤.<br>
      ì‹¤ë¬´.kr í•˜ì´ë¸Œë¦¬ë“œ ë²•ë ¹ ê²€ì¦ ì‹œìŠ¤í…œ | hello@silmu.kr
    </p>
    <p style="margin-top: 10px; font-size: 11px;">
      ê·œì¹™ ê¸°ë°˜ ê²€ì¦: ë§¤ì£¼ ì›”ìš”ì¼ 10ì‹œ / ë§¤ì›” 1ì¼, 15ì¼ 11ì‹œ
    </p>
  </div>
</body>
</html>
