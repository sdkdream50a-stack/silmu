<!DOCTYPE html>
<html lang="ko" class="scroll-smooth" style="background-color:#f0f7ff;color:#0f172a;">
  <head>
    <%= display_meta_tags %>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="light only">
    <meta name="application-name" content="실무.kr - 공공조달관리사">
    <meta name="theme-color" content="#1d4ed8">
    <meta name="google-site-verification" content="4f2zo86zRxW5JBhdwgpDx16xvZKaC_QBDsBXvcb8xRc" />
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <%# Fonts - 비동기 로딩 %>
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="preload" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable-dynamic-subset.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'" fetchpriority="high">
    <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable-dynamic-subset.min.css"></noscript>

    <%# Icons %>
    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="apple-touch-icon" href="/icon.png">

    <%# Iconify %>
    <script src="https://code.iconify.design/3/3.1.0/iconify.min.js" defer></script>

    <script>
      var _iconConvertTimer = null;
      function convertMaterialIcons(root) {
        var container = root || document.body;
        if (!container) return;
        var icons = container.querySelectorAll('.material-symbols-outlined:not([data-icon])');
        if (icons.length === 0) return;
        icons.forEach(function(icon) {
          var iconName = icon.textContent.trim();
          if (iconName) {
            icon.setAttribute('data-icon', 'material-symbols:' + iconName.replace(/_/g, '-'));
            icon.textContent = '';
            icon.classList.add('iconify');
          }
        });
        if (typeof Iconify !== 'undefined' && Iconify.scan) { Iconify.scan(container); }
      }
      document.addEventListener('DOMContentLoaded', function() { convertMaterialIcons(); });
      document.addEventListener('turbo:render', function() { convertMaterialIcons(); });
    </script>

    <style>
      .material-symbols-outlined {
        display: inline-flex; align-items: center; justify-content: center;
        vertical-align: middle; width: 1em; height: 1em;
        min-width: 1em; min-height: 1em; overflow: hidden;
        font-size: inherit; line-height: 1; color: transparent;
      }
      .material-symbols-outlined.iconify, .material-symbols-outlined[data-icon] { color: inherit; }
      .iconify { width: 1em; height: 1em; }
    </style>

    <% if Rails.env.production? && ENV['GA_MEASUREMENT_ID'].present? && !current_user&.admin? %>
      <script>
        function loadGoogleAnalytics() {
          const script = document.createElement('script');
          script.src = 'https://www.googletagmanager.com/gtag/js?id=<%= ENV['GA_MEASUREMENT_ID'] %>';
          script.async = true; document.head.appendChild(script);
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date()); gtag('config', '<%= ENV['GA_MEASUREMENT_ID'] %>');
        }
        if ('requestIdleCallback' in window) { requestIdleCallback(loadGoogleAnalytics, { timeout: 3000 }); }
        else { setTimeout(loadGoogleAnalytics, 3000); }
      </script>
    <% end %>

    <% if Rails.env.production? && ENV['ADSENSE_CLIENT_ID'].present? %>
      <script>
        function loadAdSense() {
          const script = document.createElement('script');
          script.src = 'https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=<%= ENV['ADSENSE_CLIENT_ID'] %>';
          script.async = true; script.crossOrigin = 'anonymous'; document.head.appendChild(script);
        }
        if ('requestIdleCallback' in window) { requestIdleCallback(loadAdSense, { timeout: 2000 }); }
        else { setTimeout(loadAdSense, 2000); }
      </script>
    <% end %>

    <%= stylesheet_link_tag :app, "data-turbo-track": "reload" %>
    <%= javascript_include_tag "application", "data-turbo-track": "reload", type: "module" %>
  </head>

  <body class="min-h-screen flex flex-col">
    <!-- 상단 공지 바: 실무.kr 돌아가기 링크 -->
    <div class="bg-blue-700 text-white text-sm py-2">
      <div class="max-w-5xl mx-auto px-4 flex items-center justify-between">
        <span class="flex items-center gap-2">
          <span class="material-symbols-outlined text-base">school</span>
          <strong>공공조달관리사 시험 대비</strong> — 2026년 첫 시험 준비 중
        </span>
        <a href="https://silmu.kr" class="flex items-center gap-1 text-blue-200 hover:text-white transition-colors text-xs">
          <span class="material-symbols-outlined text-sm">arrow_back</span>
          실무.kr로 돌아가기
        </a>
      </div>
    </div>

    <!-- Navigation -->
    <nav class="bg-white border-b border-blue-100 sticky top-0 z-50 shadow-sm">
      <div class="max-w-5xl mx-auto px-4">
        <div class="flex justify-between h-16">
          <!-- Logo -->
          <div class="flex items-center">
            <a href="https://exam.silmu.kr" class="flex items-center gap-3">
              <div class="w-9 h-9 bg-blue-600 rounded-xl flex items-center justify-center">
                <span class="material-symbols-outlined text-white text-xl">school</span>
              </div>
              <div>
                <span class="text-lg font-bold text-slate-900">공공조달관리사</span>
                <span class="text-xs text-blue-600 font-medium block leading-none">by 실무.kr</span>
              </div>
            </a>
          </div>

          <!-- Nav Links -->
          <div class="hidden md:flex items-center gap-1">
            <!-- 커리큘럼 드롭다운 -->
            <div class="relative group">
              <button class="flex items-center gap-1 px-3 py-2 text-slate-600 hover:text-blue-700 font-medium transition-colors text-sm rounded-lg hover:bg-slate-50">
                <span class="material-symbols-outlined text-base">school</span>
                커리큘럼
                <span class="material-symbols-outlined text-sm">expand_more</span>
              </button>
              <!-- 드롭다운 메뉴 -->
              <div class="absolute top-full left-0 mt-1 w-64 bg-white rounded-xl shadow-lg border border-slate-200 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-150 z-50">
                <div class="p-2">
                  <a href="<%= exam_subjects_path %>" class="flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-slate-50 transition-colors">
                    <div class="w-7 h-7 bg-slate-700 rounded-md flex items-center justify-center flex-shrink-0">
                      <span class="material-symbols-outlined text-white text-sm">format_list_numbered</span>
                    </div>
                    <div>
                      <div class="text-sm font-semibold text-slate-800">전체 커리큘럼</div>
                      <div class="text-xs text-slate-400">4권 27장 전체 보기</div>
                    </div>
                  </a>
                  <hr class="my-1.5 border-slate-100">
                  <% [
                    [1, "공공조달의 이해", "7장", "emerald", "account_balance"],
                    [2, "공공조달 계획분석", "6장", "blue", "analytics"],
                    [3, "공공계약관리", "6장", "violet", "handshake"],
                    [4, "공공조달 관리실무", "8장", "rose", "manage_accounts"]
                  ].each do |id, title, chapters, color, icon| %>
                    <a href="<%= exam_subject_path(id) %>" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50 transition-colors">
                      <div class="w-7 h-7 bg-<%= color %>-600 rounded-md flex items-center justify-center flex-shrink-0">
                        <span class="material-symbols-outlined text-white text-sm"><%= icon %></span>
                      </div>
                      <div class="min-w-0">
                        <div class="text-sm font-medium text-slate-800 truncate"><%= id %>권 <%= title %></div>
                        <div class="text-xs text-slate-400"><%= chapters %></div>
                      </div>
                    </a>
                  <% end %>
                  <hr class="my-1.5 border-slate-100">
                  <a href="<%= exam_keywords_path %>" class="flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-yellow-50 transition-colors">
                    <div class="w-7 h-7 bg-yellow-400 rounded-md flex items-center justify-center flex-shrink-0">
                      <span class="material-symbols-outlined text-yellow-900 text-sm">dictionary</span>
                    </div>
                    <div>
                      <div class="text-sm font-semibold text-slate-800">핵심 용어집</div>
                      <div class="text-xs text-slate-400">전체 키워드 한눈에</div>
                    </div>
                  </a>
                </div>
              </div>
            </div>

            <a href="<%= exam_quiz_index_path %>" class="flex items-center gap-1 px-3 py-2 text-slate-600 hover:text-blue-700 font-medium transition-colors text-sm rounded-lg hover:bg-slate-50">
              <span class="material-symbols-outlined text-base">quiz</span>
              모의고사
            </a>
            <a href="<%= exam_exam_info_path %>" class="px-3 py-2 text-slate-600 hover:text-blue-700 font-medium transition-colors text-sm rounded-lg hover:bg-slate-50">시험 정보</a>
            <a href="<%= exam_exam_strategy_path %>" class="flex items-center gap-1 px-3 py-2 text-slate-600 hover:text-amber-600 font-medium transition-colors text-sm rounded-lg hover:bg-amber-50">
              <span class="material-symbols-outlined text-base">emoji_events</span>
              합격 전략
            </a>
            <a href="https://silmu.kr/topics" class="px-3 py-2 text-slate-600 hover:text-blue-700 font-medium transition-colors text-sm rounded-lg hover:bg-slate-50">법령가이드</a>
            <a href="https://silmu.kr/audit-cases" class="px-3 py-2 text-slate-600 hover:text-blue-700 font-medium transition-colors text-sm rounded-lg hover:bg-slate-50">감사사례</a>
          </div>

          <!-- CTA -->
          <div class="flex items-center gap-2">
            <a href="<%= exam_subjects_path %>" class="hidden md:flex items-center gap-1 bg-blue-600 hover:bg-blue-700 text-white text-sm font-semibold px-4 py-2 rounded-lg transition-colors">
              <span class="material-symbols-outlined text-base">school</span>
              학습 시작
            </a>
            <!-- 모바일 메뉴 버튼 -->
            <button id="mobile-menu-btn" class="md:hidden p-2 text-slate-600 hover:text-blue-700 rounded-lg hover:bg-slate-50" aria-label="메뉴 열기">
              <span class="material-symbols-outlined">menu</span>
            </button>
          </div>
        </div>
      </div>
    </nav>

    <!-- Flash Messages -->
    <% if notice %>
      <div class="bg-emerald-50 border-l-4 border-emerald-500 px-4 py-4">
        <div class="max-w-5xl mx-auto flex items-center gap-3">
          <span class="material-symbols-outlined text-emerald-600">check_circle</span>
          <p class="text-emerald-800 font-medium"><%= notice %></p>
        </div>
      </div>
    <% end %>
    <% if alert %>
      <div class="bg-red-50 border-l-4 border-red-500 px-4 py-4">
        <div class="max-w-5xl mx-auto flex items-center gap-3">
          <span class="material-symbols-outlined text-red-600">error</span>
          <p class="text-red-800 font-medium"><%= alert %></p>
        </div>
      </div>
    <% end %>

    <!-- Main Content -->
    <main class="flex-1">
      <%= yield %>
    </main>

    <!-- Footer -->
    <footer class="bg-slate-900 text-white mt-auto">
      <div class="max-w-5xl mx-auto px-4 py-12">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
          <div>
            <div class="flex items-center gap-3 mb-4">
              <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center">
                <span class="material-symbols-outlined text-white text-sm">school</span>
              </div>
              <span class="text-lg font-bold">공공조달관리사</span>
            </div>
            <p class="text-slate-400 text-sm">2026년 신설 국가기술자격<br>시험 대비 전문 플랫폼</p>
            <p class="text-slate-500 text-xs mt-3">by 실무.kr</p>
          </div>
          <div>
            <h3 class="font-semibold mb-4">커리큘럼</h3>
            <ul class="space-y-2 text-sm">
              <li><a href="<%= exam_subjects_path %>" class="text-slate-400 hover:text-white transition-colors">전체 커리큘럼 (27장)</a></li>
              <li><a href="<%= exam_subject_path(1) %>" class="text-slate-400 hover:text-white transition-colors">1권 공공조달의 이해</a></li>
              <li><a href="<%= exam_subject_path(2) %>" class="text-slate-400 hover:text-white transition-colors">2권 공공조달 계획분석</a></li>
              <li><a href="<%= exam_subject_path(3) %>" class="text-slate-400 hover:text-white transition-colors">3권 공공계약관리</a></li>
              <li><a href="<%= exam_subject_path(4) %>" class="text-slate-400 hover:text-white transition-colors">4권 공공조달 관리실무</a></li>
              <li><a href="<%= exam_keywords_path %>" class="text-slate-400 hover:text-white transition-colors">핵심 용어집</a></li>
            </ul>
          </div>
          <div>
            <h3 class="font-semibold mb-4">시험 준비</h3>
            <ul class="space-y-2 text-sm">
              <li><a href="<%= exam_quiz_index_path %>" class="text-slate-400 hover:text-white transition-colors">모의고사</a></li>
              <li><a href="<%= exam_quiz_simulation_path %>" class="text-slate-400 hover:text-white transition-colors">실전 시험 모드</a></li>
              <li><a href="<%= exam_quiz_analysis_path %>" class="text-slate-400 hover:text-white transition-colors">학습 분석</a></li>
              <li><a href="<%= exam_exam_strategy_path %>" class="text-slate-400 hover:text-white transition-colors">합격 전략</a></li>
              <li><a href="<%= exam_exam_info_path %>" class="text-slate-400 hover:text-white transition-colors">시험 정보</a></li>
              <li>
                <a href="mailto:hello@silmu.kr" class="text-slate-400 hover:text-white transition-colors flex items-center gap-2 mt-3">
                  <span class="material-symbols-outlined text-base">mail</span>
                  hello@silmu.kr
                </a>
              </li>
            </ul>
          </div>
        </div>
        <div class="border-t border-slate-800 mt-8 pt-6">
          <p class="text-slate-500 text-xs text-center">&copy; <%= Time.current.year %> 실무.kr All rights reserved.</p>
        </div>
      </div>
    </footer>

    <!-- 모바일 메뉴 -->
    <div id="mobile-menu" class="hidden md:hidden fixed inset-0 z-50 bg-black/50">
      <div class="absolute right-0 top-0 h-full w-72 bg-white shadow-xl flex flex-col">
        <div class="flex items-center justify-between p-4 border-b border-slate-200">
          <span class="font-bold text-slate-900">메뉴</span>
          <button id="mobile-menu-close" class="p-2 text-slate-500 hover:text-slate-900 rounded-lg hover:bg-slate-100">
            <span class="material-symbols-outlined">close</span>
          </button>
        </div>
        <nav class="flex-1 overflow-y-auto p-4 space-y-1">
          <p class="text-xs font-semibold text-slate-400 uppercase tracking-wider px-3 pt-2 pb-1">커리큘럼</p>
          <a href="<%= exam_subjects_path %>" class="flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-slate-50 text-slate-700 font-medium">
            <span class="material-symbols-outlined text-slate-500 text-base">format_list_numbered</span>
            전체 커리큘럼
          </a>
          <% [
            [1, "공공조달의 이해", "emerald"],
            [2, "공공조달 계획분석", "blue"],
            [3, "공공계약관리", "violet"],
            [4, "공공조달 관리실무", "rose"]
          ].each do |id, title, color| %>
            <a href="<%= exam_subject_path(id) %>" class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-slate-50 text-slate-700">
              <span class="w-5 h-5 bg-<%= color %>-100 text-<%= color %>-700 rounded flex items-center justify-center text-xs font-bold flex-shrink-0"><%= id %></span>
              <span class="text-sm"><%= id %>권 <%= title %></span>
            </a>
          <% end %>
          <a href="<%= exam_keywords_path %>" class="flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-yellow-50 text-slate-700 font-medium">
            <span class="material-symbols-outlined text-yellow-500 text-base">dictionary</span>
            핵심 용어집
          </a>
          <a href="<%= exam_quiz_index_path %>" class="flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-blue-50 text-slate-700 font-medium">
            <span class="material-symbols-outlined text-blue-500 text-base">quiz</span>
            모의고사
          </a>
          <hr class="border-slate-200 my-2">
          <p class="text-xs font-semibold text-slate-400 uppercase tracking-wider px-3 pt-2 pb-1">더보기</p>
          <a href="<%= exam_exam_info_path %>" class="flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-slate-50 text-slate-700">
            <span class="material-symbols-outlined text-slate-500 text-base">info</span>
            시험 정보
          </a>
          <a href="<%= exam_exam_strategy_path %>" class="flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-amber-50 text-slate-700">
            <span class="material-symbols-outlined text-amber-500 text-base">emoji_events</span>
            합격 전략
          </a>
          <a href="https://silmu.kr/topics" class="flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-slate-50 text-slate-700">
            <span class="material-symbols-outlined text-slate-500 text-base">menu_book</span>
            법령가이드
          </a>
          <a href="https://silmu.kr/audit-cases" class="flex items-center gap-3 px-3 py-2.5 rounded-lg hover:bg-slate-50 text-slate-700">
            <span class="material-symbols-outlined text-slate-500 text-base">gavel</span>
            감사사례
          </a>
        </nav>
        <div class="p-4 border-t border-slate-200">
          <a href="<%= exam_subjects_path %>" class="flex items-center justify-center gap-2 bg-blue-600 text-white font-bold py-3 rounded-xl hover:bg-blue-700 transition-colors">
            <span class="material-symbols-outlined text-base">school</span>
            학습 시작하기
          </a>
        </div>
      </div>
    </div>

    <script>
      (function() {
        var btn = document.getElementById('mobile-menu-btn');
        var menu = document.getElementById('mobile-menu');
        var closeBtn = document.getElementById('mobile-menu-close');
        function openMenu() { menu && menu.classList.remove('hidden'); }
        function closeMenu() { menu && menu.classList.add('hidden'); }
        btn && btn.addEventListener('click', openMenu);
        closeBtn && closeBtn.addEventListener('click', closeMenu);
        menu && menu.addEventListener('click', function(e) {
          if (e.target === menu) closeMenu();
        });
        document.addEventListener('turbo:load', function() { closeMenu(); });
      })();
    </script>
  </body>
</html>
