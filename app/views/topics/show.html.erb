<div class="min-h-screen bg-gray-50">
  <!-- 헤더 -->
  <div class="bg-gradient-to-r from-indigo-600 to-indigo-800 text-white py-8">
    <div class="max-w-6xl mx-auto px-4">
      <div class="flex items-center gap-2 text-indigo-200 text-sm mb-2">
        <%= link_to "홈", chatbot_path, class: "hover:text-white" %> /
        <span><%= @topic.category_name %></span>
      </div>
      <h1 class="text-3xl font-bold mb-2"><%= @topic.name %></h1>
      <p class="text-indigo-100"><%= @topic.summary %></p>
      <div class="mt-4 flex flex-wrap gap-2">
        <% @topic.keyword_list.first(8).each do |keyword| %>
          <%= link_to "##{keyword}", chatbot_search_path(q: keyword),
              class: "px-3 py-1 bg-white/20 hover:bg-white/30 rounded text-sm text-white transition" %>
        <% end %>
      </div>
    </div>
  </div>

  <div class="max-w-6xl mx-auto px-4 py-8">
    <!-- 탭 네비게이션 -->
    <div class="bg-white rounded-xl shadow mb-6" id="topic-tabs">
      <div class="border-b overflow-x-auto">
        <nav class="flex whitespace-nowrap">
          <button onclick="showTab('law')" data-tab="law"
                  class="tab-btn px-6 py-4 font-medium text-indigo-600 border-b-2 border-indigo-600">
            📜 법령 3단 비교
          </button>
          <button onclick="showTab('regulation')" data-tab="regulation"
                  class="tab-btn px-6 py-4 font-medium text-gray-500 hover:text-gray-700">
            📋 예규/지침
          </button>
          <button onclick="showTab('interpretation')" data-tab="interpretation"
                  class="tab-btn px-6 py-4 font-medium text-gray-500 hover:text-gray-700">
            ⚖️ 유권해석
          </button>
          <button onclick="showTab('audit')" data-tab="audit"
                  class="tab-btn px-6 py-4 font-medium text-gray-500 hover:text-gray-700">
            🔍 감사사례
          </button>
          <button onclick="showTab('qa')" data-tab="qa"
                  class="tab-btn px-6 py-4 font-medium text-gray-500 hover:text-gray-700">
            💬 질의답변
          </button>
          <button onclick="showTab('tips')" data-tab="tips"
                  class="tab-btn px-6 py-4 font-medium text-gray-500 hover:text-gray-700">
            ⚠️ 실무주의
          </button>
          <button onclick="showTab('forms')" data-tab="forms"
                  class="tab-btn px-6 py-4 font-medium text-gray-500 hover:text-gray-700">
            📄 서식/양식
          </button>
          <button onclick="showTab('flowchart')" data-tab="flowchart"
                  class="tab-btn px-6 py-4 font-medium text-gray-500 hover:text-gray-700">
            🔄 흐름도
          </button>
        </nav>
      </div>

      <!-- 탭 콘텐츠 -->
      <div class="p-6">
        <!-- 법령 3단 비교 -->
        <div class="tab-panel" data-tab="law">
          <% if @topic.has_law_content? %>
            <div class="grid lg:grid-cols-3 gap-4">
              <!-- 법률 -->
              <div class="bg-blue-50 rounded-lg p-4">
                <h3 class="font-bold text-blue-800 mb-3 flex items-center gap-2">
                  <span class="w-6 h-6 bg-blue-600 text-white rounded text-xs flex items-center justify-center">법</span>
                  법률
                </h3>
                <div class="prose prose-sm prose-blue max-w-none text-gray-700">
                  <%= simple_format(@topic.law_content) %>
                </div>
              </div>
              <!-- 시행령 -->
              <div class="bg-green-50 rounded-lg p-4">
                <h3 class="font-bold text-green-800 mb-3 flex items-center gap-2">
                  <span class="w-6 h-6 bg-green-600 text-white rounded text-xs flex items-center justify-center">령</span>
                  시행령
                </h3>
                <div class="prose prose-sm prose-green max-w-none text-gray-700">
                  <%= simple_format(@topic.decree_content) %>
                </div>
              </div>
              <!-- 시행규칙 -->
              <div class="bg-amber-50 rounded-lg p-4">
                <h3 class="font-bold text-amber-800 mb-3 flex items-center gap-2">
                  <span class="w-6 h-6 bg-amber-600 text-white rounded text-xs flex items-center justify-center">칙</span>
                  시행규칙
                </h3>
                <div class="prose prose-sm prose-amber max-w-none text-gray-700">
                  <%= simple_format(@topic.rule_content) %>
                </div>
              </div>
            </div>
          <% else %>
            <p class="text-gray-500 text-center py-8">법령 정보가 준비 중입니다.</p>
          <% end %>
        </div>

        <!-- 예규/지침 -->
        <div class="tab-panel hidden" data-tab="regulation">
          <% if @topic.regulation_content.present? %>
            <div class="prose max-w-none">
              <%= simple_format(@topic.regulation_content) %>
            </div>
          <% else %>
            <p class="text-gray-500 text-center py-8">예규/지침 정보가 준비 중입니다.</p>
          <% end %>
        </div>

        <!-- 유권해석 -->
        <div class="tab-panel hidden" data-tab="interpretation">
          <% if @topic.interpretation_content.present? %>
            <div class="prose max-w-none">
              <%= simple_format(@topic.interpretation_content) %>
            </div>
          <% else %>
            <p class="text-gray-500 text-center py-8">유권해석 정보가 준비 중입니다.</p>
          <% end %>
        </div>

        <!-- 감사사례 -->
        <div class="tab-panel hidden" data-tab="audit">
          <% if @topic.audit_cases.present? %>
            <div class="prose max-w-none">
              <%= simple_format(@topic.audit_cases) %>
            </div>
          <% else %>
            <p class="text-gray-500 text-center py-8">감사사례 정보가 준비 중입니다.</p>
          <% end %>
        </div>

        <!-- 질의답변 -->
        <div class="tab-panel hidden" data-tab="qa">
          <% if @topic.qa_content.present? %>
            <div class="prose max-w-none">
              <%= simple_format(@topic.qa_content) %>
            </div>
          <% else %>
            <p class="text-gray-500 text-center py-8">질의답변 정보가 준비 중입니다.</p>
          <% end %>
        </div>

        <!-- 실무주의사항 -->
        <div class="tab-panel hidden" data-tab="tips">
          <% if @topic.practical_tips.present? %>
            <div class="prose max-w-none">
              <%= simple_format(@topic.practical_tips) %>
            </div>
          <% else %>
            <p class="text-gray-500 text-center py-8">실무주의사항이 준비 중입니다.</p>
          <% end %>
        </div>

        <!-- 서식/양식 -->
        <div class="tab-panel hidden" data-tab="forms">
          <!-- 필수 서식 목록 -->
          <div class="mb-8">
            <h3 class="text-lg font-bold text-gray-800 mb-4">📋 필수 서식</h3>
            <div class="grid md:grid-cols-2 gap-4">
              <a href="/forms/수의계약사유서.html" target="_blank"
                 class="block border border-gray-200 rounded-lg p-4 hover:border-indigo-300 hover:bg-indigo-50/50 transition">
                <div class="flex items-start gap-3">
                  <div class="w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center flex-shrink-0">
                    <svg class="w-5 h-5 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                  </div>
                  <div class="flex-1">
                    <h4 class="font-medium text-gray-800">수의계약 사유서</h4>
                    <p class="text-sm text-gray-500 mt-1">수의계약 체결 사유를 명시하는 필수 서류</p>
                    <div class="mt-2 flex flex-wrap gap-2">
                      <span class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded">별지 제5호 서식</span>
                    </div>
                  </div>
                </div>
              </a>

              <a href="/forms/견적서.html" target="_blank"
                 class="block border border-gray-200 rounded-lg p-4 hover:border-green-300 hover:bg-green-50/50 transition">
                <div class="flex items-start gap-3">
                  <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center flex-shrink-0">
                    <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                  </div>
                  <div class="flex-1">
                    <h4 class="font-medium text-gray-800">견적서</h4>
                    <p class="text-sm text-gray-500 mt-1">업체로부터 징구하는 가격 견적서</p>
                    <div class="mt-2 flex flex-wrap gap-2">
                      <span class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded">1인/2인 견적용</span>
                    </div>
                  </div>
                </div>
              </a>

              <a href="/forms/예정가격조서.html" target="_blank"
                 class="block border border-gray-200 rounded-lg p-4 hover:border-amber-300 hover:bg-amber-50/50 transition">
                <div class="flex items-start gap-3">
                  <div class="w-10 h-10 bg-amber-100 rounded-lg flex items-center justify-center flex-shrink-0">
                    <svg class="w-5 h-5 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                    </svg>
                  </div>
                  <div class="flex-1">
                    <h4 class="font-medium text-gray-800">예정가격 조서</h4>
                    <p class="text-sm text-gray-500 mt-1">예정가격 산출 근거 문서</p>
                    <div class="mt-2 flex flex-wrap gap-2">
                      <span class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded">거래실례가격/원가계산</span>
                    </div>
                  </div>
                </div>
              </a>

              <a href="/forms/검수조서.html" target="_blank"
                 class="block border border-gray-200 rounded-lg p-4 hover:border-purple-300 hover:bg-purple-50/50 transition">
                <div class="flex items-start gap-3">
                  <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center flex-shrink-0">
                    <svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                  </div>
                  <div class="flex-1">
                    <h4 class="font-medium text-gray-800">검수조서</h4>
                    <p class="text-sm text-gray-500 mt-1">납품/용역 완료 검수 확인서</p>
                    <div class="mt-2 flex flex-wrap gap-2">
                      <span class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded">대금지급 전 필수</span>
                    </div>
                  </div>
                </div>
              </a>
            </div>
          </div>

          <!-- 실무 도구 -->
          <div class="mb-8">
            <h3 class="text-lg font-bold text-gray-800 mb-4">🛠️ 실무 도구</h3>
            <div class="grid md:grid-cols-2 gap-4">
              <a href="/forms/견적서검토.html" target="_blank"
                 class="block border-2 border-purple-200 rounded-lg p-4 hover:border-purple-400 bg-gradient-to-br from-purple-50 to-indigo-50 hover:shadow-lg transition">
                <div class="flex items-start gap-3">
                  <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-xl flex items-center justify-center flex-shrink-0 shadow-md">
                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" />
                    </svg>
                  </div>
                  <div class="flex-1">
                    <h4 class="font-bold text-purple-800 text-lg">견적서 검토 시스템</h4>
                    <p class="text-sm text-gray-600 mt-1">업체에서 받은 견적서를 분석하여 법규 적합성, 가격 적정성, 주의사항을 리포트로 제공</p>
                    <div class="mt-3 flex flex-wrap gap-2">
                      <span class="text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded-full">자동 분석</span>
                      <span class="text-xs bg-indigo-100 text-indigo-700 px-2 py-1 rounded-full">리포트 생성</span>
                      <span class="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full">법규 검토</span>
                    </div>
                  </div>
                </div>
              </a>
            </div>
          </div>

          <!-- 공식 서식 다운로드 링크 -->
          <div class="mb-8">
            <h3 class="text-lg font-bold text-gray-800 mb-4">🔗 공식 서식 다운로드</h3>
            <div class="bg-gray-50 rounded-lg p-4">
              <div class="space-y-3">
                <a href="https://www.law.go.kr/행정규칙/지방자치단체입찰및계약집행기준" target="_blank" rel="noopener"
                   class="flex items-center gap-3 p-3 bg-white rounded-lg border border-gray-200 hover:border-blue-300 hover:shadow-sm transition">
                  <div class="w-8 h-8 bg-blue-600 rounded flex items-center justify-center flex-shrink-0">
                    <span class="text-white text-xs font-bold">법</span>
                  </div>
                  <div class="flex-1">
                    <div class="font-medium text-gray-800">국가법령정보센터</div>
                    <div class="text-sm text-gray-500">지방자치단체 입찰 및 계약집행기준 (별지 서식 포함)</div>
                  </div>
                  <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                  </svg>
                </a>

                <a href="https://www.mois.go.kr/frt/bbs/type001/commonSelectBoardList.do?bbsId=BBSMSTR_000000000061" target="_blank" rel="noopener"
                   class="flex items-center gap-3 p-3 bg-white rounded-lg border border-gray-200 hover:border-blue-300 hover:shadow-sm transition">
                  <div class="w-8 h-8 bg-green-600 rounded flex items-center justify-center flex-shrink-0">
                    <span class="text-white text-xs font-bold">행</span>
                  </div>
                  <div class="flex-1">
                    <div class="font-medium text-gray-800">행정안전부 지방계약 예규</div>
                    <div class="text-sm text-gray-500">계약일반조건, 입찰집행기준 등 HWP 다운로드</div>
                  </div>
                  <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                  </svg>
                </a>

                <a href="https://www.g2b.go.kr" target="_blank" rel="noopener"
                   class="flex items-center gap-3 p-3 bg-white rounded-lg border border-gray-200 hover:border-blue-300 hover:shadow-sm transition">
                  <div class="w-8 h-8 bg-purple-600 rounded flex items-center justify-center flex-shrink-0">
                    <span class="text-white text-xs font-bold">G2B</span>
                  </div>
                  <div class="flex-1">
                    <div class="font-medium text-gray-800">나라장터 (G2B)</div>
                    <div class="text-sm text-gray-500">조달청 수의계약 매뉴얼 및 서식</div>
                  </div>
                  <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                  </svg>
                </a>
              </div>
            </div>
          </div>

          <!-- 수의계약 사유서 작성 가이드 -->
          <div>
            <h3 class="text-lg font-bold text-gray-800 mb-4">✍️ 수의계약 사유서 작성 가이드</h3>
            <div class="bg-indigo-50 border border-indigo-200 rounded-lg p-5">
              <div class="space-y-4">
                <div>
                  <h4 class="font-medium text-indigo-800 mb-2">필수 기재 항목</h4>
                  <ul class="space-y-1 text-sm text-gray-700">
                    <li class="flex items-start gap-2">
                      <span class="text-indigo-500">①</span>
                      <span><strong>계약 건명</strong> - 사업/물품/용역명 명확히 기재</span>
                    </li>
                    <li class="flex items-start gap-2">
                      <span class="text-indigo-500">②</span>
                      <span><strong>추정가격</strong> - 예정가격 산출 근거 포함</span>
                    </li>
                    <li class="flex items-start gap-2">
                      <span class="text-indigo-500">③</span>
                      <span><strong>수의계약 사유</strong> - 법적 근거 조항 명시 (시행령 제25조 제1항 제O호)</span>
                    </li>
                    <li class="flex items-start gap-2">
                      <span class="text-indigo-500">④</span>
                      <span><strong>계약상대자 선정 사유</strong> - 특정 업체 선정 이유</span>
                    </li>
                  </ul>
                </div>

                <div class="border-t border-indigo-200 pt-4">
                  <h4 class="font-medium text-indigo-800 mb-2">작성 예시</h4>
                  <div class="bg-white rounded p-3 text-sm text-gray-700 font-mono">
                    <p class="mb-2"><strong>1. 계약건명:</strong> 2026년도 사무용품 구매</p>
                    <p class="mb-2"><strong>2. 추정가격:</strong> 15,000,000원 (부가세 포함)</p>
                    <p class="mb-2"><strong>3. 수의계약 사유:</strong></p>
                    <p class="pl-4 mb-2">지방계약법 시행령 제25조 제1항 제1호에 따라 추정가격이 물품구매 수의계약 기준금액(2,200만원) 이하이므로 수의계약 체결</p>
                    <p class="mb-2"><strong>4. 계약상대자:</strong> (주)OO상사</p>
                    <p class="pl-4">- 선정사유: 최저가 견적 제출업체</p>
                  </div>
                </div>

                <div class="bg-amber-50 border border-amber-200 rounded p-3">
                  <div class="flex items-start gap-2">
                    <span class="text-amber-500">⚠️</span>
                    <div class="text-sm text-amber-800">
                      <strong>주의:</strong> 수의계약 사유서는 반드시 <u>계약 체결 전</u>에 작성하여 결재를 받아야 합니다. 사후 작성은 감사 지적 대상입니다.
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 흐름도 -->
        <div class="tab-panel hidden" data-tab="flowchart">
          <h3 class="text-lg font-bold text-gray-800 mb-6 text-center">수의계약 업무 흐름도</h3>

          <!-- 전체 프로세스 개요 -->
          <div class="flex flex-wrap justify-center items-center gap-2 mb-8 text-sm">
            <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full font-medium">STEP 1 사전준비</span>
            <span class="text-gray-400">→</span>
            <span class="px-3 py-1 bg-green-100 text-green-700 rounded-full font-medium">STEP 2 견적징구</span>
            <span class="text-gray-400">→</span>
            <span class="px-3 py-1 bg-purple-100 text-purple-700 rounded-full font-medium">STEP 3 계약체결</span>
            <span class="text-gray-400">→</span>
            <span class="px-3 py-1 bg-amber-100 text-amber-700 rounded-full font-medium">STEP 4 이행/검수</span>
            <span class="text-gray-400">→</span>
            <span class="px-3 py-1 bg-rose-100 text-rose-700 rounded-full font-medium">STEP 5 대금지급</span>
          </div>

          <!-- 상세 흐름도 -->
          <div class="space-y-6">
            <!-- STEP 1: 사전준비 -->
            <div class="bg-blue-50 rounded-xl p-5 border-l-4 border-blue-500">
              <div class="flex items-center gap-3 mb-4">
                <div class="w-10 h-10 bg-blue-500 text-white rounded-full flex items-center justify-center font-bold">1</div>
                <h4 class="text-lg font-bold text-blue-800">사전준비 (사업부서)</h4>
              </div>
              <div class="grid md:grid-cols-4 gap-3">
                <div class="bg-white rounded-lg p-3 text-center shadow-sm">
                  <div class="text-2xl mb-1">📋</div>
                  <div class="text-sm font-medium text-gray-800">사업계획 수립</div>
                  <div class="text-xs text-gray-500 mt-1">필요성 검토</div>
                </div>
                <div class="flex items-center justify-center text-blue-300">
                  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                  </svg>
                </div>
                <div class="bg-white rounded-lg p-3 text-center shadow-sm">
                  <div class="text-2xl mb-1">💰</div>
                  <div class="text-sm font-medium text-gray-800">예산확보</div>
                  <div class="text-xs text-gray-500 mt-1">예산과목 확인</div>
                </div>
                <div class="flex items-center justify-center text-blue-300">
                  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                  </svg>
                </div>
                <div class="bg-white rounded-lg p-3 text-center shadow-sm">
                  <div class="text-2xl mb-1">🔢</div>
                  <div class="text-sm font-medium text-gray-800">예정가격 작성</div>
                  <div class="text-xs text-gray-500 mt-1">거래실례가격 조사</div>
                </div>
                <div class="flex items-center justify-center text-blue-300">
                  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                  </svg>
                </div>
                <div class="bg-white rounded-lg p-3 text-center shadow-sm">
                  <div class="text-2xl mb-1">📝</div>
                  <div class="text-sm font-medium text-gray-800">수의계약 사유서</div>
                  <div class="text-xs text-gray-500 mt-1">법적 근거 명시</div>
                </div>
              </div>
              <div class="mt-3 p-2 bg-blue-100 rounded text-sm text-blue-800">
                💡 <strong>체크포인트:</strong> 추정가격이 수의계약 기준금액 이내인지 확인 (물품/용역: 5천만원, 공사: 2억원)
              </div>
            </div>

            <!-- 금액 기준 분기 -->
            <div class="flex justify-center">
              <div class="bg-gray-100 rounded-xl p-4 inline-block">
                <div class="text-center mb-3">
                  <span class="text-sm font-medium text-gray-600">금액에 따른 견적 방법 결정</span>
                </div>
                <div class="flex gap-6">
                  <div class="text-center">
                    <div class="w-24 h-24 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-2 border-2 border-green-400">
                      <div>
                        <div class="text-xs text-green-600">물품/용역</div>
                        <div class="text-sm font-bold text-green-700">2,200만원↓</div>
                      </div>
                    </div>
                    <div class="text-xs font-medium text-green-700">1인 견적</div>
                  </div>
                  <div class="text-center">
                    <div class="w-24 h-24 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-2 border-2 border-blue-400">
                      <div>
                        <div class="text-xs text-blue-600">물품/용역</div>
                        <div class="text-sm font-bold text-blue-700">5천만원↓</div>
                      </div>
                    </div>
                    <div class="text-xs font-medium text-blue-700">2인 이상 견적</div>
                  </div>
                  <div class="text-center">
                    <div class="w-24 h-24 bg-amber-100 rounded-full flex items-center justify-center mx-auto mb-2 border-2 border-amber-400">
                      <div>
                        <div class="text-xs text-amber-600">공사</div>
                        <div class="text-sm font-bold text-amber-700">5천만원↓</div>
                      </div>
                    </div>
                    <div class="text-xs font-medium text-amber-700">1인 견적</div>
                  </div>
                  <div class="text-center">
                    <div class="w-24 h-24 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-2 border-2 border-purple-400">
                      <div>
                        <div class="text-xs text-purple-600">공사</div>
                        <div class="text-sm font-bold text-purple-700">2억원↓</div>
                      </div>
                    </div>
                    <div class="text-xs font-medium text-purple-700">2인 이상 견적</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- STEP 2: 견적징구 -->
            <div class="bg-green-50 rounded-xl p-5 border-l-4 border-green-500">
              <div class="flex items-center gap-3 mb-4">
                <div class="w-10 h-10 bg-green-500 text-white rounded-full flex items-center justify-center font-bold">2</div>
                <h4 class="text-lg font-bold text-green-800">견적징구 (사업부서/계약부서)</h4>
              </div>
              <div class="grid md:grid-cols-3 gap-4">
                <div class="bg-white rounded-lg p-4 shadow-sm">
                  <div class="text-2xl mb-2 text-center">📨</div>
                  <div class="text-sm font-medium text-gray-800 text-center mb-2">견적요청</div>
                  <ul class="text-xs text-gray-600 space-y-1">
                    <li>• 동일 규격/조건 제시</li>
                    <li>• 견적 마감일시 명시</li>
                    <li>• 제출방법 안내</li>
                  </ul>
                </div>
                <div class="bg-white rounded-lg p-4 shadow-sm">
                  <div class="text-2xl mb-2 text-center">📬</div>
                  <div class="text-sm font-medium text-gray-800 text-center mb-2">견적서 접수</div>
                  <ul class="text-xs text-gray-600 space-y-1">
                    <li>• 1인 또는 2인 이상</li>
                    <li>• 사업자등록증 확인</li>
                    <li>• 마감일시 준수 확인</li>
                  </ul>
                </div>
                <div class="bg-white rounded-lg p-4 shadow-sm">
                  <div class="text-2xl mb-2 text-center">✅</div>
                  <div class="text-sm font-medium text-gray-800 text-center mb-2">계약상대자 선정</div>
                  <ul class="text-xs text-gray-600 space-y-1">
                    <li>• 예정가격 이하 확인</li>
                    <li>• 최저가 업체 선정</li>
                    <li>• 적격성 검토</li>
                  </ul>
                </div>
              </div>
              <div class="mt-3 p-2 bg-green-100 rounded text-sm text-green-800">
                ⚠️ <strong>주의:</strong> 견적서는 반드시 계약 체결 <u>전</u>에 징구해야 합니다. 사후 징구는 감사 지적!
              </div>
            </div>

            <!-- STEP 3: 계약체결 -->
            <div class="bg-purple-50 rounded-xl p-5 border-l-4 border-purple-500">
              <div class="flex items-center gap-3 mb-4">
                <div class="w-10 h-10 bg-purple-500 text-white rounded-full flex items-center justify-center font-bold">3</div>
                <h4 class="text-lg font-bold text-purple-800">계약체결 (계약부서)</h4>
              </div>
              <div class="grid md:grid-cols-4 gap-3">
                <div class="bg-white rounded-lg p-3 text-center shadow-sm">
                  <div class="text-2xl mb-1">📑</div>
                  <div class="text-sm font-medium text-gray-800">계약서 작성</div>
                  <div class="text-xs text-gray-500 mt-1">계약조건 명시</div>
                </div>
                <div class="bg-white rounded-lg p-3 text-center shadow-sm">
                  <div class="text-2xl mb-1">🔏</div>
                  <div class="text-sm font-medium text-gray-800">계약 날인</div>
                  <div class="text-xs text-gray-500 mt-1">쌍방 서명/날인</div>
                </div>
                <div class="bg-white rounded-lg p-3 text-center shadow-sm">
                  <div class="text-2xl mb-1">💳</div>
                  <div class="text-sm font-medium text-gray-800">보증금</div>
                  <div class="text-xs text-gray-500 mt-1">5천만원↓ 면제가능</div>
                </div>
                <div class="bg-white rounded-lg p-3 text-center shadow-sm">
                  <div class="text-2xl mb-1">📤</div>
                  <div class="text-sm font-medium text-gray-800">계약통지</div>
                  <div class="text-xs text-gray-500 mt-1">계약상대자 통보</div>
                </div>
              </div>
            </div>

            <!-- STEP 4: 이행/검수 -->
            <div class="bg-amber-50 rounded-xl p-5 border-l-4 border-amber-500">
              <div class="flex items-center gap-3 mb-4">
                <div class="w-10 h-10 bg-amber-500 text-white rounded-full flex items-center justify-center font-bold">4</div>
                <h4 class="text-lg font-bold text-amber-800">이행 및 검수 (사업부서)</h4>
              </div>
              <div class="grid md:grid-cols-3 gap-4">
                <div class="bg-white rounded-lg p-4 shadow-sm">
                  <div class="text-2xl mb-2 text-center">🚚</div>
                  <div class="text-sm font-medium text-gray-800 text-center mb-2">계약이행</div>
                  <ul class="text-xs text-gray-600 space-y-1">
                    <li>• 납품/용역 수행</li>
                    <li>• 이행기간 준수</li>
                    <li>• 진행상황 관리</li>
                  </ul>
                </div>
                <div class="bg-white rounded-lg p-4 shadow-sm">
                  <div class="text-2xl mb-2 text-center">🔍</div>
                  <div class="text-sm font-medium text-gray-800 text-center mb-2">검수</div>
                  <ul class="text-xs text-gray-600 space-y-1">
                    <li>• 규격/수량 확인</li>
                    <li>• 품질 검사</li>
                    <li>• 하자 여부 점검</li>
                  </ul>
                </div>
                <div class="bg-white rounded-lg p-4 shadow-sm">
                  <div class="text-2xl mb-2 text-center">📋</div>
                  <div class="text-sm font-medium text-gray-800 text-center mb-2">검수조서 작성</div>
                  <ul class="text-xs text-gray-600 space-y-1">
                    <li>• 검수일자 기록</li>
                    <li>• 검수자 서명</li>
                    <li>• 합격/불합격 판정</li>
                  </ul>
                </div>
              </div>
            </div>

            <!-- STEP 5: 대금지급 -->
            <div class="bg-rose-50 rounded-xl p-5 border-l-4 border-rose-500">
              <div class="flex items-center gap-3 mb-4">
                <div class="w-10 h-10 bg-rose-500 text-white rounded-full flex items-center justify-center font-bold">5</div>
                <h4 class="text-lg font-bold text-rose-800">대금지급 (회계부서)</h4>
              </div>
              <div class="grid md:grid-cols-4 gap-3">
                <div class="bg-white rounded-lg p-3 text-center shadow-sm">
                  <div class="text-2xl mb-1">🧾</div>
                  <div class="text-sm font-medium text-gray-800">세금계산서</div>
                  <div class="text-xs text-gray-500 mt-1">적격 여부 확인</div>
                </div>
                <div class="bg-white rounded-lg p-3 text-center shadow-sm">
                  <div class="text-2xl mb-1">📄</div>
                  <div class="text-sm font-medium text-gray-800">지출결의</div>
                  <div class="text-xs text-gray-500 mt-1">지출원인행위</div>
                </div>
                <div class="bg-white rounded-lg p-3 text-center shadow-sm">
                  <div class="text-2xl mb-1">🏦</div>
                  <div class="text-sm font-medium text-gray-800">대금이체</div>
                  <div class="text-xs text-gray-500 mt-1">5일 이내 지급</div>
                </div>
                <div class="bg-white rounded-lg p-3 text-center shadow-sm">
                  <div class="text-2xl mb-1">📁</div>
                  <div class="text-sm font-medium text-gray-800">서류보관</div>
                  <div class="text-xs text-gray-500 mt-1">5년간 보존</div>
                </div>
              </div>
              <div class="mt-3 p-2 bg-rose-100 rounded text-sm text-rose-800">
                📌 <strong>법적근거:</strong> 지방계약법 시행령 제108조 - 검사완료 후 5일 이내 대금 지급
              </div>
            </div>
          </div>

          <!-- 전체 요약 -->
          <div class="mt-8 bg-gray-800 text-white rounded-xl p-6">
            <h4 class="font-bold text-lg mb-4 text-center">📌 수의계약 핵심 체크포인트</h4>
            <div class="grid md:grid-cols-3 gap-4 text-sm">
              <div class="bg-gray-700 rounded-lg p-3">
                <div class="text-yellow-400 font-medium mb-2">🚫 절대 금지</div>
                <ul class="space-y-1 text-gray-300">
                  <li>• 분할계약 (감사 1순위)</li>
                  <li>• 사후 견적서 징구</li>
                  <li>• 예정가격 미작성</li>
                </ul>
              </div>
              <div class="bg-gray-700 rounded-lg p-3">
                <div class="text-green-400 font-medium mb-2">✅ 필수 서류</div>
                <ul class="space-y-1 text-gray-300">
                  <li>• 수의계약 사유서</li>
                  <li>• 견적서 (1인/2인)</li>
                  <li>• 예정가격 조서</li>
                </ul>
              </div>
              <div class="bg-gray-700 rounded-lg p-3">
                <div class="text-blue-400 font-medium mb-2">💡 실무 팁</div>
                <ul class="space-y-1 text-gray-300">
                  <li>• 견적 마감일시 명확히</li>
                  <li>• 동일 조건으로 요청</li>
                  <li>• 서류는 시간순 정리</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 시각자료 -->
    <% if @topic.infographic_url.present? || @topic.flowchart_url.present? || @topic.video_url.present? %>
      <div class="bg-white rounded-xl shadow p-6 mb-6">
        <h2 class="text-lg font-bold mb-4">📊 시각자료</h2>
        <div class="grid md:grid-cols-3 gap-4">
          <% if @topic.infographic_url.present? %>
            <a href="<%= @topic.infographic_url %>" target="_blank" class="block p-4 bg-gray-50 rounded-lg hover:bg-gray-100 text-center">
              <div class="text-3xl mb-2">🖼️</div>
              <span class="text-sm font-medium">인포그래픽 보기</span>
            </a>
          <% end %>
          <% if @topic.flowchart_url.present? %>
            <a href="<%= @topic.flowchart_url %>" target="_blank" class="block p-4 bg-gray-50 rounded-lg hover:bg-gray-100 text-center">
              <div class="text-3xl mb-2">📋</div>
              <span class="text-sm font-medium">순서도 보기</span>
            </a>
          <% end %>
          <% if @topic.video_url.present? %>
            <a href="<%= @topic.video_url %>" target="_blank" class="block p-4 bg-gray-50 rounded-lg hover:bg-gray-100 text-center">
              <div class="text-3xl mb-2">🎬</div>
              <span class="text-sm font-medium">동영상 보기</span>
            </a>
          <% end %>
        </div>
      </div>
    <% end %>

    <!-- 자주 묻는 질문 (아코디언) -->
    <% if @topic.faq_list.any? %>
      <div class="bg-white rounded-xl shadow p-6">
        <h2 class="text-lg font-bold mb-4">❓ 자주 묻는 질문</h2>
        <div class="space-y-2" id="faq-accordion">
          <% @topic.faq_list.each_with_index do |faq, index| %>
            <div class="border border-gray-200 rounded-lg overflow-hidden">
              <button onclick="toggleFaq(<%= index %>)"
                      class="w-full px-4 py-3 text-left bg-gray-50 hover:bg-gray-100 flex items-center justify-between transition-colors">
                <span class="font-medium text-gray-800">Q. <%= faq['question'] %></span>
                <svg id="faq-icon-<%= index %>" class="w-5 h-5 text-gray-500 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
              </button>
              <div id="faq-answer-<%= index %>" class="hidden px-4 py-3 bg-white border-t border-gray-200">
                <p class="text-gray-700 whitespace-pre-line"><%= faq['answer'] %></p>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
</div>

<script>
function toggleFaq(index) {
  const answer = document.getElementById(`faq-answer-${index}`);
  const icon = document.getElementById(`faq-icon-${index}`);

  if (answer.classList.contains('hidden')) {
    answer.classList.remove('hidden');
    icon.classList.add('rotate-180');
  } else {
    answer.classList.add('hidden');
    icon.classList.remove('rotate-180');
  }
}

function showTab(tabName) {
  // 모든 탭 버튼 스타일 초기화
  document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.classList.remove('text-indigo-600', 'border-b-2', 'border-indigo-600');
    btn.classList.add('text-gray-500');
  });

  // 선택된 탭 버튼 스타일 적용
  const activeBtn = document.querySelector(`.tab-btn[data-tab="${tabName}"]`);
  if (activeBtn) {
    activeBtn.classList.remove('text-gray-500');
    activeBtn.classList.add('text-indigo-600', 'border-b-2', 'border-indigo-600');
  }

  // 모든 패널 숨기기
  document.querySelectorAll('.tab-panel').forEach(panel => {
    panel.classList.add('hidden');
  });

  // 선택된 패널 보이기
  const activePanel = document.querySelector(`.tab-panel[data-tab="${tabName}"]`);
  if (activePanel) {
    activePanel.classList.remove('hidden');
  }
}
</script>
