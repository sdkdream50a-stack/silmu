<%# 주제 상세 페이지 - Stitch 디자인 기반 리뉴얼 %>

<!-- 페이지 헤더 -->
<section class="bg-gradient-to-r from-navy-600 to-navy-800 text-white py-10">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- 브레드크럼 -->
    <div class="flex items-center gap-2 text-navy-200 text-sm mb-4">
      <%= link_to root_path, class: "hover:text-white transition-colors" do %>
        <span class="material-symbols-outlined text-sm align-middle">home</span>
        홈
      <% end %>
      <span class="material-symbols-outlined text-sm">chevron_right</span>
      <span><%= @topic.category_name %></span>
      <span class="material-symbols-outlined text-sm">chevron_right</span>
      <span class="text-white"><%= @topic.name %></span>
    </div>

    <div class="lg:flex lg:items-start lg:justify-between">
      <div class="flex-1">
        <div class="flex items-center gap-4 mb-3">
          <div class="w-14 h-14 bg-white/20 rounded-xl flex items-center justify-center">
            <span class="material-symbols-outlined text-3xl text-white">gavel</span>
          </div>
          <div>
            <h1 class="text-3xl font-bold"><%= @topic.name %></h1>
            <p class="text-navy-100 mt-1"><%= @topic.summary %></p>
          </div>
        </div>

        <!-- 키워드 태그 -->
        <div class="flex flex-wrap gap-2 mt-4">
          <% @topic.keyword_list.first(8).each do |keyword| %>
            <%= link_to chatbot_search_path(q: keyword),
                class: "px-3 py-1.5 bg-white/10 hover:bg-white/20 backdrop-blur rounded-full text-sm text-white transition-colors flex items-center gap-1" do %>
              <span class="material-symbols-outlined text-sm">tag</span>
              <%= keyword %>
            <% end %>
          <% end %>
        </div>
      </div>

      <!-- 액션 버튼 -->
      <div class="mt-6 lg:mt-0 flex gap-3">
        <button class="px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg text-sm font-medium transition-colors flex items-center gap-2">
          <span class="material-symbols-outlined text-lg">bookmark_border</span>
          저장
        </button>
        <button class="px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg text-sm font-medium transition-colors flex items-center gap-2">
          <span class="material-symbols-outlined text-lg">share</span>
          공유
        </button>
      </div>
    </div>
  </div>
</section>

<!-- 탭 네비게이션 -->
<section class="bg-white border-b sticky top-16 z-40 shadow-sm">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <nav class="flex gap-1 overflow-x-auto py-2 -mx-4 px-4" id="topic-tabs">
      <button onclick="showTab('law')" data-tab="law"
              class="tab-btn px-5 py-2.5 bg-navy-600 text-white rounded-full text-sm font-medium whitespace-nowrap flex items-center gap-2 transition-all">
        <span class="material-symbols-outlined text-lg">balance</span>
        법령 3단 비교
      </button>
      <button onclick="showTab('regulation')" data-tab="regulation"
              class="tab-btn px-5 py-2.5 bg-gray-100 text-gray-700 hover:bg-gray-200 rounded-full text-sm font-medium whitespace-nowrap flex items-center gap-2 transition-all">
        <span class="material-symbols-outlined text-lg">description</span>
        예규/지침
      </button>
      <button onclick="showTab('interpretation')" data-tab="interpretation"
              class="tab-btn px-5 py-2.5 bg-gray-100 text-gray-700 hover:bg-gray-200 rounded-full text-sm font-medium whitespace-nowrap flex items-center gap-2 transition-all">
        <span class="material-symbols-outlined text-lg">policy</span>
        유권해석
      </button>
      <button onclick="showTab('audit')" data-tab="audit"
              class="tab-btn px-5 py-2.5 bg-gray-100 text-gray-700 hover:bg-gray-200 rounded-full text-sm font-medium whitespace-nowrap flex items-center gap-2 transition-all">
        <span class="material-symbols-outlined text-lg">search</span>
        감사사례
      </button>
      <button onclick="showTab('qa')" data-tab="qa"
              class="tab-btn px-5 py-2.5 bg-gray-100 text-gray-700 hover:bg-gray-200 rounded-full text-sm font-medium whitespace-nowrap flex items-center gap-2 transition-all">
        <span class="material-symbols-outlined text-lg">forum</span>
        질의답변
      </button>
      <button onclick="showTab('tips')" data-tab="tips"
              class="tab-btn px-5 py-2.5 bg-gray-100 text-gray-700 hover:bg-gray-200 rounded-full text-sm font-medium whitespace-nowrap flex items-center gap-2 transition-all">
        <span class="material-symbols-outlined text-lg">lightbulb</span>
        실무주의
      </button>
      <button onclick="showTab('forms')" data-tab="forms"
              class="tab-btn px-5 py-2.5 bg-gray-100 text-gray-700 hover:bg-gray-200 rounded-full text-sm font-medium whitespace-nowrap flex items-center gap-2 transition-all">
        <span class="material-symbols-outlined text-lg">draft</span>
        서식/양식
      </button>
      <button onclick="showTab('flowchart')" data-tab="flowchart"
              class="tab-btn px-5 py-2.5 bg-gray-100 text-gray-700 hover:bg-gray-200 rounded-full text-sm font-medium whitespace-nowrap flex items-center gap-2 transition-all">
        <span class="material-symbols-outlined text-lg">account_tree</span>
        흐름도
      </button>
    </nav>
  </div>
</section>

<!-- 메인 콘텐츠 -->
<section class="py-8">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="lg:flex lg:gap-8">
      <!-- 메인 콘텐츠 영역 -->
      <div class="flex-1 min-w-0">
        <!-- 법령 3단 비교 -->
        <div class="tab-panel" data-tab="law">
          <% if @topic.has_law_content? %>
            <div class="grid lg:grid-cols-3 gap-6">
              <!-- 법률 -->
              <div class="bg-white rounded-2xl border border-blue-200 overflow-hidden hover:shadow-lg transition-shadow">
                <div class="bg-gradient-to-r from-blue-500 to-blue-600 px-5 py-4">
                  <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center">
                      <span class="text-white font-bold text-lg">법</span>
                    </div>
                    <div>
                      <h3 class="font-bold text-white text-lg">법률</h3>
                      <p class="text-blue-100 text-sm">국가계약법/지방계약법</p>
                    </div>
                  </div>
                </div>
                <div class="p-5">
                  <div class="prose prose-sm max-w-none text-gray-700">
                    <%= simple_format(@topic.law_content) %>
                  </div>
                </div>
              </div>

              <!-- 시행령 -->
              <div class="bg-white rounded-2xl border border-green-200 overflow-hidden hover:shadow-lg transition-shadow">
                <div class="bg-gradient-to-r from-green-500 to-green-600 px-5 py-4">
                  <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center">
                      <span class="text-white font-bold text-lg">령</span>
                    </div>
                    <div>
                      <h3 class="font-bold text-white text-lg">시행령</h3>
                      <p class="text-green-100 text-sm">대통령령</p>
                    </div>
                  </div>
                </div>
                <div class="p-5">
                  <div class="prose prose-sm max-w-none text-gray-700">
                    <%= simple_format(@topic.decree_content) %>
                  </div>
                </div>
              </div>

              <!-- 시행규칙 -->
              <div class="bg-white rounded-2xl border border-amber-200 overflow-hidden hover:shadow-lg transition-shadow">
                <div class="bg-gradient-to-r from-amber-500 to-amber-600 px-5 py-4">
                  <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center">
                      <span class="text-white font-bold text-lg">칙</span>
                    </div>
                    <div>
                      <h3 class="font-bold text-white text-lg">시행규칙</h3>
                      <p class="text-amber-100 text-sm">부령</p>
                    </div>
                  </div>
                </div>
                <div class="p-5">
                  <div class="prose prose-sm max-w-none text-gray-700">
                    <%= simple_format(@topic.rule_content) %>
                  </div>
                </div>
              </div>
            </div>
          <% else %>
            <div class="bg-white rounded-2xl border border-gray-200 p-12 text-center">
              <span class="material-symbols-outlined text-6xl text-gray-300 mb-4">description</span>
              <p class="text-gray-500">법령 정보가 준비 중입니다.</p>
            </div>
          <% end %>
        </div>

        <!-- 예규/지침 -->
        <div class="tab-panel hidden" data-tab="regulation">
          <% if @topic.regulation_content.present? %>
            <div class="bg-white rounded-2xl border border-gray-200 p-6">
              <div class="prose max-w-none">
                <%= simple_format(@topic.regulation_content) %>
              </div>
            </div>
          <% else %>
            <div class="bg-white rounded-2xl border border-gray-200 p-12 text-center">
              <span class="material-symbols-outlined text-6xl text-gray-300 mb-4">description</span>
              <p class="text-gray-500">예규/지침 정보가 준비 중입니다.</p>
            </div>
          <% end %>
        </div>

        <!-- 유권해석 -->
        <div class="tab-panel hidden" data-tab="interpretation">
          <% if @topic.interpretation_content.present? %>
            <div class="bg-white rounded-2xl border border-gray-200 p-6">
              <div class="prose max-w-none">
                <%= simple_format(@topic.interpretation_content) %>
              </div>
            </div>
          <% else %>
            <div class="bg-white rounded-2xl border border-gray-200 p-12 text-center">
              <span class="material-symbols-outlined text-6xl text-gray-300 mb-4">policy</span>
              <p class="text-gray-500">유권해석 정보가 준비 중입니다.</p>
            </div>
          <% end %>
        </div>

        <!-- 감사사례 -->
        <div class="tab-panel hidden" data-tab="audit">
          <% if @topic.audit_cases.present? %>
            <div class="bg-white rounded-2xl border border-gray-200 p-6">
              <div class="prose max-w-none">
                <%= simple_format(@topic.audit_cases) %>
              </div>
            </div>
          <% else %>
            <div class="bg-white rounded-2xl border border-gray-200 p-12 text-center">
              <span class="material-symbols-outlined text-6xl text-gray-300 mb-4">search</span>
              <p class="text-gray-500">감사사례 정보가 준비 중입니다.</p>
            </div>
          <% end %>
        </div>

        <!-- 질의답변 -->
        <div class="tab-panel hidden" data-tab="qa">
          <% if @topic.qa_content.present? %>
            <div class="bg-white rounded-2xl border border-gray-200 p-6">
              <div class="prose max-w-none">
                <%= simple_format(@topic.qa_content) %>
              </div>
            </div>
          <% else %>
            <div class="bg-white rounded-2xl border border-gray-200 p-12 text-center">
              <span class="material-symbols-outlined text-6xl text-gray-300 mb-4">forum</span>
              <p class="text-gray-500">질의답변 정보가 준비 중입니다.</p>
            </div>
          <% end %>
        </div>

        <!-- 실무주의 -->
        <div class="tab-panel hidden" data-tab="tips">
          <% if @topic.practical_tips.present? %>
            <div class="bg-white rounded-2xl border border-gray-200 p-6">
              <div class="prose max-w-none">
                <%= simple_format(@topic.practical_tips) %>
              </div>
            </div>
          <% else %>
            <div class="bg-white rounded-2xl border border-gray-200 p-12 text-center">
              <span class="material-symbols-outlined text-6xl text-gray-300 mb-4">lightbulb</span>
              <p class="text-gray-500">실무주의사항이 준비 중입니다.</p>
            </div>
          <% end %>
        </div>

        <!-- 서식/양식 -->
        <div class="tab-panel hidden" data-tab="forms">
          <!-- 필수 서식 -->
          <div class="mb-8">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-xl font-bold text-gray-900 flex items-center gap-2">
                <span class="material-symbols-outlined text-indigo-600">folder_open</span>
                필수 서식
              </h3>
              <%= link_to templates_path, class: "text-sm text-navy-600 hover:underline flex items-center gap-1" do %>
                전체보기
                <span class="material-symbols-outlined text-sm">arrow_forward</span>
              <% end %>
            </div>

            <div class="grid sm:grid-cols-2 gap-4">
              <% [
                { title: "수의계약 사유서", desc: "수의계약 체결 사유를 명시하는 필수 서류", badge: "별지 제5호 서식", color: "indigo", path: "/forms/수의계약사유서.html" },
                { title: "견적서", desc: "업체로부터 징구하는 가격 견적서", badge: "1인/2인 견적용", color: "green", path: "/forms/견적서.html" },
                { title: "예정가격 조서", desc: "예정가격 산출 근거 문서", badge: "거래실례가격/원가계산", color: "amber", path: "/forms/예정가격조서.html" },
                { title: "검수조서", desc: "납품/용역 완료 검수 확인서", badge: "대금지급 전 필수", color: "purple", path: "/forms/검수조서.html" }
              ].each do |form| %>
                <a href="<%= form[:path] %>" target="_blank"
                   class="group bg-white rounded-xl border border-gray-200 p-5 hover:border-<%= form[:color] %>-300 hover:shadow-lg transition-all">
                  <div class="flex items-start gap-4">
                    <div class="w-12 h-12 bg-<%= form[:color] %>-100 rounded-xl flex items-center justify-center shrink-0 group-hover:bg-<%= form[:color] %>-600 transition-colors">
                      <span class="material-symbols-outlined text-2xl text-<%= form[:color] %>-600 group-hover:text-white transition-colors">description</span>
                    </div>
                    <div class="flex-1 min-w-0">
                      <h4 class="font-semibold text-gray-900 group-hover:text-<%= form[:color] %>-600 transition-colors"><%= form[:title] %></h4>
                      <p class="text-sm text-gray-500 mt-1"><%= form[:desc] %></p>
                      <span class="inline-block mt-2 text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded-full"><%= form[:badge] %></span>
                    </div>
                    <span class="material-symbols-outlined text-gray-400 group-hover:text-<%= form[:color] %>-600 transition-colors">open_in_new</span>
                  </div>
                </a>
              <% end %>
            </div>
          </div>

          <!-- 실무 도구 -->
          <div class="mb-8">
            <h3 class="text-xl font-bold text-gray-900 flex items-center gap-2 mb-4">
              <span class="material-symbols-outlined text-purple-600">construction</span>
              실무 도구
            </h3>

            <a href="/forms/견적서검토.html" target="_blank"
               class="group block bg-gradient-to-br from-purple-50 to-indigo-50 rounded-2xl border-2 border-purple-200 p-6 hover:border-purple-400 hover:shadow-xl transition-all">
              <div class="flex items-start gap-4">
                <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-2xl flex items-center justify-center shadow-lg shrink-0">
                  <span class="material-symbols-outlined text-3xl text-white">fact_check</span>
                </div>
                <div class="flex-1">
                  <div class="flex items-center gap-2 mb-1">
                    <h4 class="text-xl font-bold text-purple-800">견적서 검토 시스템</h4>
                    <span class="text-xs bg-purple-100 text-purple-700 px-2 py-0.5 rounded-full font-medium">AI</span>
                  </div>
                  <p class="text-gray-600">업체에서 받은 견적서를 분석하여 법규 적합성, 가격 적정성, 주의사항을 리포트로 제공</p>
                  <div class="mt-3 flex flex-wrap gap-2">
                    <span class="text-xs bg-purple-100 text-purple-700 px-3 py-1 rounded-full">자동 분석</span>
                    <span class="text-xs bg-indigo-100 text-indigo-700 px-3 py-1 rounded-full">리포트 생성</span>
                    <span class="text-xs bg-blue-100 text-blue-700 px-3 py-1 rounded-full">법규 검토</span>
                  </div>
                </div>
                <span class="material-symbols-outlined text-2xl text-purple-400 group-hover:translate-x-1 transition-transform">arrow_forward</span>
              </div>
            </a>
          </div>

          <!-- 공식 서식 다운로드 -->
          <div class="mb-8">
            <h3 class="text-xl font-bold text-gray-900 flex items-center gap-2 mb-4">
              <span class="material-symbols-outlined text-blue-600">link</span>
              공식 서식 다운로드
            </h3>

            <div class="bg-gray-50 rounded-xl p-4 space-y-3">
              <% [
                { title: "국가법령정보센터", desc: "지방자치단체 입찰 및 계약집행기준 (별지 서식 포함)", icon: "balance", color: "blue", url: "https://www.law.go.kr/행정규칙/지방자치단체입찰및계약집행기준" },
                { title: "행정안전부 지방계약 예규", desc: "계약일반조건, 입찰집행기준 등 HWP 다운로드", icon: "apartment", color: "green", url: "https://www.mois.go.kr/frt/bbs/type001/commonSelectBoardList.do?bbsId=BBSMSTR_000000000061" },
                { title: "나라장터 (G2B)", desc: "조달청 수의계약 매뉴얼 및 서식", icon: "public", color: "purple", url: "https://www.g2b.go.kr" }
              ].each do |link| %>
                <a href="<%= link[:url] %>" target="_blank" rel="noopener"
                   class="flex items-center gap-4 p-4 bg-white rounded-xl border border-gray-200 hover:border-<%= link[:color] %>-300 hover:shadow-md transition-all">
                  <div class="w-10 h-10 bg-<%= link[:color] %>-600 rounded-lg flex items-center justify-center shrink-0">
                    <span class="material-symbols-outlined text-white"><%= link[:icon] %></span>
                  </div>
                  <div class="flex-1 min-w-0">
                    <div class="font-medium text-gray-900"><%= link[:title] %></div>
                    <div class="text-sm text-gray-500 truncate"><%= link[:desc] %></div>
                  </div>
                  <span class="material-symbols-outlined text-gray-400">open_in_new</span>
                </a>
              <% end %>
            </div>
          </div>

          <!-- 작성 가이드 -->
          <div>
            <h3 class="text-xl font-bold text-gray-900 flex items-center gap-2 mb-4">
              <span class="material-symbols-outlined text-indigo-600">edit_note</span>
              수의계약 사유서 작성 가이드
            </h3>

            <div class="bg-indigo-50 border border-indigo-200 rounded-2xl p-6">
              <div class="space-y-5">
                <div>
                  <h4 class="font-semibold text-indigo-800 mb-3 flex items-center gap-2">
                    <span class="material-symbols-outlined">checklist</span>
                    필수 기재 항목
                  </h4>
                  <div class="grid sm:grid-cols-2 gap-3">
                    <% [
                      { num: "1", title: "계약 건명", desc: "사업/물품/용역명 명확히 기재" },
                      { num: "2", title: "추정가격", desc: "예정가격 산출 근거 포함" },
                      { num: "3", title: "수의계약 사유", desc: "법적 근거 조항 명시" },
                      { num: "4", title: "계약상대자 선정 사유", desc: "특정 업체 선정 이유" }
                    ].each do |item| %>
                      <div class="flex items-start gap-3 bg-white rounded-lg p-3">
                        <span class="w-6 h-6 bg-indigo-600 text-white rounded-full flex items-center justify-center text-sm font-bold shrink-0"><%= item[:num] %></span>
                        <div>
                          <div class="font-medium text-gray-900"><%= item[:title] %></div>
                          <div class="text-sm text-gray-500"><%= item[:desc] %></div>
                        </div>
                      </div>
                    <% end %>
                  </div>
                </div>

                <div class="border-t border-indigo-200 pt-5">
                  <h4 class="font-semibold text-indigo-800 mb-3 flex items-center gap-2">
                    <span class="material-symbols-outlined">code</span>
                    작성 예시
                  </h4>
                  <div class="bg-white rounded-lg p-4 text-sm text-gray-700 font-mono space-y-2">
                    <p><span class="text-indigo-600 font-semibold">1. 계약건명:</span> 2026년도 사무용품 구매</p>
                    <p><span class="text-indigo-600 font-semibold">2. 추정가격:</span> 15,000,000원 (부가세 포함)</p>
                    <p><span class="text-indigo-600 font-semibold">3. 수의계약 사유:</span></p>
                    <p class="pl-4 text-gray-600">지방계약법 시행령 제25조 제1항 제1호에 따라 추정가격이 물품구매 수의계약 기준금액(2,200만원) 이하이므로 수의계약 체결</p>
                    <p><span class="text-indigo-600 font-semibold">4. 계약상대자:</span> (주)OO상사</p>
                    <p class="pl-4 text-gray-600">- 선정사유: 최저가 견적 제출업체</p>
                  </div>
                </div>

                <div class="bg-amber-50 border border-amber-200 rounded-xl p-4">
                  <div class="flex items-start gap-3">
                    <span class="material-symbols-outlined text-amber-600">warning</span>
                    <div class="text-sm text-amber-800">
                      <strong>주의:</strong> 수의계약 사유서는 반드시 <u>계약 체결 전</u>에 작성하여 결재를 받아야 합니다. 사후 작성은 감사 지적 대상입니다.
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 흐름도 -->
        <div class="tab-panel hidden" data-tab="flowchart">
          <div class="bg-white rounded-2xl border border-gray-200 p-6">
            <h3 class="text-xl font-bold text-gray-900 text-center mb-6 flex items-center justify-center gap-2">
              <span class="material-symbols-outlined text-navy-600">account_tree</span>
              수의계약 업무 흐름도
            </h3>

            <!-- 프로세스 개요 -->
            <div class="flex flex-wrap justify-center items-center gap-3 mb-8">
              <% [
                { step: "1", title: "사전준비", color: "blue" },
                { step: "2", title: "견적징구", color: "green" },
                { step: "3", title: "계약체결", color: "purple" },
                { step: "4", title: "이행/검수", color: "amber" },
                { step: "5", title: "대금지급", color: "rose" }
              ].each_with_index do |item, index| %>
                <div class="flex items-center gap-2 px-4 py-2 bg-<%= item[:color] %>-100 text-<%= item[:color] %>-700 rounded-full font-medium text-sm">
                  <span class="w-6 h-6 bg-<%= item[:color] %>-600 text-white rounded-full flex items-center justify-center text-xs font-bold"><%= item[:step] %></span>
                  <%= item[:title] %>
                </div>
                <% unless index == 4 %>
                  <span class="material-symbols-outlined text-gray-400">arrow_forward</span>
                <% end %>
              <% end %>
            </div>

            <!-- 상세 흐름도 -->
            <div class="space-y-6">
              <!-- STEP 1 -->
              <div class="bg-blue-50 rounded-2xl p-6 border-l-4 border-blue-500">
                <div class="flex items-center gap-3 mb-5">
                  <div class="w-12 h-12 bg-blue-500 text-white rounded-xl flex items-center justify-center font-bold text-xl">1</div>
                  <div>
                    <h4 class="text-lg font-bold text-blue-800">사전준비</h4>
                    <p class="text-blue-600 text-sm">사업부서</p>
                  </div>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                  <% [
                    { icon: "assignment", title: "사업계획 수립", desc: "필요성 검토" },
                    { icon: "payments", title: "예산확보", desc: "예산과목 확인" },
                    { icon: "calculate", title: "예정가격 작성", desc: "거래실례가격 조사" },
                    { icon: "edit_document", title: "수의계약 사유서", desc: "법적 근거 명시" }
                  ].each do |item| %>
                    <div class="bg-white rounded-xl p-4 text-center shadow-sm">
                      <span class="material-symbols-outlined text-3xl text-blue-500 mb-2"><%= item[:icon] %></span>
                      <div class="text-sm font-medium text-gray-800"><%= item[:title] %></div>
                      <div class="text-xs text-gray-500 mt-1"><%= item[:desc] %></div>
                    </div>
                  <% end %>
                </div>
                <div class="mt-4 p-3 bg-blue-100 rounded-xl text-sm text-blue-800 flex items-center gap-2">
                  <span class="material-symbols-outlined">lightbulb</span>
                  <strong>체크포인트:</strong> 추정가격이 수의계약 기준금액 이내인지 확인 (물품/용역: 5천만원, 공사: 2억원)
                </div>
              </div>

              <!-- 금액 기준 분기 -->
              <div class="flex justify-center">
                <div class="bg-gray-100 rounded-2xl p-6 inline-block">
                  <div class="text-center mb-4">
                    <span class="text-sm font-semibold text-gray-600">금액에 따른 견적 방법 결정</span>
                  </div>
                  <div class="flex flex-wrap justify-center gap-4">
                    <% [
                      { type: "물품/용역", amount: "2,200만원 이하", method: "1인 견적", color: "green" },
                      { type: "물품/용역", amount: "5천만원 이하", method: "2인 이상 견적", color: "blue" },
                      { type: "공사", amount: "5천만원 이하", method: "1인 견적", color: "amber" },
                      { type: "공사", amount: "2억원 이하", method: "2인 이상 견적", color: "purple" }
                    ].each do |item| %>
                      <div class="text-center">
                        <div class="w-24 h-24 bg-<%= item[:color] %>-100 rounded-full flex items-center justify-center border-2 border-<%= item[:color] %>-400">
                          <div>
                            <div class="text-xs text-<%= item[:color] %>-600"><%= item[:type] %></div>
                            <div class="text-sm font-bold text-<%= item[:color] %>-700"><%= item[:amount] %></div>
                          </div>
                        </div>
                        <div class="text-xs font-medium text-<%= item[:color] %>-700 mt-2"><%= item[:method] %></div>
                      </div>
                    <% end %>
                  </div>
                </div>
              </div>

              <!-- STEP 2 -->
              <div class="bg-green-50 rounded-2xl p-6 border-l-4 border-green-500">
                <div class="flex items-center gap-3 mb-5">
                  <div class="w-12 h-12 bg-green-500 text-white rounded-xl flex items-center justify-center font-bold text-xl">2</div>
                  <div>
                    <h4 class="text-lg font-bold text-green-800">견적징구</h4>
                    <p class="text-green-600 text-sm">사업부서/계약부서</p>
                  </div>
                </div>
                <div class="grid md:grid-cols-3 gap-4">
                  <% [
                    { icon: "outgoing_mail", title: "견적요청", items: ["동일 규격/조건 제시", "견적 마감일시 명시", "제출방법 안내"] },
                    { icon: "inbox", title: "견적서 접수", items: ["1인 또는 2인 이상", "사업자등록증 확인", "마감일시 준수 확인"] },
                    { icon: "how_to_reg", title: "계약상대자 선정", items: ["예정가격 이하 확인", "최저가 업체 선정", "적격성 검토"] }
                  ].each do |item| %>
                    <div class="bg-white rounded-xl p-5 shadow-sm">
                      <div class="flex items-center justify-center mb-3">
                        <span class="material-symbols-outlined text-3xl text-green-500"><%= item[:icon] %></span>
                      </div>
                      <div class="text-sm font-medium text-gray-800 text-center mb-3"><%= item[:title] %></div>
                      <ul class="text-xs text-gray-600 space-y-1">
                        <% item[:items].each do |i| %>
                          <li class="flex items-center gap-1">
                            <span class="material-symbols-outlined text-xs text-green-500">check</span>
                            <%= i %>
                          </li>
                        <% end %>
                      </ul>
                    </div>
                  <% end %>
                </div>
                <div class="mt-4 p-3 bg-amber-100 rounded-xl text-sm text-amber-800 flex items-center gap-2">
                  <span class="material-symbols-outlined">warning</span>
                  <strong>주의:</strong> 견적서는 반드시 계약 체결 <u>전</u>에 징구해야 합니다. 사후 징구는 감사 지적!
                </div>
              </div>

              <!-- STEP 3 -->
              <div class="bg-purple-50 rounded-2xl p-6 border-l-4 border-purple-500">
                <div class="flex items-center gap-3 mb-5">
                  <div class="w-12 h-12 bg-purple-500 text-white rounded-xl flex items-center justify-center font-bold text-xl">3</div>
                  <div>
                    <h4 class="text-lg font-bold text-purple-800">계약체결</h4>
                    <p class="text-purple-600 text-sm">계약부서</p>
                  </div>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                  <% [
                    { icon: "article", title: "계약서 작성", desc: "계약조건 명시" },
                    { icon: "verified", title: "계약 날인", desc: "쌍방 서명/날인" },
                    { icon: "account_balance_wallet", title: "보증금", desc: "5천만원 이하 면제가능" },
                    { icon: "send", title: "계약통지", desc: "계약상대자 통보" }
                  ].each do |item| %>
                    <div class="bg-white rounded-xl p-4 text-center shadow-sm">
                      <span class="material-symbols-outlined text-3xl text-purple-500 mb-2"><%= item[:icon] %></span>
                      <div class="text-sm font-medium text-gray-800"><%= item[:title] %></div>
                      <div class="text-xs text-gray-500 mt-1"><%= item[:desc] %></div>
                    </div>
                  <% end %>
                </div>
              </div>

              <!-- STEP 4 -->
              <div class="bg-amber-50 rounded-2xl p-6 border-l-4 border-amber-500">
                <div class="flex items-center gap-3 mb-5">
                  <div class="w-12 h-12 bg-amber-500 text-white rounded-xl flex items-center justify-center font-bold text-xl">4</div>
                  <div>
                    <h4 class="text-lg font-bold text-amber-800">이행 및 검수</h4>
                    <p class="text-amber-600 text-sm">사업부서</p>
                  </div>
                </div>
                <div class="grid md:grid-cols-3 gap-4">
                  <% [
                    { icon: "local_shipping", title: "계약이행", items: ["납품/용역 수행", "이행기간 준수", "진행상황 관리"] },
                    { icon: "search", title: "검수", items: ["규격/수량 확인", "품질 검사", "하자 여부 점검"] },
                    { icon: "task", title: "검수조서 작성", items: ["검수일자 기록", "검수자 서명", "합격/불합격 판정"] }
                  ].each do |item| %>
                    <div class="bg-white rounded-xl p-5 shadow-sm">
                      <div class="flex items-center justify-center mb-3">
                        <span class="material-symbols-outlined text-3xl text-amber-500"><%= item[:icon] %></span>
                      </div>
                      <div class="text-sm font-medium text-gray-800 text-center mb-3"><%= item[:title] %></div>
                      <ul class="text-xs text-gray-600 space-y-1">
                        <% item[:items].each do |i| %>
                          <li class="flex items-center gap-1">
                            <span class="material-symbols-outlined text-xs text-amber-500">check</span>
                            <%= i %>
                          </li>
                        <% end %>
                      </ul>
                    </div>
                  <% end %>
                </div>
              </div>

              <!-- STEP 5 -->
              <div class="bg-rose-50 rounded-2xl p-6 border-l-4 border-rose-500">
                <div class="flex items-center gap-3 mb-5">
                  <div class="w-12 h-12 bg-rose-500 text-white rounded-xl flex items-center justify-center font-bold text-xl">5</div>
                  <div>
                    <h4 class="text-lg font-bold text-rose-800">대금지급</h4>
                    <p class="text-rose-600 text-sm">회계부서</p>
                  </div>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                  <% [
                    { icon: "receipt", title: "세금계산서", desc: "적격 여부 확인" },
                    { icon: "request_quote", title: "지출결의", desc: "지출원인행위" },
                    { icon: "account_balance", title: "대금이체", desc: "5일 이내 지급" },
                    { icon: "folder", title: "서류보관", desc: "5년간 보존" }
                  ].each do |item| %>
                    <div class="bg-white rounded-xl p-4 text-center shadow-sm">
                      <span class="material-symbols-outlined text-3xl text-rose-500 mb-2"><%= item[:icon] %></span>
                      <div class="text-sm font-medium text-gray-800"><%= item[:title] %></div>
                      <div class="text-xs text-gray-500 mt-1"><%= item[:desc] %></div>
                    </div>
                  <% end %>
                </div>
                <div class="mt-4 p-3 bg-rose-100 rounded-xl text-sm text-rose-800 flex items-center gap-2">
                  <span class="material-symbols-outlined">gavel</span>
                  <strong>법적근거:</strong> 지방계약법 시행령 제108조 - 검사완료 후 5일 이내 대금 지급
                </div>
              </div>
            </div>

            <!-- 핵심 체크포인트 -->
            <div class="mt-8 bg-gray-800 text-white rounded-2xl p-6">
              <h4 class="font-bold text-lg mb-5 text-center flex items-center justify-center gap-2">
                <span class="material-symbols-outlined">push_pin</span>
                수의계약 핵심 체크포인트
              </h4>
              <div class="grid md:grid-cols-3 gap-4">
                <div class="bg-gray-700 rounded-xl p-4">
                  <div class="text-red-400 font-semibold mb-3 flex items-center gap-2">
                    <span class="material-symbols-outlined">block</span>
                    절대 금지
                  </div>
                  <ul class="space-y-2 text-gray-300 text-sm">
                    <li class="flex items-center gap-2">
                      <span class="material-symbols-outlined text-sm text-red-400">close</span>
                      분할계약 (감사 1순위)
                    </li>
                    <li class="flex items-center gap-2">
                      <span class="material-symbols-outlined text-sm text-red-400">close</span>
                      사후 견적서 징구
                    </li>
                    <li class="flex items-center gap-2">
                      <span class="material-symbols-outlined text-sm text-red-400">close</span>
                      예정가격 미작성
                    </li>
                  </ul>
                </div>
                <div class="bg-gray-700 rounded-xl p-4">
                  <div class="text-green-400 font-semibold mb-3 flex items-center gap-2">
                    <span class="material-symbols-outlined">check_circle</span>
                    필수 서류
                  </div>
                  <ul class="space-y-2 text-gray-300 text-sm">
                    <li class="flex items-center gap-2">
                      <span class="material-symbols-outlined text-sm text-green-400">check</span>
                      수의계약 사유서
                    </li>
                    <li class="flex items-center gap-2">
                      <span class="material-symbols-outlined text-sm text-green-400">check</span>
                      견적서 (1인/2인)
                    </li>
                    <li class="flex items-center gap-2">
                      <span class="material-symbols-outlined text-sm text-green-400">check</span>
                      예정가격 조서
                    </li>
                  </ul>
                </div>
                <div class="bg-gray-700 rounded-xl p-4">
                  <div class="text-blue-400 font-semibold mb-3 flex items-center gap-2">
                    <span class="material-symbols-outlined">tips_and_updates</span>
                    실무 팁
                  </div>
                  <ul class="space-y-2 text-gray-300 text-sm">
                    <li class="flex items-center gap-2">
                      <span class="material-symbols-outlined text-sm text-blue-400">star</span>
                      견적 마감일시 명확히
                    </li>
                    <li class="flex items-center gap-2">
                      <span class="material-symbols-outlined text-sm text-blue-400">star</span>
                      동일 조건으로 요청
                    </li>
                    <li class="flex items-center gap-2">
                      <span class="material-symbols-outlined text-sm text-blue-400">star</span>
                      서류는 시간순 정리
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 자주 묻는 질문 -->
        <% if @topic.faq_list.any? %>
          <div class="bg-white rounded-2xl border border-gray-200 p-6 mt-8">
            <h2 class="text-xl font-bold text-gray-900 mb-5 flex items-center gap-2">
              <span class="material-symbols-outlined text-amber-500">help</span>
              자주 묻는 질문
            </h2>
            <div class="space-y-3" id="faq-accordion">
              <% @topic.faq_list.each_with_index do |faq, index| %>
                <div class="border border-gray-200 rounded-xl overflow-hidden">
                  <button onclick="toggleFaq(<%= index %>)"
                          class="w-full px-5 py-4 text-left bg-gray-50 hover:bg-gray-100 flex items-center justify-between transition-colors">
                    <span class="font-medium text-gray-800 flex items-center gap-2">
                      <span class="w-6 h-6 bg-amber-100 text-amber-600 rounded-full flex items-center justify-center text-sm font-bold">Q</span>
                      <%= faq['question'] %>
                    </span>
                    <span id="faq-icon-<%= index %>" class="material-symbols-outlined text-gray-500 transition-transform">expand_more</span>
                  </button>
                  <div id="faq-answer-<%= index %>" class="hidden px-5 py-4 bg-white border-t border-gray-200">
                    <div class="flex gap-2">
                      <span class="w-6 h-6 bg-navy-100 text-navy-600 rounded-full flex items-center justify-center text-sm font-bold shrink-0">A</span>
                      <p class="text-gray-700 whitespace-pre-line"><%= faq['answer'] %></p>
                    </div>
                  </div>
                </div>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>

      <!-- 사이드바 -->
      <div class="lg:w-[320px] shrink-0 mt-8 lg:mt-0">
        <div class="sticky top-36 space-y-6">
          <!-- 퀵 링크 -->
          <div class="bg-white rounded-2xl border border-gray-200 p-5">
            <h3 class="font-bold text-gray-900 mb-4 flex items-center gap-2">
              <span class="material-symbols-outlined text-navy-600">bolt</span>
              빠른 이동
            </h3>
            <nav class="space-y-2">
              <% [
                { tab: "law", icon: "balance", title: "법령 3단 비교" },
                { tab: "forms", icon: "draft", title: "서식/양식" },
                { tab: "flowchart", icon: "account_tree", title: "흐름도" },
                { tab: "tips", icon: "lightbulb", title: "실무주의" }
              ].each do |item| %>
                <button onclick="showTab('<%= item[:tab] %>')"
                        class="w-full flex items-center gap-3 px-4 py-3 text-gray-600 hover:bg-gray-50 rounded-xl transition-colors text-left">
                  <span class="material-symbols-outlined text-gray-400"><%= item[:icon] %></span>
                  <span class="text-sm font-medium"><%= item[:title] %></span>
                </button>
              <% end %>
            </nav>
          </div>

          <!-- 관련 도구 -->
          <div class="bg-gradient-to-br from-indigo-50 to-purple-50 rounded-2xl border border-indigo-200 p-5">
            <h3 class="font-bold text-gray-900 mb-4 flex items-center gap-2">
              <span class="material-symbols-outlined text-indigo-600">build</span>
              관련 도구
            </h3>
            <div class="space-y-3">
              <a href="/forms/견적서검토.html" target="_blank"
                 class="block p-3 bg-white rounded-xl border border-indigo-100 hover:border-indigo-300 hover:shadow-md transition-all">
                <div class="flex items-center gap-3">
                  <div class="w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center">
                    <span class="material-symbols-outlined text-indigo-600">fact_check</span>
                  </div>
                  <div>
                    <div class="font-medium text-gray-900 text-sm">견적서 검토</div>
                    <div class="text-xs text-gray-500">AI 자동 분석</div>
                  </div>
                </div>
              </a>
              <%= link_to travel_calculator_path,
                  class: "block p-3 bg-white rounded-xl border border-indigo-100 hover:border-indigo-300 hover:shadow-md transition-all" do %>
                <div class="flex items-center gap-3">
                  <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                    <span class="material-symbols-outlined text-blue-600">calculate</span>
                  </div>
                  <div>
                    <div class="font-medium text-gray-900 text-sm">여비계산기</div>
                    <div class="text-xs text-gray-500">출장 여비 계산</div>
                  </div>
                </div>
              <% end %>
            </div>
          </div>

          <!-- 문의하기 -->
          <div class="bg-navy-600 rounded-2xl p-5 text-white">
            <div class="flex items-center gap-3 mb-3">
              <span class="material-symbols-outlined text-2xl">support_agent</span>
              <div>
                <h3 class="font-bold">도움이 필요하신가요?</h3>
                <p class="text-navy-200 text-sm">궁금한 점을 물어보세요</p>
              </div>
            </div>
            <%= link_to chatbot_path,
                class: "block w-full py-3 bg-white text-navy-600 rounded-xl font-medium text-center hover:bg-navy-50 transition-colors" do %>
              AI 상담 시작하기
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
function toggleFaq(index) {
  const answer = document.getElementById(`faq-answer-${index}`);
  const icon = document.getElementById(`faq-icon-${index}`);

  if (answer.classList.contains('hidden')) {
    answer.classList.remove('hidden');
    icon.textContent = 'expand_less';
  } else {
    answer.classList.add('hidden');
    icon.textContent = 'expand_more';
  }
}

function showTab(tabName) {
  // 모든 탭 버튼 스타일 초기화
  document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.classList.remove('bg-navy-600', 'text-white');
    btn.classList.add('bg-gray-100', 'text-gray-700', 'hover:bg-gray-200');
  });

  // 선택된 탭 버튼 스타일 적용
  const activeBtn = document.querySelector(`.tab-btn[data-tab="${tabName}"]`);
  if (activeBtn) {
    activeBtn.classList.remove('bg-gray-100', 'text-gray-700', 'hover:bg-gray-200');
    activeBtn.classList.add('bg-navy-600', 'text-white');
  }

  // 모든 패널 숨기기
  document.querySelectorAll('.tab-panel').forEach(panel => {
    panel.classList.add('hidden');
  });

  // 선택된 패널 보이기
  const activePanel = document.querySelector(`.tab-panel[data-tab="${tabName}"]`);
  if (activePanel) {
    activePanel.classList.remove('hidden');
  }

  // 스크롤 위치 조정 (모바일에서 탭 클릭 시)
  window.scrollTo({ top: document.querySelector('#topic-tabs').offsetTop - 80, behavior: 'smooth' });
}
</script>
