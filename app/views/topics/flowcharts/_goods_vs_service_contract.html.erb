<!-- ë¬¼í’ˆêµ¬ë§¤ vs ìš©ì—­ê³„ì•½ êµ¬ë¶„ ì‹¤ë¬´íë¦„ë„ -->
<div class="card">
  <div class="card-header">
    <h2 class="text-xl font-bold text-slate-900 flex items-center gap-3">
      <span class="material-symbols-outlined text-indigo-500">account_tree</span>
      ë¬¼í’ˆÂ·ìš©ì—­ êµ¬ë¶„ ì‹¤ë¬´íë¦„ë„
    </h2>
    <p class="text-slate-600 mt-1">ê³„ì•½ ëŒ€ìƒì´ ë¬¼í’ˆì¸ì§€ ìš©ì—­ì¸ì§€ íŒë‹¨í•˜ê³  ì ì • ê³„ì•½ë°©ë²•ì„ ê²°ì •í•˜ëŠ” ì ˆì°¨</p>
  </div>

  <div class="p-6">
    <div class="mb-6 p-3 bg-blue-50 border border-blue-200 rounded-xl text-sm text-blue-800 flex items-start gap-2">
      <span class="material-symbols-outlined text-blue-500 mt-0.5" style="font-size:18px">help</span>
      <span><strong>ë¬¼í’ˆ</strong>ì€ ìœ í˜•ì˜ ì¬í™” ì·¨ë“(ì†Œìœ ê¶Œ ì´ì „), <strong>ìš©ì—­</strong>ì€ ë…¸ë¬´Â·ì„œë¹„ìŠ¤ ì œê³µì…ë‹ˆë‹¤. êµ¬ë¶„ì´ ì¤‘ìš”í•œ ì´ìœ ëŠ” ê³„ì•½ê¸ˆì•¡ ê¸°ì¤€(ìˆ˜ì˜ê³„ì•½ í•œë„, ì ê²©ì‹¬ì‚¬ ë“±)ì´ ë‹¬ë¼ì§€ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. (ì§€ë°©ê³„ì•½ë²• ì œ2ì¡°, ì‹œí–‰ë ¹ ì œ2ì¡°)</span>
    </div>

    <div class="space-y-4">
      <!-- Step 1 -->
      <div class="flex items-start gap-4">
        <div class="flex-shrink-0 w-10 h-10 bg-indigo-500 text-white rounded-full flex items-center justify-center font-bold">1</div>
        <div class="flex-1 bg-indigo-50 rounded-xl p-4 border border-indigo-200">
          <h4 class="font-semibold text-indigo-800 mb-2">ê³„ì•½ ëŒ€ìƒ ë¶„ì„</h4>
          <ul class="text-sm text-slate-700 space-y-1">
            <li>â€¢ ë¬´ì—‡ì„ êµ¬ë§¤Â·ì œê³µë°›ëŠ”ê°€? (ê²°ê³¼ë¬¼ íŒŒì•…)</li>
            <li>â€¢ ì†Œìœ ê¶Œ ì´ì „ì´ ìˆëŠ”ê°€? (ë¬¼í’ˆ: ìˆìŒ / ìš©ì—­: ì—†ìŒ)</li>
            <li>â€¢ ì„¤ì¹˜Â·ì‹œìš´ì „ì´ í¬í•¨ëœ ê²½ìš°: ì£¼ëœ ëª©ì  íŒŒì•…</li>
          </ul>
        </div>
      </div>

      <div class="flex justify-center"><span class="material-symbols-outlined text-slate-300 text-2xl">arrow_downward</span></div>

      <!-- Step 2: êµ¬ë¶„ íŒë‹¨ -->
      <div class="flex items-start gap-4">
        <div class="flex-shrink-0 w-10 h-10 bg-blue-500 text-white rounded-full flex items-center justify-center font-bold">2</div>
        <div class="flex-1 bg-blue-50 rounded-xl p-4 border border-blue-200">
          <h4 class="font-semibold text-blue-800 mb-3">ë¬¼í’ˆ vs ìš©ì—­ êµ¬ë¶„ íŒë‹¨</h4>
          <div class="grid md:grid-cols-2 gap-3 mb-3">
            <div class="p-3 bg-white rounded-xl border-2 border-blue-300">
              <div class="flex items-center gap-2 mb-2">
                <span class="material-symbols-outlined text-blue-500">inventory_2</span>
                <div class="font-bold text-blue-700 text-sm">ë¬¼í’ˆêµ¬ë§¤</div>
              </div>
              <ul class="text-xs text-slate-600 space-y-1">
                <li>â€¢ ê¸°ê³„Â·ì¥ë¹„Â·ì†Œëª¨í’ˆÂ·ì˜ì•½í’ˆ ì·¨ë“</li>
                <li>â€¢ ì†Œìœ ê¶Œì´ ê¸°ê´€ìœ¼ë¡œ ì´ì „</li>
                <li>â€¢ ì„¤ì¹˜ë¹„ê°€ ë¬¼í’ˆê°€ì˜ 30% ì´í•˜</li>
                <li class="text-blue-600 font-medium">ì˜ˆ: ëƒ‰ë‚œë°©ê¸° êµ¬ë§¤, PC êµ¬ë§¤</li>
              </ul>
            </div>
            <div class="p-3 bg-white rounded-xl border-2 border-violet-300">
              <div class="flex items-center gap-2 mb-2">
                <span class="material-symbols-outlined text-violet-500">engineering</span>
                <div class="font-bold text-violet-700 text-sm">ìš©ì—­ê³„ì•½</div>
              </div>
              <ul class="text-xs text-slate-600 space-y-1">
                <li>â€¢ ì—°êµ¬Â·ì„¤ê³„Â·ì²­ì†ŒÂ·ê²½ë¹„Â·ITê°œë°œ</li>
                <li>â€¢ ì†Œìœ ê¶Œ ì´ì „ ì—†ìŒ (ì„œë¹„ìŠ¤Â·ê²°ê³¼ë¬¼)</li>
                <li>â€¢ ì¸ì  ì—­ë¬´ê°€ í•µì‹¬</li>
                <li class="text-violet-600 font-medium">ì˜ˆ: ì†Œí”„íŠ¸ì›¨ì–´ ê°œë°œ, ì²­ì†Œ ìš©ì—­</li>
              </ul>
            </div>
          </div>
          <div class="p-3 bg-amber-50 rounded-lg border border-amber-200 text-xs text-amber-800">
            âš ï¸ <strong>í˜¼í•© ê³„ì•½(ë¬¼í’ˆ + ìš©ì—­):</strong> ë¹„ì¤‘ì´ ë†’ì€ ìª½ìœ¼ë¡œ ë¶„ë¥˜. ë¬¼í’ˆ ê°€ì•¡ 70% ì´ìƒì´ë©´ ë¬¼í’ˆê³„ì•½
          </div>
        </div>
      </div>

      <div class="flex justify-center"><span class="material-symbols-outlined text-slate-300 text-2xl">arrow_downward</span></div>

      <!-- Step 3 -->
      <div class="flex items-start gap-4">
        <div class="flex-shrink-0 w-10 h-10 bg-amber-500 text-white rounded-full flex items-center justify-center font-bold">3</div>
        <div class="flex-1 bg-amber-50 rounded-xl p-4 border border-amber-200">
          <h4 class="font-semibold text-amber-800 mb-3">ê³„ì•½ë°©ë²• ê²°ì • (ê¸ˆì•¡ ê¸°ì¤€ ì ìš©)</h4>
          <div class="grid md:grid-cols-2 gap-3 text-sm">
            <div class="p-3 bg-white rounded-lg border border-amber-100">
              <div class="font-bold text-blue-700 mb-1">ğŸ“¦ ë¬¼í’ˆêµ¬ë§¤ ê¸°ì¤€</div>
              <ul class="text-xs text-slate-600 space-y-0.5">
                <li>â€¢ 2ì²œë§Œì› ì´í•˜: ìˆ˜ì˜ (1ì¸ ê²¬ì )</li>
                <li>â€¢ 2ì²œë§Œì› ì´ˆê³¼~2ì–µì› ì´í•˜: ìˆ˜ì˜ (2ì¸ ì´ìƒ)</li>
                <li>â€¢ 2ì–µì› ì´ˆê³¼: ê²½ìŸì…ì°°</li>
              </ul>
            </div>
            <div class="p-3 bg-white rounded-lg border border-amber-100">
              <div class="font-bold text-violet-700 mb-1">ğŸ”§ ìš©ì—­ê³„ì•½ ê¸°ì¤€</div>
              <ul class="text-xs text-slate-600 space-y-0.5">
                <li>â€¢ 2ì²œë§Œì› ì´í•˜: ìˆ˜ì˜ (1ì¸ ê²¬ì )</li>
                <li>â€¢ 2ì²œë§Œì› ì´ˆê³¼~2ì–µì› ì´í•˜: ìˆ˜ì˜ (2ì¸ ì´ìƒ)</li>
                <li>â€¢ 2ì–µì› ì´ˆê³¼: ê²½ìŸì…ì°°</li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <div class="flex justify-center"><span class="material-symbols-outlined text-slate-300 text-2xl">arrow_downward</span></div>

      <!-- Step 4 -->
      <div class="flex items-start gap-4">
        <div class="flex-shrink-0 w-10 h-10 bg-green-500 text-white rounded-full flex items-center justify-center font-bold">4</div>
        <div class="flex-1 bg-green-50 rounded-xl p-4 border border-green-200">
          <div class="flex items-start justify-between mb-2">
            <h4 class="font-semibold text-green-800">ê³„ì•½ ì„œë¥˜ ì¤€ë¹„</h4>
            <span class="doc-tool-badge" onclick="showDocPopup('step4')"><span class="material-symbols-outlined" style="font-size:14px">edit_document</span>ê³µë¬¸/ì–‘ì‹ ìƒì„± ë„êµ¬</span>
          </div>
          <ul class="text-sm text-slate-700 space-y-1">
            <li>â€¢ ë¬¼í’ˆ: ë¬¼ëŸ‰ë‚´ì—­ì„œ(ì‹œë°©ì„œ í¬í•¨), ì¶”ì •ê°€ê²© ì¡°ì„œ</li>
            <li>â€¢ ìš©ì—­: ê³¼ì—…ë‚´ìš©ì„œ(ê³¼ì—…ì§€ì‹œì„œ), ì¶”ì •ê°€ê²© ì¡°ì„œ</li>
            <li>â€¢ ê³µí†µ: ìˆ˜ì˜ê³„ì•½ ì‚¬ìœ ì„œ(ìˆ˜ì˜ ì‹œ), ê²¬ì ì„œ</li>
          </ul>
        </div>
      </div>
    </div>

    <details open class="mt-8 border border-slate-200 rounded-xl overflow-hidden">
      <summary class="flex items-center gap-3 p-4 bg-slate-50 hover:bg-slate-100 transition-colors cursor-pointer">
        <span class="material-symbols-outlined text-slate-500">info</span>
        <span class="font-semibold text-slate-700">ì°¸ê³  ì•ˆë‚´</span>
        <span class="text-xs text-slate-400 ml-auto">êµ¬ë¶„ ì‚¬ë¡€ Â· í˜¼í•©ê³„ì•½ ê¸°ì¤€ Â· ê°ì‚¬ ì²´í¬ë¦¬ìŠ¤íŠ¸</span>
      </summary>
      <div class="p-4 space-y-4">
        <div class="bg-white border border-slate-200 rounded-xl p-4">
          <h4 class="font-semibold text-slate-800 mb-3">ì‹¤ë¬´ êµ¬ë¶„ ì‚¬ë¡€ <span class="text-xs font-normal bg-blue-100 text-blue-700 px-2 py-0.5 rounded-full">ì§€ë°©ê³„ì•½ë²• ì œ2ì¡°, ì‹œí–‰ë ¹ ì œ2ì¡°</span></h4>
          <div class="overflow-x-auto">
            <table class="w-full text-xs">
              <thead><tr class="bg-slate-50"><th class="p-2 text-left font-semibold">ê³„ì•½ ëŒ€ìƒ</th><th class="p-2 text-center font-semibold">ë¶„ë¥˜</th><th class="p-2 text-left font-semibold">íŒë‹¨ ê·¼ê±°</th></tr></thead>
              <tbody class="divide-y divide-slate-100">
                <tr><td class="p-2">ì»´í“¨í„° + ì„¤ì¹˜</td><td class="p-2 text-center text-blue-700 font-bold">ë¬¼í’ˆ</td><td class="p-2 text-slate-600">ì„¤ì¹˜ëŠ” ë¶€ìˆ˜ì , ì†Œìœ ê¶Œ ì´ì „</td></tr>
                <tr><td class="p-2">ì†Œí”„íŠ¸ì›¨ì–´ ê°œë°œ</td><td class="p-2 text-center text-violet-700 font-bold">ìš©ì—­</td><td class="p-2 text-slate-600">ë¬´í˜•ì˜ ì§€ì  ì‚°ì¶œë¬¼</td></tr>
                <tr><td class="p-2">ì²­ì†Œ ìš©ì—­</td><td class="p-2 text-center text-violet-700 font-bold">ìš©ì—­</td><td class="p-2 text-slate-600">ì¸ì  ì—­ë¬´ ì œê³µ</td></tr>
                <tr><td class="p-2">ëƒ‰ë‚œë°©ê¸° + ì„¤ì¹˜</td><td class="p-2 text-center text-blue-700 font-bold">ë¬¼í’ˆ</td><td class="p-2 text-slate-600">ë¬¼í’ˆê°€ 70% ì´ìƒ</td></tr>
                <tr><td class="p-2">ì‹œì„¤ ìœ ì§€ë³´ìˆ˜</td><td class="p-2 text-center text-violet-700 font-bold">ìš©ì—­</td><td class="p-2 text-slate-600">ë…¸ë¬´ ì œê³µì´ í•µì‹¬</td></tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="bg-red-50 border border-red-200 rounded-xl p-4">
          <div class="flex items-start gap-3">
            <span class="material-symbols-outlined text-red-500">gavel</span>
            <div>
              <h4 class="font-semibold text-red-800 mb-2">ê°ì‚¬ ëŒ€ë¹„ ì²´í¬ë¦¬ìŠ¤íŠ¸</h4>
              <ul class="text-sm text-slate-700 space-y-1.5">
                <li class="flex items-start gap-2"><span class="material-symbols-outlined text-red-400 text-lg mt-0.5">warning</span><span><strong>ë¶„ë¥˜ ì˜¤ë¥˜</strong> â€” ìš©ì—­ì„ ë¬¼í’ˆìœ¼ë¡œ ì²˜ë¦¬í•´ ìˆ˜ì˜ê³„ì•½ í•œë„ ì´ˆê³¼ ì‹œ ê°ì‚¬ ì§€ì </span></li>
                <li class="flex items-start gap-2"><span class="material-symbols-outlined text-red-400 text-lg mt-0.5">warning</span><span><strong>í˜¼í•©ê³„ì•½ ì„ì˜ ë¶„ë¥˜</strong> â€” ë¹„ì¤‘ ê³„ì‚° ì—†ì´ ì„ì˜ë¡œ ë¶„ë¥˜ ì‹œ ë¬¸ì œ ì†Œì§€</span></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </details>
  </div>
</div>

<div id="doc-popup-overlay" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,.4); z-index:9999; align-items:center; justify-content:center;" onclick="if(event.target===this) closeDocPopup()">
  <div style="background:#fff; border-radius:16px; max-width:480px; width:90%; max-height:80vh; overflow-y:auto; padding:28px; box-shadow:0 20px 60px rgba(0,0,0,.2);">
    <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:20px;">
      <div style="display:flex; align-items:center; gap:8px;"><span class="material-symbols-outlined" style="color:#e11d48; font-size:22px;">edit_document</span><h3 id="doc-popup-title" style="font-size:18px; font-weight:700; color:#1e293b; margin:0;"></h3></div>
      <button onclick="closeDocPopup()" style="background:none; border:none; cursor:pointer; padding:4px;"><span class="material-symbols-outlined" style="color:#94a3b8; font-size:22px;">close</span></button>
    </div>
    <div id="doc-popup-body"></div>
  </div>
</div>

<style>
.doc-tool-badge { display:inline-flex; align-items:center; gap:6px; margin-top:4px; padding:6px 14px; background:#fff1f2; color:#e11d48; font-size:13px; font-weight:600; border-radius:10px; cursor:pointer; border:1.5px solid #fecdd3; transition:all .2s ease; }
.doc-tool-badge:hover { transform:translateY(-2px) scale(1.04); background:#ffe4e6; }
.doc-item { display:flex; align-items:flex-start; gap:10px; padding:12px; border-radius:10px; border:1px solid #e2e8f0; margin-bottom:8px; }
.doc-item .doc-icon { flex-shrink:0; width:32px; height:32px; border-radius:8px; display:flex; align-items:center; justify-content:center; }
.doc-item .doc-name { font-size:14px; font-weight:600; color:#1e293b; }
.doc-item .doc-desc { font-size:12px; color:#64748b; margin-top:2px; }
.doc-item.has-tool { cursor:pointer; transition:all .15s; }
.doc-item.has-tool:hover { border-color:#818cf8; background:#f5f3ff; }
</style>

<script>
var docPopupData = {
  step4: {
    title: 'ê³„ì•½ ì„œë¥˜ ì¤€ë¹„',
    groups: [
      { label: 'ë¬¼í’ˆ ê³„ì•½ ì„œë¥˜', icon: 'inventory_2', color: '#3b82f6', items: [
        { name: 'ë¬¼ëŸ‰ë‚´ì—­ì„œ + ì‹œë°©ì„œ', desc: 'ë¬¼í’ˆ ê·œê²©Â·ìˆ˜ëŸ‰Â·ë‹¨ê°€ ëª…ì‹œ', icon: 'receipt_long', color: '#3b82f6', tool: '<%= cost_estimate_path %>' },
        { name: 'ì¶”ì •ê°€ê²© ì‚°ì¶œì„œ', desc: 'ì‹œì¥ì¡°ì‚¬ ê¸°ë°˜ ì¶”ì •ê°€ê²©', icon: 'calculate', color: '#059669', tool: '<%= estimated_price_path %>' }
      ]},
      { label: 'ìš©ì—­ ê³„ì•½ ì„œë¥˜', icon: 'engineering', color: '#7c3aed', items: [
        { name: 'ê³¼ì—…ë‚´ìš©ì„œ(ê³¼ì—…ì§€ì‹œì„œ)', desc: 'ê³¼ì—… ë²”ìœ„Â·ê¸°ê°„Â·ì‚°ì¶œë¬¼ ëª…ì‹œ', icon: 'description', color: '#7c3aed', tool: '<%= official_document_path %>?type=draft', toolLabel: 'AI ê³µë¬¸ì„œ (ê¸°ì•ˆë¬¸)' }
      ]}
    ]
  }
};
function showDocPopup(step) {
  var data = docPopupData[step]; if (!data) return;
  document.getElementById('doc-popup-title').textContent = data.title;
  var html = '';
  data.groups.forEach(function(group) {
    html += '<div style="display:flex; align-items:center; gap:6px; margin:16px 0 8px; padding-bottom:6px; border-bottom:1px solid #f1f5f9;"><span class="material-symbols-outlined" style="font-size:16px; color:' + group.color + ';">' + group.icon + '</span><span style="font-size:13px; font-weight:700; color:' + group.color + ';">' + group.label + '</span></div>';
    group.items.forEach(function(item) {
      var toolAttr = item.tool ? ' has-tool" onclick="window.location.href=\'' + item.tool + '\'"' : '"';
      html += '<div class="doc-item' + toolAttr + '><div class="doc-icon" style="background:' + item.color + '15;"><span class="material-symbols-outlined" style="font-size:18px; color:' + item.color + ';">' + item.icon + '</span></div><div><div class="doc-name">' + item.name + (item.tool && !item.toolLabel ? ' <span class="material-symbols-outlined" style="font-size:12px; color:#818cf8; vertical-align:middle;">open_in_new</span>' : '') + '</div><div class="doc-desc">' + item.desc + '</div>';
      if (item.toolLabel) html += '<div style="margin-top:5px;"><a href="' + item.tool + '" style="font-size:11px; color:#4f46e5; font-weight:600;" onclick="event.stopPropagation();">' + item.toolLabel + '</a></div>';
      html += '</div></div>';
    });
  });
  document.getElementById('doc-popup-body').innerHTML = html;
  document.getElementById('doc-popup-overlay').style.display = 'flex';
}
function closeDocPopup() { document.getElementById('doc-popup-overlay').style.display = 'none'; }
document.addEventListener('keydown', function(e) { if (e.key === 'Escape') closeDocPopup(); });
</script>
