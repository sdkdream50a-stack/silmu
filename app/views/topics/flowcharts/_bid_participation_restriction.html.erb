<!-- 입찰 참가자격 제한 실무흐름도 -->
<div class="card">
  <div class="card-header">
    <h2 class="text-xl font-bold text-slate-900 flex items-center gap-3">
      <span class="material-symbols-outlined text-indigo-500">account_tree</span>
      입찰 참가자격 제한(부정당업자 제재) 실무흐름도
    </h2>
    <p class="text-slate-600 mt-1">위반행위 적발부터 제재 처분 결정·통보까지 단계별 절차</p>
  </div>

  <div class="p-6">
    <div class="mb-6 p-3 bg-red-50 border border-red-200 rounded-xl text-sm text-red-800 flex items-start gap-2">
      <span class="material-symbols-outlined text-red-500 mt-0.5" style="font-size:18px">gavel</span>
      <span>부정당업자 제재는 <strong>전국 모든 공공기관 입찰 참가 제한</strong>을 의미합니다. 처분 전 반드시 <strong>의견 청취(소명 기회)</strong>를 부여해야 합니다. (지방계약법 제31조, 시행령 제92조)</span>
    </div>

    <div class="space-y-4">
      <!-- Step 1 -->
      <div class="flex items-start gap-4">
        <div class="flex-shrink-0 w-10 h-10 bg-red-500 text-white rounded-full flex items-center justify-center font-bold">1</div>
        <div class="flex-1 bg-red-50 rounded-xl p-4 border border-red-200">
          <h4 class="font-semibold text-red-800 mb-2">위반 사실 확인</h4>
          <ul class="text-sm text-slate-700 space-y-1">
            <li>• 위반 행위 유형 파악 (담합·뇌물·허위서류·부실시공 등)</li>
            <li>• 위반 사실 증거 수집 (계약서, 준공서류, 감사 결과 등)</li>
            <li>• 시행령 제92조 각호 해당 여부 검토</li>
          </ul>
        </div>
      </div>

      <div class="flex justify-center"><span class="material-symbols-outlined text-slate-300 text-2xl">arrow_downward</span></div>

      <!-- Step 2 -->
      <div class="flex items-start gap-4">
        <div class="flex-shrink-0 w-10 h-10 bg-orange-500 text-white rounded-full flex items-center justify-center font-bold">2</div>
        <div class="flex-1 bg-orange-50 rounded-xl p-4 border border-orange-200">
          <h4 class="font-semibold text-orange-800 mb-2">제재 사유·기간 검토</h4>
          <div class="grid grid-cols-3 gap-2 mb-3">
            <div class="p-2 bg-white rounded-lg border border-red-200 text-center">
              <div class="text-xs font-bold text-red-700">2년 (중대)</div>
              <div class="text-xs text-slate-500 mt-0.5">담합·뇌물·허위서류·중대재해</div>
            </div>
            <div class="p-2 bg-white rounded-lg border border-orange-200 text-center">
              <div class="text-xs font-bold text-orange-700">1년 (일반)</div>
              <div class="text-xs text-slate-500 mt-0.5">부실시공·계약불이행·물품불량</div>
            </div>
            <div class="p-2 bg-white rounded-lg border border-amber-200 text-center">
              <div class="text-xs font-bold text-amber-700">6개월 (경미)</div>
              <div class="text-xs text-slate-500 mt-0.5">경미한 부실·납기 지연</div>
            </div>
          </div>
          <p class="text-xs text-slate-500">※ 최종 제재 기간은 위반 유형, 횟수, 정황 등 종합 고려</p>
        </div>
      </div>

      <div class="flex justify-center"><span class="material-symbols-outlined text-slate-300 text-2xl">arrow_downward</span></div>

      <!-- Step 3: 의견 청취 (필수) -->
      <div class="flex items-start gap-4">
        <div class="flex-shrink-0 w-10 h-10 bg-amber-500 text-white rounded-full flex items-center justify-center font-bold">3</div>
        <div class="flex-1 bg-amber-50 rounded-xl p-4 border border-amber-200">
          <div class="flex items-start justify-between mb-2">
            <h4 class="font-semibold text-amber-800">의견 청취 (소명 기회 부여) — 필수</h4>
            <span class="doc-tool-badge" onclick="showDocPopup('step3')"><span class="material-symbols-outlined" style="font-size:14px">edit_document</span>공문/양식 생성 도구</span>
          </div>
          <ul class="text-sm text-slate-700 space-y-1">
            <li>• <strong class="text-amber-700">사전 통지서 발송</strong>: 제재 예정 사실 + 의견 제출 기간(7일 이상) 안내</li>
            <li>• 업체 소명서 수령 및 검토</li>
            <li>• 소명 내용이 타당한 경우 제재 취소 또는 경감 검토</li>
          </ul>
          <div class="mt-3 p-2 bg-red-50 border border-red-200 rounded-lg text-xs text-red-800">
            ⚠️ 소명 기회 미부여 시 행정소송으로 <strong>처분 취소</strong>될 수 있습니다.
          </div>
        </div>
      </div>

      <div class="flex justify-center"><span class="material-symbols-outlined text-slate-300 text-2xl">arrow_downward</span></div>

      <!-- Step 4 -->
      <div class="flex items-start gap-4">
        <div class="flex-shrink-0 w-10 h-10 bg-blue-500 text-white rounded-full flex items-center justify-center font-bold">4</div>
        <div class="flex-1 bg-blue-50 rounded-xl p-4 border border-blue-200">
          <div class="flex items-start justify-between mb-2">
            <h4 class="font-semibold text-blue-800">처분 결정 및 업체 통보</h4>
            <span class="doc-tool-badge" onclick="showDocPopup('step4')"><span class="material-symbols-outlined" style="font-size:14px">edit_document</span>공문/양식 생성 도구</span>
          </div>
          <ul class="text-sm text-slate-700 space-y-1">
            <li>• 제재 결정서 작성 (제재 사유, 기간, 법령 근거 명시)</li>
            <li>• 업체에 처분 결정 통보 (이의신청 방법·기간 안내)</li>
            <li>• 이의신청 기간: 처분 통보 후 30일 이내</li>
          </ul>
        </div>
      </div>

      <div class="flex justify-center"><span class="material-symbols-outlined text-slate-300 text-2xl">arrow_downward</span></div>

      <!-- Step 5 -->
      <div class="flex items-start gap-4">
        <div class="flex-shrink-0 w-10 h-10 bg-slate-500 text-white rounded-full flex items-center justify-center font-bold">5</div>
        <div class="flex-1 bg-slate-50 rounded-xl p-4 border border-slate-200">
          <h4 class="font-semibold text-slate-800 mb-2">나라장터 제재 등록 (전국 적용)</h4>
          <ul class="text-sm text-slate-700 space-y-1">
            <li>• 나라장터 시스템에 부정당업자 등록</li>
            <li>• 제재 기간 동안 전국 공공기관 입찰 자동 차단</li>
            <li>• 제재 기간 만료 시 자동 해제 (별도 조치 불필요)</li>
            <li class="text-xs text-slate-500 ml-3">※ 제재 이력 나라장터에 5년간 보관</li>
          </ul>
        </div>
      </div>
    </div>

    <details open class="mt-8 border border-slate-200 rounded-xl overflow-hidden">
      <summary class="flex items-center gap-3 p-4 bg-slate-50 hover:bg-slate-100 transition-colors cursor-pointer">
        <span class="material-symbols-outlined text-slate-500">info</span>
        <span class="font-semibold text-slate-700">참고 안내</span>
        <span class="text-xs text-slate-400 ml-auto">제재 사유별 기간 · 주의사항 · 감사 체크리스트</span>
      </summary>
      <div class="p-4 space-y-4">
        <div class="bg-white border border-slate-200 rounded-xl p-4">
          <div class="flex items-start gap-3">
            <span class="material-symbols-outlined text-indigo-500">list</span>
            <div class="w-full">
              <h4 class="font-semibold text-slate-800 mb-3">제재 사유 13가지 요약 <span class="text-xs font-normal bg-indigo-100 text-indigo-700 px-2 py-0.5 rounded-full">시행령 제92조</span></h4>
              <div class="grid grid-cols-2 md:grid-cols-3 gap-2 text-xs">
                <% [["입찰 담합", "2년"], ["뇌물 제공", "2년"], ["허위 서류", "2년"], ["중대 재해", "2년"], ["부실 시공", "1년"], ["계약 불이행", "1년"], ["물품 불량", "1년"], ["무단 하도급", "1년"], ["안전사고", "1년"], ["환경 오염", "1년"], ["경미한 부실", "6개월"], ["납기 지연", "6개월"], ["서류 미제출", "6개월"]].each do |title, period| %>
                  <div class="flex items-center justify-between p-2 bg-slate-50 rounded-lg">
                    <span class="text-slate-700"><%= title %></span>
                    <span class="font-bold <%= period == "2년" ? "text-red-600" : period == "1년" ? "text-orange-600" : "text-amber-600" %>"><%= period %></span>
                  </div>
                <% end %>
              </div>
            </div>
          </div>
        </div>

        <div class="bg-red-50 border border-red-200 rounded-xl p-4">
          <div class="flex items-start gap-3">
            <span class="material-symbols-outlined text-red-500">gavel</span>
            <div>
              <h4 class="font-semibold text-red-800 mb-2">감사 대비 체크리스트</h4>
              <ul class="text-sm text-slate-700 space-y-1.5">
                <li class="flex items-start gap-2"><span class="material-symbols-outlined text-red-400 text-lg mt-0.5">warning</span><span><strong>소명 기회 미부여</strong> — 가장 흔한 처분 취소 사유, 반드시 7일 이상 부여</span></li>
                <li class="flex items-start gap-2"><span class="material-symbols-outlined text-red-400 text-lg mt-0.5">warning</span><span><strong>제재 등록 지연</strong> — 처분 결정 후 나라장터 등록을 지체하면 기간 중 입찰 가능</span></li>
                <li class="flex items-start gap-2"><span class="material-symbols-outlined text-red-400 text-lg mt-0.5">warning</span><span><strong>근거 없는 제재</strong> — 법령에 규정된 사유 외 제재는 위법 처분</span></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </details>
  </div>
</div>

<div id="doc-popup-overlay" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,.4); z-index:9999; align-items:center; justify-content:center;" onclick="if(event.target===this) closeDocPopup()">
  <div style="background:#fff; border-radius:16px; max-width:480px; width:90%; max-height:80vh; overflow-y:auto; padding:28px; box-shadow:0 20px 60px rgba(0,0,0,.2);">
    <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:20px;">
      <div style="display:flex; align-items:center; gap:8px;"><span class="material-symbols-outlined" style="color:#e11d48; font-size:22px;">edit_document</span><h3 id="doc-popup-title" style="font-size:18px; font-weight:700; color:#1e293b; margin:0;"></h3></div>
      <button onclick="closeDocPopup()" style="background:none; border:none; cursor:pointer; padding:4px;"><span class="material-symbols-outlined" style="color:#94a3b8; font-size:22px;">close</span></button>
    </div>
    <div id="doc-popup-body"></div>
  </div>
</div>

<style>
.doc-tool-badge { display:inline-flex; align-items:center; gap:6px; margin-top:4px; padding:6px 14px; background:#fff1f2; color:#e11d48; font-size:13px; font-weight:600; border-radius:10px; cursor:pointer; border:1.5px solid #fecdd3; transition:all .2s ease; }
.doc-tool-badge:hover { transform:translateY(-2px) scale(1.04); background:#ffe4e6; }
.doc-item { display:flex; align-items:flex-start; gap:10px; padding:12px; border-radius:10px; border:1px solid #e2e8f0; margin-bottom:8px; }
.doc-item .doc-icon { flex-shrink:0; width:32px; height:32px; border-radius:8px; display:flex; align-items:center; justify-content:center; }
.doc-item .doc-name { font-size:14px; font-weight:600; color:#1e293b; }
.doc-item .doc-desc { font-size:12px; color:#64748b; margin-top:2px; }
.doc-item.has-tool { cursor:pointer; transition:all .15s; }
.doc-item.has-tool:hover { border-color:#818cf8; background:#f5f3ff; }
</style>

<script>
var docPopupData = {
  step3: {
    title: '의견 청취 단계 공문/양식',
    groups: [
      { label: '필수 발송', icon: 'outgoing_mail', color: '#dc2626', items: [
        { name: '입찰 참가자격 제한 사전 통지서', desc: '제재 예정 사실·의견 제출 기간(7일 이상) 명시', icon: 'outgoing_mail', color: '#dc2626', tool: '<%= official_document_path %>?type=notification', toolLabel: 'AI 공문서 (통보문)' }
      ]}
    ]
  },
  step4: {
    title: '처분 결정·통보 단계 공문/양식',
    groups: [
      { label: '필수 문서', icon: 'verified', color: '#dc2626', items: [
        { name: '입찰 참가자격 제한 처분서', desc: '제재 사유·기간·법령 근거·이의신청 방법 명시', icon: 'description', color: '#dc2626', tool: '<%= official_document_path %>?type=draft', toolLabel: 'AI 공문서 (기안문)' },
        { name: '처분 통보서', desc: '업체에 처분 결정 공식 통보', icon: 'outgoing_mail', color: '#059669', tool: '<%= official_document_path %>?type=notification', toolLabel: 'AI 공문서 (통보문)' }
      ]}
    ]
  }
};
function showDocPopup(step) {
  var data = docPopupData[step]; if (!data) return;
  document.getElementById('doc-popup-title').textContent = data.title;
  var html = '';
  data.groups.forEach(function(group) {
    html += '<div style="display:flex; align-items:center; gap:6px; margin:16px 0 8px; padding-bottom:6px; border-bottom:1px solid #f1f5f9;"><span class="material-symbols-outlined" style="font-size:16px; color:' + group.color + ';">' + group.icon + '</span><span style="font-size:13px; font-weight:700; color:' + group.color + ';">' + group.label + '</span></div>';
    group.items.forEach(function(item) {
      var toolAttr = item.tool ? ' has-tool" onclick="window.location.href=\'' + item.tool + '\'"' : '"';
      html += '<div class="doc-item' + toolAttr + '><div class="doc-icon" style="background:' + item.color + '15;"><span class="material-symbols-outlined" style="font-size:18px; color:' + item.color + ';">' + item.icon + '</span></div><div><div class="doc-name">' + item.name + '</div><div class="doc-desc">' + item.desc + '</div>';
      if (item.toolLabel) html += '<div style="margin-top:5px;"><a href="' + item.tool + '" style="font-size:11px; color:#4f46e5; font-weight:600;" onclick="event.stopPropagation();">' + item.toolLabel + '</a></div>';
      html += '</div></div>';
    });
  });
  document.getElementById('doc-popup-body').innerHTML = html;
  document.getElementById('doc-popup-overlay').style.display = 'flex';
}
function closeDocPopup() { document.getElementById('doc-popup-overlay').style.display = 'none'; }
document.addEventListener('keydown', function(e) { if (e.key === 'Escape') closeDocPopup(); });
</script>
