<%# Created: 2026-02-22 20:55 %>
<%# 규격가격 분리입찰 실무흐름도 %>

<div class="space-y-8">
  <!-- 프로세스 개요 -->
  <div class="bg-gradient-to-r from-indigo-50 to-emerald-50 rounded-2xl p-6 border border-indigo-100">
    <h3 class="text-lg font-bold text-slate-900 mb-4 flex items-center gap-2">
      <span class="material-symbols-outlined text-indigo-600">account_tree</span>
      규격가격 분리입찰 프로세스
    </h3>
    <div class="flex items-center gap-3 overflow-x-auto pb-2">
      <div class="flex items-center gap-2 px-4 py-2 bg-white rounded-lg shadow-sm whitespace-nowrap">
        <span class="w-6 h-6 rounded-full bg-indigo-600 text-white text-xs flex items-center justify-center font-bold">1</span>
        <span class="text-sm font-medium text-slate-700">입찰 준비 및 공고</span>
      </div>
      <span class="material-symbols-outlined text-slate-300">arrow_forward</span>
      <div class="flex items-center gap-2 px-4 py-2 bg-white rounded-lg shadow-sm whitespace-nowrap">
        <span class="w-6 h-6 rounded-full bg-amber-500 text-white text-xs flex items-center justify-center font-bold">2</span>
        <span class="text-sm font-medium text-slate-700">규격 평가</span>
      </div>
      <span class="material-symbols-outlined text-slate-300">arrow_forward</span>
      <div class="flex items-center gap-2 px-4 py-2 bg-white rounded-lg shadow-sm whitespace-nowrap">
        <span class="w-6 h-6 rounded-full bg-emerald-600 text-white text-xs flex items-center justify-center font-bold">3</span>
        <span class="text-sm font-medium text-slate-700">가격 개찰</span>
      </div>
      <span class="material-symbols-outlined text-slate-300">arrow_forward</span>
      <div class="flex items-center gap-2 px-4 py-2 bg-white rounded-lg shadow-sm whitespace-nowrap">
        <span class="w-6 h-6 rounded-full bg-slate-600 text-white text-xs flex items-center justify-center font-bold">4</span>
        <span class="text-sm font-medium text-slate-700">계약 체결</span>
      </div>
    </div>
  </div>

  <!-- STEP 1: 입찰 준비 및 공고 -->
  <div class="card overflow-hidden" style="border-left: 4px solid #4f46e5;">
    <div class="bg-indigo-50 px-6 py-4 border-b border-indigo-100">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <span class="w-10 h-10 rounded-xl bg-indigo-600 text-white flex items-center justify-center font-bold shadow-md">1</span>
          <div>
            <h4 class="font-bold text-slate-900">입찰 준비 및 공고</h4>
            <p class="text-sm text-slate-600">규격서 작성, 2억원 이상 확인, 입찰공고</p>
          </div>
        </div>
        <span class="px-3 py-1 bg-indigo-600 text-white text-xs font-semibold rounded-full">입찰 준비</span>
      </div>
    </div>
    <div class="p-6">
      <div class="grid sm:grid-cols-2 gap-4 mb-5">
        <a href="<%= estimated_price_path %>" class="group block p-4 bg-gradient-to-br from-indigo-50 to-white border-2 border-indigo-300 rounded-xl hover:border-indigo-500 hover:shadow-lg transition-all">
          <div class="flex items-start gap-3">
            <span class="material-symbols-outlined text-indigo-600 text-2xl">calculate</span>
            <div class="flex-1 min-w-0">
              <div class="font-bold text-slate-900 group-hover:text-indigo-600 transition-colors flex items-center gap-2">
                추정가격 산정
                <span class="text-xs px-2 py-0.5 bg-indigo-600 text-white rounded-full">2억원 이상</span>
              </div>
              <div class="text-sm text-slate-500 mt-1">물품 구매 2억원 이상 필수 ⭐</div>
            </div>
          </div>
        </a>
        <div class="p-4 bg-slate-50 border border-slate-200 rounded-xl">
          <div class="flex items-start gap-3">
            <span class="material-symbols-outlined text-slate-600 text-2xl">description</span>
            <div class="flex-1 min-w-0">
              <div class="font-semibold text-slate-900">규격서 작성</div>
              <div class="text-sm text-slate-500 mt-1">기술 사양 명확히 명시</div>
            </div>
          </div>
        </div>
        <a href="<%= contract_method_path %>" class="group block p-4 bg-white border border-slate-200 rounded-xl hover:border-indigo-300 hover:shadow-md transition-all">
          <div class="flex items-start gap-3">
            <span class="material-symbols-outlined text-indigo-600 text-2xl">gavel</span>
            <div class="flex-1 min-w-0">
              <div class="font-semibold text-slate-900 group-hover:text-indigo-600 transition-colors">계약방식 결정</div>
              <div class="text-sm text-slate-500 mt-1">규격가격 분리입찰 여부 판단</div>
            </div>
          </div>
        </a>
        <div class="p-4 bg-slate-50 border border-slate-200 rounded-xl">
          <div class="flex items-start gap-3">
            <span class="material-symbols-outlined text-slate-600 text-2xl">campaign</span>
            <div class="flex-1 min-w-0">
              <div class="font-semibold text-slate-900">입찰 공고</div>
              <div class="text-sm text-slate-500 mt-1">나라장터 게시 (10억 미만 7일)</div>
            </div>
          </div>
        </div>
      </div>
      <div class="bg-blue-50 border border-blue-200 rounded-xl p-4">
        <div class="flex items-start gap-3">
          <span class="material-symbols-outlined text-blue-600 shrink-0">info</span>
          <p class="text-sm text-blue-900"><strong>체크포인트</strong>: 규격가격 분리입찰은 <strong>물품 구매 2억원 이상</strong>에 적용됩니다. 공사나 용역은 적용 대상이 아니며, 규격서는 <strong>특정 제조사 제품만 구매 가능하도록 작성하면 안 됩니다</strong> (담합 방지).</p>
        </div>
      </div>
    </div>
  </div>

  <!-- STEP 2: 규격 평가 -->
  <div class="card overflow-hidden" style="border-left: 4px solid #f59e0b;">
    <div class="bg-amber-50 px-6 py-4 border-b border-amber-100">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <span class="w-10 h-10 rounded-xl bg-amber-500 text-white flex items-center justify-center font-bold shadow-md">2</span>
          <div>
            <h4 class="font-bold text-slate-900 flex items-center gap-2">
              규격 평가
              <span class="doc-tool-badge" onclick="showDocPopup('step2')">
                <span class="material-symbols-outlined" style="font-size:16px">edit_document</span>
                공문/양식 생성 도구
              </span>
            </h4>
            <p class="text-sm text-slate-600">규격심사위원회 구성, 적격/부적격 판정</p>
          </div>
        </div>
        <span class="px-3 py-1 bg-amber-500 text-white text-xs font-semibold rounded-full">규격 심사</span>
      </div>
    </div>
    <div class="p-6">
      <div class="grid sm:grid-cols-2 gap-4 mb-5">
        <div class="p-4 bg-amber-50 border-2 border-amber-300 rounded-xl">
          <div class="flex items-start gap-3">
            <span class="material-symbols-outlined text-amber-600 text-2xl">group</span>
            <div class="flex-1 min-w-0">
              <div class="font-bold text-slate-900">규격심사위원회 구성</div>
              <div class="text-sm text-slate-600 mt-1">3인 이상 전문가 위촉 ⭐</div>
            </div>
          </div>
        </div>
        <div class="p-4 bg-slate-50 border border-slate-200 rounded-xl">
          <div class="flex items-start gap-3">
            <span class="material-symbols-outlined text-slate-600 text-2xl">fact_check</span>
            <div class="flex-1 min-w-0">
              <div class="font-semibold text-slate-900">규격서 적합성 검토</div>
              <div class="text-sm text-slate-500 mt-1">제출 서류와 규격서 비교</div>
            </div>
          </div>
        </div>
        <div class="p-4 bg-slate-50 border border-slate-200 rounded-xl">
          <div class="flex items-start gap-3">
            <span class="material-symbols-outlined text-slate-600 text-2xl">rule</span>
            <div class="flex-1 min-w-0">
              <div class="font-semibold text-slate-900">적격/부적격 판정</div>
              <div class="text-sm text-slate-500 mt-1">기술 요건 충족 여부 결정</div>
            </div>
          </div>
        </div>
        <div class="p-4 bg-slate-50 border border-slate-200 rounded-xl">
          <div class="flex items-start gap-3">
            <span class="material-symbols-outlined text-slate-600 text-2xl">description</span>
            <div class="flex-1 min-w-0">
              <div class="font-semibold text-slate-900">심사 결과 공개</div>
              <div class="text-sm text-slate-500 mt-1">적격 업체 명단 게시</div>
            </div>
          </div>
        </div>
      </div>
      <div class="bg-amber-50 border border-amber-200 rounded-xl p-4">
        <div class="flex items-start gap-3">
          <span class="material-symbols-outlined text-amber-600 shrink-0">warning</span>
          <p class="text-sm text-amber-900"><strong>체크포인트</strong>: 규격심사위원회는 <strong>3인 이상의 전문가</strong>로 구성해야 하며, 위원 명단은 가격 개찰 전까지 비공개입니다. 규격 부적격 업체는 <strong>가격 입찰 참여 불가</strong>하며, 이의신청 기회를 제공해야 합니다.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- STEP 3: 가격 개찰 -->
  <div class="card overflow-hidden" style="border-left: 4px solid #059669;">
    <div class="bg-emerald-50 px-6 py-4 border-b border-emerald-100">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <span class="w-10 h-10 rounded-xl bg-emerald-600 text-white flex items-center justify-center font-bold shadow-md">3</span>
          <div>
            <h4 class="font-bold text-slate-900">가격 개찰</h4>
            <p class="text-sm text-slate-600">규격 적격 업체만 참여, 최저가 낙찰</p>
          </div>
        </div>
        <span class="px-3 py-1 bg-emerald-600 text-white text-xs font-semibold rounded-full">낙찰 결정</span>
      </div>
    </div>
    <div class="p-6">
      <div class="grid sm:grid-cols-2 gap-4 mb-5">
        <div class="p-4 bg-emerald-50 border-2 border-emerald-300 rounded-xl">
          <div class="flex items-start gap-3">
            <span class="material-symbols-outlined text-emerald-600 text-2xl">verified</span>
            <div class="flex-1 min-w-0">
              <div class="font-bold text-slate-900">규격 적격 업체 확인</div>
              <div class="text-sm text-slate-600 mt-1">심사 통과 업체만 개찰 ⭐</div>
            </div>
          </div>
        </div>
        <div class="p-4 bg-slate-50 border border-slate-200 rounded-xl">
          <div class="flex items-start gap-3">
            <span class="material-symbols-outlined text-slate-600 text-2xl">mail_lock</span>
            <div class="flex-1 min-w-0">
              <div class="font-semibold text-slate-900">가격 입찰서 개봉</div>
              <div class="text-sm text-slate-500 mt-1">적격 업체 투찰가만 공개</div>
            </div>
          </div>
        </div>
        <div class="p-4 bg-slate-50 border border-slate-200 rounded-xl">
          <div class="flex items-start gap-3">
            <span class="material-symbols-outlined text-slate-600 text-2xl">trending_down</span>
            <div class="flex-1 min-w-0">
              <div class="font-semibold text-slate-900">최저가 업체 선정</div>
              <div class="text-sm text-slate-500 mt-1">예정가격 이하 최저가</div>
            </div>
          </div>
        </div>
        <div class="p-4 bg-slate-50 border border-slate-200 rounded-xl">
          <div class="flex items-start gap-3">
            <span class="material-symbols-outlined text-slate-600 text-2xl">check_circle</span>
            <div class="flex-1 min-w-0">
              <div class="font-semibold text-slate-900">낙찰자 결정</div>
              <div class="text-sm text-slate-500 mt-1">낙찰하한율 이상 확인</div>
            </div>
          </div>
        </div>
      </div>
      <div class="bg-blue-50 border border-blue-200 rounded-xl p-4">
        <div class="flex items-start gap-3">
          <span class="material-symbols-outlined text-blue-600 shrink-0">info</span>
          <p class="text-sm text-blue-900"><strong>체크포인트</strong>: 규격 부적격 업체의 가격 입찰서는 <strong>개봉하지 않고 반환</strong>합니다. 규격 적격 업체 중 <strong>예정가격 이하 최저가</strong>를 제시한 업체가 낙찰되며, 낙찰하한율 미만 투찰은 자동 탈락입니다.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- STEP 4: 계약 체결 -->
  <div class="card overflow-hidden" style="border-left: 4px solid #475569;">
    <div class="bg-slate-50 px-6 py-4 border-b border-slate-100">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <span class="w-10 h-10 rounded-xl bg-slate-600 text-white flex items-center justify-center font-bold shadow-md">4</span>
          <div>
            <h4 class="font-bold text-slate-900">계약 체결</h4>
            <p class="text-sm text-slate-600">낙찰자 통보, 계약보증금 납부, 계약서 작성</p>
          </div>
        </div>
        <span class="px-3 py-1 bg-slate-600 text-white text-xs font-semibold rounded-full">계약 이행</span>
      </div>
    </div>
    <div class="p-6">
      <div class="grid sm:grid-cols-2 gap-4 mb-5">
        <div class="p-4 bg-slate-50 border border-slate-200 rounded-xl">
          <div class="flex items-start gap-3">
            <span class="material-symbols-outlined text-slate-600 text-2xl">notifications</span>
            <div class="flex-1 min-w-0">
              <div class="font-semibold text-slate-900">낙찰자 통보</div>
              <div class="text-sm text-slate-500 mt-1">낙찰 통지서 발송</div>
            </div>
          </div>
        </div>
        <a href="<%= contract_guarantee_path %>" class="group block p-4 bg-gradient-to-br from-slate-50 to-white border-2 border-slate-300 rounded-xl hover:border-slate-500 hover:shadow-lg transition-all">
          <div class="flex items-start gap-3">
            <span class="material-symbols-outlined text-slate-600 text-2xl">security</span>
            <div class="flex-1 min-w-0">
              <div class="font-bold text-slate-900 group-hover:text-slate-600 transition-colors flex items-center gap-2">
                계약보증금 납부
                <span class="text-xs px-2 py-0.5 bg-slate-600 text-white rounded-full">필수</span>
              </div>
              <div class="text-sm text-slate-500 mt-1">계약금액 10% 이상 ⭐</div>
            </div>
          </div>
        </a>
        <a href="<%= contract_documents_path %>" class="group block p-4 bg-white border border-slate-200 rounded-xl hover:border-slate-300 hover:shadow-md transition-all">
          <div class="flex items-start gap-3">
            <span class="material-symbols-outlined text-slate-600 text-2xl">description</span>
            <div class="flex-1 min-w-0">
              <div class="font-semibold text-slate-900 group-hover:text-slate-600 transition-colors">계약서 작성</div>
              <div class="text-sm text-slate-500 mt-1">표준계약서 + 특수조건</div>
            </div>
          </div>
        </a>
        <div class="p-4 bg-slate-50 border border-slate-200 rounded-xl">
          <div class="flex items-start gap-3">
            <span class="material-symbols-outlined text-slate-600 text-2xl">check_circle</span>
            <div class="flex-1 min-w-0">
              <div class="font-semibold text-slate-900">계약 체결 완료</div>
              <div class="text-sm text-slate-500 mt-1">계약서 서명 및 등록</div>
            </div>
          </div>
        </div>
      </div>
      <div class="bg-blue-50 border border-blue-200 rounded-xl p-4">
        <div class="flex items-start gap-3">
          <span class="material-symbols-outlined text-blue-600 shrink-0">info</span>
          <p class="text-sm text-blue-900"><strong>체크포인트</strong>: 낙찰자는 통보일로부터 <strong>5일 이내</strong> 계약보증금을 납부해야 하며, 기한 내 미납 시 낙찰이 취소됩니다. 계약서에는 <strong>규격서를 첨부</strong>하여 납품 물품의 기술 사양을 명확히 해야 합니다.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- 체크포인트 3컬럼 -->
  <div class="grid md:grid-cols-3 gap-4">
    <div class="card p-5 border-l-4 border-red-500">
      <h5 class="font-bold text-slate-900 mb-3 flex items-center gap-2">
        <span class="material-symbols-outlined text-red-600">cancel</span>
        절대 금지
      </h5>
      <ul class="space-y-2 text-sm text-slate-700">
        <li class="flex items-start gap-2">
          <span class="text-red-600 mt-0.5">•</span>
          <span>특정 제조사만 구매 가능하도록 규격서 작성</span>
        </li>
        <li class="flex items-start gap-2">
          <span class="text-red-600 mt-0.5">•</span>
          <span>규격 부적격 업체 가격 입찰서 개봉</span>
        </li>
        <li class="flex items-start gap-2">
          <span class="text-red-600 mt-0.5">•</span>
          <span>규격심사위원 명단 사전 공개 (담합 위험)</span>
        </li>
      </ul>
    </div>
    <div class="card p-5 border-l-4 border-emerald-500">
      <h5 class="font-bold text-slate-900 mb-3 flex items-center gap-2">
        <span class="material-symbols-outlined text-emerald-600">verified</span>
        필수 서류
      </h5>
      <ul class="space-y-2 text-sm text-slate-700">
        <li class="flex items-start gap-2">
          <span class="text-emerald-600 mt-0.5">•</span>
          <span>규격서 (기술 사양 명확히 명시)</span>
        </li>
        <li class="flex items-start gap-2">
          <span class="text-emerald-600 mt-0.5">•</span>
          <span>규격심사위원회 심사 결과표</span>
        </li>
        <li class="flex items-start gap-2">
          <span class="text-emerald-600 mt-0.5">•</span>
          <span>개찰조서 (규격 적격 업체만 기재)</span>
        </li>
      </ul>
    </div>
    <div class="card p-5 border-l-4 border-blue-500">
      <h5 class="font-bold text-slate-900 mb-3 flex items-center gap-2">
        <span class="material-symbols-outlined text-blue-600">tips_and_updates</span>
        실무 팁
      </h5>
      <ul class="space-y-2 text-sm text-slate-700">
        <li class="flex items-start gap-2">
          <span class="text-blue-600 mt-0.5">•</span>
          <span>규격서는 KS 표준 참조 권장</span>
        </li>
        <li class="flex items-start gap-2">
          <span class="text-blue-600 mt-0.5">•</span>
          <span>규격 부적격 업체에 이의신청 기회 제공</span>
        </li>
        <li class="flex items-start gap-2">
          <span class="text-blue-600 mt-0.5">•</span>
          <span>규격심사 기준은 입찰공고에 명시</span>
        </li>
      </ul>
    </div>
  </div>
</div>

<!-- 공문/양식 생성도구 팝업 -->
<div id="docPopup" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden items-center justify-center z-50 p-4" onclick="hideDocPopup(event)">
  <div class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[85vh] overflow-hidden" onclick="event.stopPropagation()">
    <div class="sticky top-0 bg-gradient-to-r from-indigo-600 to-amber-600 text-white px-6 py-4 flex items-center justify-between z-10">
      <h3 class="text-xl font-bold" id="popupTitle">공문/양식 생성 도구</h3>
      <button onclick="hideDocPopup()" class="w-8 h-8 rounded-lg hover:bg-white/20 flex items-center justify-center transition-colors">
        <span class="material-symbols-outlined">close</span>
      </button>
    </div>
    <div class="p-6 overflow-y-auto max-h-[calc(85vh-80px)]" id="popupContent">
      <!-- 동적 콘텐츠 -->
    </div>
  </div>
</div>

<style>
.doc-tool-badge {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 4px 10px;
  background: linear-gradient(135deg, #6366f1 0%, #f59e0b 100%);
  color: white;
  font-size: 0.75rem;
  font-weight: 600;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.2s;
  box-shadow: 0 2px 4px rgba(245, 158, 11, 0.3);
}
.doc-tool-badge:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 8px rgba(245, 158, 11, 0.4);
}
</style>

<script>
var docPopupData = {
  step2: {
    title: '규격 평가 단계 공문/양식',
    groups: [
      {
        label: '필수 도구',
        icon: 'auto_awesome',
        color: '#f59e0b',
        items: [
          {
            name: '계약서류 체크리스트',
            desc: '규격서 포함 필수 서류 목록 확인',
            icon: 'checklist',
            color: '#f59e0b',
            tool: '<%= contract_documents_path %>',
            featured: true
          }
        ]
      },
      {
        label: '필수 서류',
        icon: 'verified',
        color: '#dc2626',
        items: [
          {
            name: '규격서',
            desc: '기술 사양 및 성능 요구사항 명시',
            icon: 'description',
            color: '#dc2626'
          },
          {
            name: '규격심사위원 위촉장',
            desc: '3인 이상 전문가 위촉 공문',
            icon: 'badge',
            color: '#dc2626'
          },
          {
            name: '규격심사 결과표',
            desc: '적격/부적격 판정 근거 명시',
            icon: 'fact_check',
            color: '#dc2626'
          }
        ]
      },
      {
        label: '검토용',
        icon: 'fact_check',
        color: '#64748b',
        items: [
          {
            name: '추정가격 계산기',
            desc: '2억원 이상 물품 구매 여부 확인',
            icon: 'calculate',
            color: '#64748b',
            tool: '<%= estimated_price_path %>'
          }
        ]
      }
    ]
  }
};

function showDocPopup(step) {
  var data = docPopupData[step];
  if (!data) return;

  document.getElementById('popupTitle').textContent = data.title;

  var html = '';
  data.groups.forEach(function(group) {
    html += '<div class="mb-6 last:mb-0">';
    html += '<h4 class="font-bold text-slate-900 mb-3 flex items-center gap-2">';
    html += '<span class="material-symbols-outlined" style="color:' + group.color + '">' + group.icon + '</span>';
    html += group.label;
    html += '</h4>';
    html += '<div class="grid sm:grid-cols-2 gap-3">';

    group.items.forEach(function(item) {
      var tag = item.tool ? 'a' : 'div';
      var href = item.tool ? ' href="' + item.tool + '"' : '';
      var hoverClass = item.tool ? ' hover:shadow-lg hover:scale-[1.02]' : '';

      html += '<' + tag + href + ' class="block p-4 bg-white border-2 border-slate-200 rounded-xl transition-all' + hoverClass + '">';
      html += '<div class="flex items-start gap-3">';
      html += '<span class="material-symbols-outlined text-2xl" style="color:' + item.color + '">' + item.icon + '</span>';
      html += '<div class="flex-1 min-w-0">';
      html += '<div class="font-semibold text-slate-900 flex items-center gap-2">';
      html += item.name;
      if (item.featured) {
        html += '<span class="px-2 py-0.5 bg-amber-500 text-white text-xs rounded-full">핵심</span>';
      }
      html += '</div>';
      html += '<div class="text-sm text-slate-500 mt-1">' + item.desc + '</div>';
      html += '</div>';
      html += '</div>';
      html += '</' + tag + '>';
    });

    html += '</div></div>';
  });

  document.getElementById('popupContent').innerHTML = html;
  document.getElementById('docPopup').classList.remove('hidden');
  document.getElementById('docPopup').classList.add('flex');
}

function hideDocPopup(event) {
  if (!event || event.target.id === 'docPopup' || event.currentTarget.tagName === 'BUTTON') {
    document.getElementById('docPopup').classList.add('hidden');
    document.getElementById('docPopup').classList.remove('flex');
  }
}
</script>
