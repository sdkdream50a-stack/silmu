<%# 과목 상세 페이지 — 챕터 목록 %>
<% colors = @colors %>

<!-- 과목 헤더 -->
<section class="<%= colors[:bg_dark] %> text-white py-14 px-4">
  <div class="max-w-4xl mx-auto">
    <!-- 브레드크럼 -->
    <div class="flex items-center gap-2 text-white/60 text-sm mb-6">
      <a href="https://exam.silmu.kr" class="hover:text-white transition-colors">홈</a>
      <span class="material-symbols-outlined text-sm">chevron_right</span>
      <a href="<%= exam_subjects_path %>" class="hover:text-white transition-colors">커리큘럼</a>
      <span class="material-symbols-outlined text-sm">chevron_right</span>
      <span class="text-white"><%= @subject[:number] %></span>
    </div>

    <div class="flex items-start gap-5">
      <div class="w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center flex-shrink-0">
        <span class="material-symbols-outlined text-white text-3xl"><%= @subject[:icon] %></span>
      </div>
      <div>
        <div class="text-white/70 text-sm font-semibold mb-2"><%= @subject[:number] %> · <%= @subject[:total_chapters] %>개 챕터</div>
        <h1 class="text-3xl md:text-4xl font-bold leading-tight"><%= @subject[:title] %></h1>
        <p class="text-white/70 mt-2 text-lg"><%= @subject[:subtitle] %></p>
      </div>
    </div>
  </div>
</section>

<!-- 챕터 목록 -->
<section class="py-10 px-4 bg-slate-50">
  <div class="max-w-4xl mx-auto">
    <h2 class="text-lg font-bold text-slate-700 mb-5 flex items-center gap-2">
      <span class="material-symbols-outlined <%= colors[:text_dark] %>">format_list_numbered</span>
      전체 챕터 (<%= @subject[:chapters].size %>장)
    </h2>

    <div class="space-y-4">
      <% @subject[:chapters].each do |chapter| %>
        <div class="bg-white rounded-2xl border <%= colors[:border] %> overflow-hidden">
          <!-- 챕터 헤더 (클릭 가능) -->
          <a href="<%= exam_subject_chapter_path(@subject[:id], chapter[:number]) %>"
             class="group flex items-start gap-4 p-5 hover:bg-slate-50 transition-colors">
            <!-- 챕터 번호 -->
            <div class="w-10 h-10 <%= colors[:bg_dark] %> rounded-xl flex items-center justify-center flex-shrink-0 mt-0.5">
              <span class="text-white font-bold text-sm"><%= chapter[:number] %></span>
            </div>

            <div class="flex-1 min-w-0">
              <h3 class="text-base font-bold text-slate-900 group-hover:<%= colors[:text_dark] %> transition-colors">
                제<%= chapter[:number] %>장 <%= chapter[:title] %>
              </h3>

              <!-- 절 목록 (간략) -->
              <p class="text-sm text-slate-500 mt-1 line-clamp-1">
                <%= chapter[:sections].map { |s| "제#{chapter[:sections].index(s)+1}절 #{s}" }.join(' · ') %>
              </p>

              <!-- 키워드 뱃지 (상위 3개) -->
              <div class="flex flex-wrap gap-1.5 mt-2">
                <% chapter[:keywords].first(3).each do |kw| %>
                  <span class="text-xs <%= colors[:badge] %> px-2 py-0.5 rounded-full"><%= kw.split('(').first.strip %></span>
                <% end %>
                <% if chapter[:keywords].size > 3 %>
                  <span class="text-xs text-slate-400 px-2 py-0.5">+<%= chapter[:keywords].size - 3 %>개</span>
                <% end %>
              </div>
            </div>

            <!-- 화살표 -->
            <div class="flex-shrink-0 mt-1">
              <span class="material-symbols-outlined text-slate-400 group-hover:<%= colors[:text_dark] %> transition-colors">arrow_forward_ios</span>
            </div>
          </a>

          <!-- 학습목표 미리보기 (접힘) -->
          <div class="border-t <%= colors[:border] %> px-5 py-3 <%= colors[:bg] %>">
            <p class="text-xs font-semibold <%= colors[:text] %> mb-1.5 flex items-center gap-1">
              <span class="material-symbols-outlined text-sm">flag</span>
              학습목표
            </p>
            <ul class="space-y-0.5">
              <% chapter[:learning_objectives].first(2).each do |obj| %>
                <li class="text-xs text-slate-600 flex items-start gap-1">
                  <span class="text-slate-400 mt-0.5">·</span>
                  <%= obj %>
                </li>
              <% end %>
              <% if chapter[:learning_objectives].size > 2 %>
                <li class="text-xs text-slate-400">외 <%= chapter[:learning_objectives].size - 2 %>개 학습목표...</li>
              <% end %>
            </ul>
          </div>
        </div>
      <% end %>
    </div>

    <!-- 이전/다음 과목 -->
    <div class="mt-10 grid grid-cols-2 gap-4">
      <div>
        <% if @prev_subject %>
          <a href="<%= exam_subject_path(@prev_subject[:id]) %>"
             class="flex items-center gap-3 bg-white rounded-xl border border-slate-200 hover:border-slate-400 px-4 py-3 transition-all">
            <span class="material-symbols-outlined text-slate-400">arrow_back</span>
            <div class="min-w-0">
              <div class="text-xs text-slate-400">이전 과목</div>
              <div class="text-sm font-semibold text-slate-700 truncate"><%= @prev_subject[:number] %> <%= @prev_subject[:title] %></div>
            </div>
          </a>
        <% end %>
      </div>
      <div class="flex justify-end">
        <% if @next_subject %>
          <a href="<%= exam_subject_path(@next_subject[:id]) %>"
             class="flex items-center gap-3 bg-white rounded-xl border border-slate-200 hover:border-slate-400 px-4 py-3 transition-all">
            <div class="min-w-0 text-right">
              <div class="text-xs text-slate-400">다음 과목</div>
              <div class="text-sm font-semibold text-slate-700 truncate"><%= @next_subject[:number] %> <%= @next_subject[:title] %></div>
            </div>
            <span class="material-symbols-outlined text-slate-400">arrow_forward</span>
          </a>
        <% end %>
      </div>
    </div>
  </div>
</section>
